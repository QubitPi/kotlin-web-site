<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-07-16T16:35:59.865178797"><link rel="canonical" href="https://kotlinlang.org/docs/whatsnew2120.html" data-react-helmet="true"><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
<title>What's new in Kotlin 2.1.20 | Kotlin Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"ide-support","level":0,"title":"IDE support","anchor":"#ide-support"},{"id":"download-sources-for-kotlin-artifacts-in-projects-with-osgi-support","level":1,"title":"Download sources for Kotlin artifacts in projects with OSGi support","anchor":"#download-sources-for-kotlin-artifacts-in-projects-with-osgi-support"},{"id":"kotlin-k2-compiler","level":0,"title":"Kotlin K2 compiler","anchor":"#kotlin-k2-compiler"},{"id":"new-default-kapt-plugin","level":1,"title":"New default kapt plugin","anchor":"#new-default-kapt-plugin"},{"id":"lombok-compiler-plugin-support-for-superbuilder-and-updates-on-builder","level":1,"title":"Lombok compiler plugin: support for @SuperBuilder and updates on @Builder","anchor":"#lombok-compiler-plugin-support-for-superbuilder-and-updates-on-builder"},{"id":"kotlin-multiplatform-new-dsl-to-replace-gradle-s-application-plugin","level":0,"title":"Kotlin Multiplatform: new DSL to replace Gradle\u0027s Application plugin","anchor":"#kotlin-multiplatform-new-dsl-to-replace-gradle-s-application-plugin"},{"id":"kotlin-native","level":0,"title":"Kotlin/Native","anchor":"#kotlin-native"},{"id":"support-for-xcode-16-3","level":1,"title":"Support for Xcode 16.3","anchor":"#support-for-xcode-16-3"},{"id":"new-inlining-optimization","level":1,"title":"New inlining optimization","anchor":"#new-inlining-optimization"},{"id":"kotlin-wasm","level":0,"title":"Kotlin/Wasm","anchor":"#kotlin-wasm"},{"id":"custom-formatters-enabled-by-default","level":1,"title":"Custom formatters enabled by default","anchor":"#custom-formatters-enabled-by-default"},{"id":"support-for-dwarf-to-debug-kotlin-wasm-code","level":1,"title":"Support for DWARF to debug Kotlin/Wasm code","anchor":"#support-for-dwarf-to-debug-kotlin-wasm-code"},{"id":"migration-to-provider-api-for-kotlin-wasm-and-kotlin-js-properties","level":1,"title":"Migration to Provider API for Kotlin/Wasm and Kotlin/JS properties","anchor":"#migration-to-provider-api-for-kotlin-wasm-and-kotlin-js-properties"},{"id":"gradle","level":0,"title":"Gradle","anchor":"#gradle"},{"id":"kotlin-gradle-plugins-compatible-with-gradle-s-isolated-projects","level":1,"title":"Kotlin Gradle plugins compatible with Gradle\u0027s Isolated Projects","anchor":"#kotlin-gradle-plugins-compatible-with-gradle-s-isolated-projects"},{"id":"support-for-adding-custom-gradle-publication-variants","level":1,"title":"Support for adding custom Gradle publication variants","anchor":"#support-for-adding-custom-gradle-publication-variants"},{"id":"standard-library","level":0,"title":"Standard library","anchor":"#standard-library"},{"id":"common-atomic-types","level":1,"title":"Common atomic types","anchor":"#common-atomic-types"},{"id":"changes-in-uuid-parsing-formatting-and-comparability","level":1,"title":"Changes in UUID parsing, formatting, and comparability","anchor":"#changes-in-uuid-parsing-formatting-and-comparability"},{"id":"new-time-tracking-functionality","level":1,"title":"New time tracking functionality","anchor":"#new-time-tracking-functionality"},{"id":"compose-compiler","level":0,"title":"Compose compiler","anchor":"#compose-compiler"},{"id":"support-for-parameters-with-default-values-in-open-composable-functions","level":1,"title":"Support for parameters with default values in open @Composable functions","anchor":"#support-for-parameters-with-default-values-in-open-composable-functions"},{"id":"final-overridden-functions-are-allowed-to-be-restartable","level":1,"title":"Final overridden functions are allowed to be restartable","anchor":"#final-overridden-functions-are-allowed-to-be-restartable"},{"id":"composablesingletons-removed-from-public-api","level":1,"title":"ComposableSingletons removed from public API","anchor":"#composablesingletons-removed-from-public-api"},{"id":"source-information-included-by-default","level":1,"title":"Source information included by default","anchor":"#source-information-included-by-default"},{"id":"breaking-changes-and-deprecations","level":0,"title":"Breaking changes and deprecations","anchor":"#breaking-changes-and-deprecations"},{"id":"documentation-updates","level":0,"title":"Documentation updates","anchor":"#documentation-updates"},{"id":"revamped-and-new-pages","level":1,"title":"Revamped and new pages","anchor":"#revamped-and-new-pages"},{"id":"new-and-updated-tutorials","level":1,"title":"New and updated tutorials","anchor":"#new-and-updated-tutorials"},{"id":"how-to-update-to-kotlin-2-1-20","level":0,"title":"How to update to Kotlin 2.1.20","anchor":"#how-to-update-to-kotlin-2-1-20"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="https://kotlinlang.org/assets/images/favicon.svg?v2"><link rel="icon" type="image/x-icon" sizes="32x32" href="https://kotlinlang.org/assets/images/favicon.ico?v2"><link rel="icon" type="image/png" sizes="96x96" href="https://kotlinlang.org/assets/images/apple-touch-icon.png?v2"><link rel="icon" type="image/png" sizes="300x300" href="https://kotlinlang.org/assets/images/apple-touch-icon-72x72.png?v2"><link rel="icon" type="image/png" sizes="500x500" href="https://kotlinlang.org/assets/images/apple-touch-icon-114x114.png?v2"><meta name="image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- Open Graph --><meta property="og:title" content="What's new in Kotlin 2.1.20 | Kotlin"><meta property="og:description" content=""><meta property="og:image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://kotlinlang.org/docs/whatsnew2120.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@kotlin"><meta name="twitter:title" content="What's new in Kotlin 2.1.20 | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@kotlin"><meta name="twitter:image:src" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://kotlinlang.org/docs/whatsnew2120.html#webpage",
    "url": "https://kotlinlang.org/docs/whatsnew2120.html",
    "name": "What's new in Kotlin 2.1.20 | Kotlin",
    "description": "",
    "image": "https://kotlinlang.org/assets/images/open-graph/docs.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://kotlinlang.org/docs/#website",
    "url": "https://kotlinlang.org/docs/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --><style>a[href="test-page.html"] { visibility: hidden; }</style></head><body data-id="whatsnew2120" data-main-title="What's new in Kotlin 2.1.20" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="What's new in Kotlin///Earlier versions" data-edit-url="https://github.com/JetBrains/kotlin-web-site/edit/master/docs/topics/whatsnew/whatsnew2120.md"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="whatsnew2120" id="whatsnew2120.md">What's new in Kotlin 2.1.20</h1><p id="-w8yckf_2"><span class="emphasis" id="-w8yckf_16"><a href="releases.html#release-details" id="-w8yckf_17">Released: March 20, 2025</a></span></p><p id="-w8yckf_3">The Kotlin 2.1.20 release is here! Here are the main highlights:</p><ul class="list _bullet" id="-w8yckf_4"><li class="list__item" id="-w8yckf_18"><p id="-w8yckf_26"><span class="control" id="-w8yckf_27">K2 compiler updates</span>: <a href="#kotlin-k2-compiler" id="-w8yckf_28">updates to the new kapt and Lombok plugins</a></p></li><li class="list__item" id="-w8yckf_19"><p id="-w8yckf_29"><span class="control" id="-w8yckf_30">Kotlin Multiplatform</span>: <a href="#kotlin-multiplatform-new-dsl-to-replace-gradle-s-application-plugin" id="-w8yckf_31">new DSL to replace Gradle's Application plugin</a></p></li><li class="list__item" id="-w8yckf_20"><p id="-w8yckf_32"><span class="control" id="-w8yckf_33">Kotlin/Native</span>: <a href="#kotlin-native" id="-w8yckf_34">support for Xcode 16.3 and a new inlining optimization</a></p></li><li class="list__item" id="-w8yckf_21"><p id="-w8yckf_35"><span class="control" id="-w8yckf_36">Kotlin/Wasm</span>: <a href="#kotlin-wasm" id="-w8yckf_37">default custom formatters, support for DWARF, and migration to Provider API</a></p></li><li class="list__item" id="-w8yckf_22"><p id="-w8yckf_38"><span class="control" id="-w8yckf_39">Gradle support</span>: <a href="#gradle" id="-w8yckf_40">compatibility with Gradle's Isolated Projects and custom publication variants</a></p></li><li class="list__item" id="-w8yckf_23"><p id="-w8yckf_41"><span class="control" id="-w8yckf_42">Standard library</span>: <a href="#standard-library" id="-w8yckf_43">common atomic types, improved UUID support, and new time-tracking functionality</a></p></li><li class="list__item" id="-w8yckf_24"><p id="-w8yckf_44"><span class="control" id="-w8yckf_45">Compose compiler</span>: <a href="#compose-compiler" id="-w8yckf_46">relaxed restrictions on <code class="code" id="-w8yckf_47">@Composable</code> functions and other updates</a></p></li><li class="list__item" id="-w8yckf_25"><p id="-w8yckf_48"><span class="control" id="-w8yckf_49">Documentation</span>: <a href="#documentation-updates" id="-w8yckf_50">notable improvements to the Kotlin documentation</a>.</p></li></ul><section class="chapter"><h2 id="ide-support" data-toc="ide-support">IDE support</h2><p id="-w8yckf_51">The Kotlin plugins that support 2.1.20 are bundled in the latest IntelliJ IDEA and Android Studio. You don't need to update the Kotlin plugin in your IDE. All you need to do is to change the Kotlin version to 2.1.20 in your build scripts.</p><p id="-w8yckf_52">See <a href="releases.html#update-to-a-new-kotlin-version" id="-w8yckf_54">Update to a new release</a> for details.</p><section class="chapter"><h3 id="download-sources-for-kotlin-artifacts-in-projects-with-osgi-support" data-toc="download-sources-for-kotlin-artifacts-in-projects-with-osgi-support">Download sources for Kotlin artifacts in projects with OSGi support</h3><p id="-w8yckf_55">Sources of all dependencies of the <code class="code" id="-w8yckf_56">kotlin-osgi-bundle</code> library are now included in its distribution. This allows IntelliJ IDEA to download these sources to provide documentation for Kotlin symbols and improve the debugging experience.</p></section></section><section class="chapter"><h2 id="kotlin-k2-compiler" data-toc="kotlin-k2-compiler">Kotlin K2 compiler</h2><p id="-w8yckf_57">We're continuing to improve plugin support for the new Kotlin K2 compiler. This release brings updates to the new kapt and Lombok plugins.</p><section class="chapter"><h3 id="new-default-kapt-plugin" data-toc="new-default-kapt-plugin" data-label-id="beta">New default kapt plugin</h3><p id="-w8yckf_61">Starting with Kotlin 2.1.20, the K2 implementation of the kapt compiler plugin is enabled by default for all the projects.</p><p id="-w8yckf_62">The JetBrains team launched the new implementation of the kapt plugin with the K2 compiler back in Kotlin 1.9.20. Since then, we have further developed the internal implementation of K2 kapt and made its behavior similar to that of the K1 version, while significantly improving its performance as well.</p><p id="-w8yckf_63">If you encounter any issues when using kapt with the K2 compiler, you can temporarily revert to the previous plugin implementation.</p><p id="-w8yckf_64">To do this, add the following option to the <code class="code" id="-w8yckf_67">gradle.properties</code> file of your project:</p><div class="code-block" data-lang="kotlin">
kapt.use.k2=false
</div><p id="-w8yckf_66">Please report any issues to our <a href="https://youtrack.jetbrains.com/issue/KT-71439/K2-kapt-feedback" id="-w8yckf_68" data-external="true" rel="noopener noreferrer" target="_blank">issue tracker</a>.</p></section><section class="chapter"><h3 id="lombok-compiler-plugin-support-for-superbuilder-and-updates-on-builder" data-toc="lombok-compiler-plugin-support-for-superbuilder-and-updates-on-builder" data-label-id="experimental-general">Lombok compiler plugin: support for <code class="code" id="-w8yckf_75">@SuperBuilder</code> and updates on <code class="code" id="-w8yckf_76">@Builder</code></h3><p id="-w8yckf_71">The <a href="lombok.html" id="-w8yckf_77">Kotlin Lombok compiler plugin</a> now supports the <code class="code" id="-w8yckf_78">@SuperBuilder</code> annotation, making it easier to create builders for class hierarchies. Previously, developers using Lombok in Kotlin had to manually define builders when working with inheritance. With <code class="code" id="-w8yckf_79">@SuperBuilder</code>, the builder automatically inherits superclass fields, allowing you to initialize them when constructing an object.</p><p id="-w8yckf_72">Additionally, this update includes several improvements and bug fixes:</p><ul class="list _bullet" id="-w8yckf_73"><li class="list__item" id="-w8yckf_80"><p id="-w8yckf_82">The <code class="code" id="-w8yckf_83">@Builder</code> annotation now works on constructors, allowing more flexible object creation. For more details, see the corresponding <a href="https://youtrack.jetbrains.com/issue/KT-71547" id="-w8yckf_84" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack issue</a>.</p></li><li class="list__item" id="-w8yckf_81"><p id="-w8yckf_85">Several issues related to Lombok's code generation in Kotlin have been resolved, improving overall compatibility. For more details, see the <a href="https://github.com/JetBrains/kotlin/releases/tag/v2.1.20" id="-w8yckf_86" data-external="true" rel="noopener noreferrer" target="_blank">GitHub changelog</a>.</p></li></ul><p id="-w8yckf_74">For more information about the <code class="code" id="-w8yckf_87">@SuperBuilder</code> annotation, see the official <a href="https://projectlombok.org/features/experimental/SuperBuilder" id="-w8yckf_88" data-external="true" rel="noopener noreferrer" target="_blank">Lombok documentation</a>.</p></section></section><section class="chapter"><h2 id="kotlin-multiplatform-new-dsl-to-replace-gradle-s-application-plugin" data-toc="kotlin-multiplatform-new-dsl-to-replace-gradle-s-application-plugin" data-label-id="experimental-opt-in">Kotlin Multiplatform: new DSL to replace Gradle's Application plugin</h2><p id="-w8yckf_90">Starting with Gradle 8.7, the <a href="https://docs.gradle.org/current/userguide/application_plugin.html" id="-w8yckf_97" data-external="true" rel="noopener noreferrer" target="_blank">Application</a> plugin is no longer compatible with the Kotlin Multiplatform Gradle plugin. Kotlin 2.1.20 introduces an Experimental DSL to achieve similar functionality. The new <code class="code" id="-w8yckf_98">executable {}</code> block configures execution tasks and Gradle <a href="https://docs.gradle.org/current/userguide/distribution_plugin.html#distribution_plugin" id="-w8yckf_99" data-external="true" rel="noopener noreferrer" target="_blank">distributions</a> for JVM targets.</p><p id="-w8yckf_91">Before the <code class="code" id="-w8yckf_100">executable {}</code> block in your build script, add the following <code class="code" id="-w8yckf_101">@OptIn</code> annotation:</p><div class="code-block" data-lang="kotlin">
@OptIn(ExperimentalKotlinGradlePluginApi::class)
</div><p id="-w8yckf_93">For example:</p><div class="code-block" data-lang="kotlin">
kotlin {
    jvm {
        @OptIn(ExperimentalKotlinGradlePluginApi::class)
        binaries {
            // Configures a JavaExec task named &quot;runJvm&quot; and a Gradle distribution for the &quot;main&quot; compilation in this target
            executable {
                mainClass.set(&quot;foo.MainKt&quot;)
            }

            // Configures a JavaExec task named &quot;runJvmAnother&quot; and a Gradle distribution for the &quot;main&quot; compilation
            executable(KotlinCompilation.MAIN_COMPILATION_NAME, &quot;another&quot;) {
                // Set a different class
                mainClass.set(&quot;foo.MainAnotherKt&quot;)
            }

            // Configures a JavaExec task named &quot;runJvmTest&quot; and a Gradle distribution for the &quot;test&quot; compilation
            executable(KotlinCompilation.TEST_COMPILATION_NAME) {
                mainClass.set(&quot;foo.MainTestKt&quot;)
            }

            // Configures a JavaExec task named &quot;runJvmTestAnother&quot; and a Gradle distribution for the &quot;test&quot; compilation
            executable(KotlinCompilation.TEST_COMPILATION_NAME, &quot;another&quot;) {
                mainClass.set(&quot;foo.MainAnotherTestKt&quot;)
            }
        }
    }
}
</div><p id="-w8yckf_95">In this example, Gradle's <a href="https://docs.gradle.org/current/userguide/distribution_plugin.html#distribution_plugin" id="-w8yckf_102" data-external="true" rel="noopener noreferrer" target="_blank">Distribution</a> plugin is applied on the first <code class="code" id="-w8yckf_103">executable {}</code> block.</p><p id="-w8yckf_96">If you run into any issues, report them in our <a href="https://kotl.in/issue" id="-w8yckf_104" data-external="true" rel="noopener noreferrer" target="_blank">issue tracker</a> or let us know in our <a href="https://kotlinlang.slack.com/archives/C19FD9681" id="-w8yckf_105" data-external="true" rel="noopener noreferrer" target="_blank">public Slack channel</a>.</p></section><section class="chapter"><h2 id="kotlin-native" data-toc="kotlin-native">Kotlin/Native</h2><section class="chapter"><h3 id="support-for-xcode-16-3" data-toc="support-for-xcode-16-3">Support for Xcode 16.3</h3><p id="-w8yckf_108">Starting with Kotlin <span class="control" id="-w8yckf_110">2.1.21</span>, the Kotlin/Native compiler supports Xcode 16.3 &ndash; the latest stable version of Xcode. Feel free to update your Xcode and continue working on your Kotlin projects for Apple operating systems.</p><p id="-w8yckf_109">The 2.1.21 release also fixes the related <a href="https://youtrack.jetbrains.com/issue/KT-75781/" id="-w8yckf_111" data-external="true" rel="noopener noreferrer" target="_blank">cinterop issue</a> that caused compilation failures in Kotlin Multiplatform projects.</p></section><section class="chapter"><h3 id="new-inlining-optimization" data-toc="new-inlining-optimization" data-label-id="experimental-opt-in">New inlining optimization</h3><p id="-w8yckf_113">Kotlin 2.1.20 introduces a new inlining optimization pass, which comes before the actual code generation phase.</p><p id="-w8yckf_114">The new inlining pass in the Kotlin/Native compiler should perform better than the standard LLVM inliner and improve the runtime performance of the generated code.</p><p id="-w8yckf_115">The new inlining pass is currently <a href="components-stability.html#stability-levels-explained" id="-w8yckf_119">Experimental</a>. To try it out, use the following compiler option:</p><div class="code-block" data-lang="none">
-Xbinary=preCodegenInlineThreshold=40
</div><p id="-w8yckf_117">Our experiments show that setting the threshold to 40 tokens (code units parsed by the compiler) provides a reasonable compromise for compilation optimization. According to our benchmarks, this gives an overall performance improvement of 9.5%. Of course, you can try out other values, too.</p><p id="-w8yckf_118">If you experience increased binary size or compilation time, please report such issues via <a href="https://kotl.in/issue" id="-w8yckf_120" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section></section><section class="chapter"><h2 id="kotlin-wasm" data-toc="kotlin-wasm">Kotlin/Wasm</h2><p id="-w8yckf_121">This release improves Kotlin/Wasm debugging and property usage. Custom formatters now work out of the box in development builds, while DWARF debugging facilitates code inspection. Additionally, the Provider API simplifies property usage in Kotlin/Wasm and Kotlin/JS.</p><section class="chapter"><h3 id="custom-formatters-enabled-by-default" data-toc="custom-formatters-enabled-by-default">Custom formatters enabled by default</h3><p id="-w8yckf_125">Before, you had to <a href="whatsnew21.html#improved-debugging-experience-for-kotlin-wasm" id="-w8yckf_131">manually configure</a> custom formatters to improve debugging in web browsers when working with Kotlin/Wasm code.</p><p id="-w8yckf_126">In this release, custom formatters are enabled by default in development builds, so you don't need additional Gradle configurations.</p><p id="-w8yckf_127">To use this feature, you only need to ensure that custom formatters are enabled in your browser's developer tools:</p><ul class="list _bullet" id="-w8yckf_128"><li class="list__item" id="-w8yckf_132"><p id="-w8yckf_134">In Chrome DevTools, find the custom formatters checkbox in <span class="control" id="-w8yckf_136">Settings | Preferences | Console</span>:</p><figure id="-w8yckf_135"><img alt="Enable custom formatters in Chrome" src="images/wasm-custom-formatters-chrome.png" title="Enable custom formatters in Chrome" width="400" height="410"></figure></li><li class="list__item" id="-w8yckf_133"><p id="-w8yckf_137">In Firefox DevTools, find the custom formatters checkbox in <span class="control" id="-w8yckf_139">Settings | Advanced settings</span>:</p><figure id="-w8yckf_138"><img alt="Enable custom formatters in Firefox" src="images/wasm-custom-formatters-firefox.png" title="Enable custom formatters in Firefox" width="400" height="309"></figure></li></ul><p id="-w8yckf_129">This change primarily affects Kotlin/Wasm development builds. If you have specific requirements for production builds, you need to adjust your Gradle configuration accordingly. To do so, add the following compiler option to the <code class="code" id="-w8yckf_140">wasmJs {}</code> block:</p><div class="code-block" data-lang="kotlin">
// build.gradle.kts
kotlin {
    wasmJs {
        // ...

        compilerOptions {
            freeCompilerArgs.add(&quot;-Xwasm-debugger-custom-formatters&quot;)
        }
    }
}
</div></section><section class="chapter"><h3 id="support-for-dwarf-to-debug-kotlin-wasm-code" data-toc="support-for-dwarf-to-debug-kotlin-wasm-code">Support for DWARF to debug Kotlin/Wasm code</h3><p id="-w8yckf_141">Kotlin 2.1.20 introduces support for DWARF (debugging with arbitrary record format) in Kotlin/Wasm.</p><p id="-w8yckf_142">With this change, the Kotlin/Wasm compiler is able to embed DWARF data into the generated WebAssembly (Wasm) binary. Many debuggers and virtual machines can read this data to provide insights into the compiled code.</p><p id="-w8yckf_143">DWARF is mainly useful for debugging Kotlin/Wasm applications inside standalone Wasm virtual machines (VMs). To use this feature, the Wasm VM and debugger must support DWARF.</p><p id="-w8yckf_144">With DWARF support, you can step through Kotlin/Wasm applications, inspect variables, and gain code insights. To enable this feature, use the following compiler option:</p><div class="code-block" data-lang="bash">
-Xwasm-generate-dwarf
</div></section><section class="chapter"><h3 id="migration-to-provider-api-for-kotlin-wasm-and-kotlin-js-properties" data-toc="migration-to-provider-api-for-kotlin-wasm-and-kotlin-js-properties">Migration to Provider API for Kotlin/Wasm and Kotlin/JS properties</h3><p id="-w8yckf_146">Previously, properties in Kotlin/Wasm and Kotlin/JS extensions were mutable (<code class="code" id="-w8yckf_156">var</code>) and assigned directly in build scripts:</p><div class="code-block" data-lang="kotlin">
the&lt;NodeJsExtension&gt;().version = &quot;2.0.0&quot;
</div><p id="-w8yckf_148">Now, properties are exposed through the <a href="https://docs.gradle.org/current/userguide/properties_providers.html" id="-w8yckf_157" data-external="true" rel="noopener noreferrer" target="_blank">Provider API</a>, and you must use the <code class="code" id="-w8yckf_158">.set()</code> function to assign values:</p><div class="code-block" data-lang="kotlin">
the&lt;NodeJsEnvSpec&gt;().version.set(&quot;2.0.0&quot;)
</div><p id="-w8yckf_150">The Provider API ensures that values are lazily computed and properly integrated with task dependencies, improving build performance.</p><p id="-w8yckf_151">With this change, direct property assignments are deprecated in favor of <code class="code" id="-w8yckf_159">*EnvSpec</code> classes, such as <code class="code" id="-w8yckf_160">NodeJsEnvSpec</code> and <code class="code" id="-w8yckf_161">YarnRootEnvSpec</code>.</p><p id="-w8yckf_152">Additionally, several alias tasks have been removed to avoid confusion:</p><div class="table-wrapper"><table class="wide" id="-w8yckf_153"><thead><tr class="ijRowHead" id="-w8yckf_162"><th id="-w8yckf_171"><p>Deprecated task</p></th><th id="-w8yckf_172"><p>Replacement</p></th></tr></thead><tbody><tr id="-w8yckf_163"><td id="-w8yckf_173"><p><code class="code" id="-w8yckf_175">wasmJsRun</code></p></td><td id="-w8yckf_174"><p><code class="code" id="-w8yckf_176">wasmJsBrowserDevelopmentRun</code></p></td></tr><tr id="-w8yckf_164"><td id="-w8yckf_177"><p><code class="code" id="-w8yckf_179">wasmJsBrowserRun</code></p></td><td id="-w8yckf_178"><p><code class="code" id="-w8yckf_180">wasmJsBrowserDevelopmentRun</code></p></td></tr><tr id="-w8yckf_165"><td id="-w8yckf_181"><p><code class="code" id="-w8yckf_183">wasmJsNodeRun</code></p></td><td id="-w8yckf_182"><p><code class="code" id="-w8yckf_184">wasmJsNodeDevelopmentRun</code></p></td></tr><tr id="-w8yckf_166"><td id="-w8yckf_185"><p><code class="code" id="-w8yckf_187">wasmJsBrowserWebpack</code></p></td><td id="-w8yckf_186"><p><code class="code" id="-w8yckf_188">wasmJsBrowserProductionWebpack</code> or <code class="code" id="-w8yckf_189">wasmJsBrowserDistribution</code></p></td></tr><tr id="-w8yckf_167"><td id="-w8yckf_190"><p><code class="code" id="-w8yckf_192">jsRun</code></p></td><td id="-w8yckf_191"><p><code class="code" id="-w8yckf_193">jsBrowserDevelopmentRun</code></p></td></tr><tr id="-w8yckf_168"><td id="-w8yckf_194"><p><code class="code" id="-w8yckf_196">jsBrowserRun</code></p></td><td id="-w8yckf_195"><p><code class="code" id="-w8yckf_197">jsBrowserDevelopmentRun</code></p></td></tr><tr id="-w8yckf_169"><td id="-w8yckf_198"><p><code class="code" id="-w8yckf_200">jsNodeRun</code></p></td><td id="-w8yckf_199"><p><code class="code" id="-w8yckf_201">jsNodeDevelopmentRun</code></p></td></tr><tr id="-w8yckf_170"><td id="-w8yckf_202"><p><code class="code" id="-w8yckf_204">jsBrowserWebpack</code></p></td><td id="-w8yckf_203"><p><code class="code" id="-w8yckf_205">jsBrowserProductionWebpack</code> or <code class="code" id="-w8yckf_206">jsBrowserDistribution</code></p></td></tr></tbody></table></div><p id="-w8yckf_154">If you only use Kotlin/JS or Kotlin/Wasm in build scripts, no action is required as Gradle automatically handles assignments.</p><p id="-w8yckf_155">However, if you maintain a plugin based on the Kotlin Gradle Plugin, and your plugin does not apply <code class="code" id="-w8yckf_207">kotlin-dsl</code>, you must update property assignments to use the <code class="code" id="-w8yckf_208">.set()</code> function.</p></section></section><section class="chapter"><h2 id="gradle" data-toc="gradle">Gradle</h2><p id="-w8yckf_209">Kotlin 2.1.20 is fully compatible with Gradle 7.6.3 through 8.11. You can also use Gradle versions up to the latest Gradle release. However, be aware that doing so may result in deprecation warnings, and some new Gradle features might not work.</p><p id="-w8yckf_210">This version of Kotlin includes compatibility of Kotlin Gradle plugins with Gradle's Isolated Projects as well as support for custom Gradle publication variants.</p><section class="chapter"><h3 id="kotlin-gradle-plugins-compatible-with-gradle-s-isolated-projects" data-toc="kotlin-gradle-plugins-compatible-with-gradle-s-isolated-projects" data-label-id="experimental-opt-in">Kotlin Gradle plugins compatible with Gradle's Isolated Projects</h3><aside class="prompt" data-type="warning" data-title="" id="-w8yckf_214"><p id="-w8yckf_223">This feature is currently in a pre-Alpha state in Gradle. JS and Wasm targets are not supported at the moment. Use it only with Gradle version 8.10 or higher and solely for evaluation purposes.</p></aside><p id="-w8yckf_215">Since Kotlin 2.1.0, you've been able to <a href="whatsnew21.html#preview-gradle-s-isolated-projects-in-kotlin-multiplatform" id="-w8yckf_224">preview Gradle's Isolated Projects feature</a> in your projects.</p><p id="-w8yckf_216">Previously, you had to configure the Kotlin Gradle plugin to make your project compatible with the Isolated Projects feature before you could try it out. In Kotlin 2.1.20, this additional step is no longer necessary.</p><p id="-w8yckf_217">Now, to enable the Isolated Projects feature, you only need to <a href="https://docs.gradle.org/current/userguide/isolated_projects.html#how_do_i_use_it" id="-w8yckf_225" data-external="true" rel="noopener noreferrer" target="_blank">set the system property</a>.</p><p id="-w8yckf_218">Gradle's Isolated Projects feature is supported in Kotlin Gradle plugins for both multiplatform projects and projects that contain only the JVM or Android target.</p><p id="-w8yckf_219">Specifically for multiplatform projects, if you notice problems with your Gradle build after upgrading, you can opt out of the new Kotlin Gradle plugin behavior by adding:</p><div class="code-block" data-lang="none">
kotlin.kmp.isolated-projects.support=disable
</div><p id="-w8yckf_221">However, if you use this Gradle property in your multiplatform project, you can't use the Isolated Projects feature.</p><p id="-w8yckf_222">Let us know about your experience with this feature in <a href="https://youtrack.jetbrains.com/issue/KT-57279/Support-Gradle-Project-Isolation-Feature-for-Kotlin-Multiplatform" id="-w8yckf_226" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section><section class="chapter"><h3 id="support-for-adding-custom-gradle-publication-variants" data-toc="support-for-adding-custom-gradle-publication-variants" data-label-id="experimental-opt-in">Support for adding custom Gradle publication variants</h3><p id="-w8yckf_228">Kotlin 2.1.20 introduces support for adding custom <a href="https://docs.gradle.org/current/userguide/variant_attributes.html" id="-w8yckf_234" data-external="true" rel="noopener noreferrer" target="_blank">Gradle publication variants</a>. This feature is available for multiplatform projects and projects targeting the JVM.</p><aside class="prompt" data-type="note" data-title="" id="-w8yckf_229"><p id="-w8yckf_235">You cannot modify existing Gradle variants with this feature.</p></aside><p id="-w8yckf_230">This feature is <a href="components-stability.html#stability-levels-explained" id="-w8yckf_236">Experimental</a>. To opt in, use the <code class="code" id="-w8yckf_237">@OptIn(ExperimentalKotlinGradlePluginApi::class)</code> annotation.</p><p id="-w8yckf_231">To add a custom Gradle publication variant, invoke the <code class="code" id="-w8yckf_238">adhocSoftwareComponent()</code> function, which returns an instance of <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/component/AdhocComponentWithVariants.html" id="-w8yckf_239" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_240">AdhocComponentWithVariants</code></a> that you can configure in the Kotlin DSL:</p><div class="code-block" data-lang="kotlin">
plugins {
    // Only JVM and Multiplatform are supported
    kotlin(&quot;jvm&quot;)
    // or
    kotlin(&quot;multiplatform&quot;)
}


kotlin {
    @OptIn(ExperimentalKotlinGradlePluginApi::class)
    publishing {
        // Returns an instance of AdhocSoftwareComponent
        adhocSoftwareComponent()
        // Alternatively, you can configure AdhocSoftwareComponent in the DSL block as follows
        adhocSoftwareComponent {
            // Add your custom variants here using the AdhocSoftwareComponent API
        }
    }
}
</div><aside class="prompt" data-type="tip" data-title="" id="-w8yckf_233"><p id="-w8yckf_241">For more information on variants, see Gradle's <a href="https://docs.gradle.org/current/userguide/publishing_customization.html" id="-w8yckf_242" data-external="true" rel="noopener noreferrer" target="_blank">Customizing publishing guide</a>.</p></aside></section></section><section class="chapter"><h2 id="standard-library" data-toc="standard-library">Standard library</h2><p id="-w8yckf_243">This release brings new Experimental features to the standard library: common atomic types, improved support for UUIDs, and new time-tracking functionality.</p><section class="chapter"><h3 id="common-atomic-types" data-toc="common-atomic-types" data-label-id="experimental-opt-in">Common atomic types</h3><p id="-w8yckf_248">In Kotlin 2.1.20, we are introducing common atomic types in the standard library's <code class="code" id="-w8yckf_255">kotlin.concurrent.atomics</code> package, enabling shared, platform-independent code for thread-safe operations. This simplifies development for Kotlin Multiplatform projects by removing the need to duplicate atomic-dependent logic across source sets.</p><p id="-w8yckf_249">The <code class="code" id="-w8yckf_256">kotlin.concurrent.atomics</code> package and its properties are <a href="components-stability.html#stability-levels-explained" id="-w8yckf_257">Experimental</a>. To opt in, use the <code class="code" id="-w8yckf_258">@OptIn(ExperimentalAtomicApi::class)</code> annotation or the compiler option <code class="code" id="-w8yckf_259">-opt-in=kotlin.ExperimentalAtomicApi</code>.</p><p id="-w8yckf_250">Here's an example that shows how you can use <code class="code" id="-w8yckf_260">AtomicInt</code> to safely count processed items across multiple threads:</p><div class="code-block" data-lang="kotlin" data-runnable="true" data-min-compiler-version="2.1.20">
// Imports the necessary libraries
import kotlin.concurrent.atomics.*
import kotlinx.coroutines.*

//sampleStart
@OptIn(ExperimentalAtomicApi::class)
suspend fun main() {
    // Initializes the atomic counter for processed items
    var processedItems = AtomicInt(0)
    val totalItems = 100
    val items = List(totalItems) { &quot;item$it&quot; }
    // Splits the items into chunks for processing by multiple coroutines
    val chunkSize = 20
    val itemChunks = items.chunked(chunkSize)
    coroutineScope {
        for (chunk in itemChunks) {
            launch {
                for (item in chunk) {
                    println(&quot;Processing $item in thread ${Thread.currentThread()}&quot;)
                    processedItems += 1 // Increment counter atomically
                }
            }
         }
    }
//sampleEnd
    // Prints the total number of processed items
    println(&quot;Total processed items: ${processedItems.load()}&quot;)
}
</div><p id="-w8yckf_252">To enable seamless interoperability between Kotlin's atomic types and Java's <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html" id="-w8yckf_261" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_264">java.util.concurrent.atomic</code></a> atomic types, the API provides the <code class="code" id="-w8yckf_262">.asJavaAtomic()</code> and <code class="code" id="-w8yckf_263">.asKotlinAtomic()</code> extension functions. On the JVM, Kotlin atomics and Java atomics are the same types in runtime, so you can transform Java atomics into Kotlin atomics and vice versa without any overhead.</p><p id="-w8yckf_253">Here's an example that shows how Kotlin and Java atomic types can work together:</p><div class="code-block" data-lang="kotlin" data-runnable="true" data-min-compiler-version="2.1.20">
// Imports the necessary libraries
import kotlin.concurrent.atomics.*
import java.util.concurrent.atomic.*

//sampleStart
@OptIn(ExperimentalAtomicApi::class)
fun main() {
    // Converts Kotlin AtomicInt to Java's AtomicInteger
    val kotlinAtomic = AtomicInt(42)
    val javaAtomic: AtomicInteger = kotlinAtomic.asJavaAtomic()
    println(&quot;Java atomic value: ${javaAtomic.get()}&quot;)
    // Java atomic value: 42

    // Converts Java's AtomicInteger back to Kotlin's AtomicInt
    val kotlinAgain: AtomicInt = javaAtomic.asKotlinAtomic()
    println(&quot;Kotlin atomic value: ${kotlinAgain.load()}&quot;)
    // Kotlin atomic value: 42
}
//sampleEnd
</div></section><section class="chapter"><h3 id="changes-in-uuid-parsing-formatting-and-comparability" data-toc="changes-in-uuid-parsing-formatting-and-comparability" data-label-id="experimental-opt-in">Changes in UUID parsing, formatting, and comparability</h3><p id="-w8yckf_266">The JetBrains team continues to improve the support for UUIDs <a href="whatsnew2020.html#support-for-uuids-in-the-common-kotlin-standard-library" id="-w8yckf_274">introduced to the standard library in 2.0.20</a>.</p><p id="-w8yckf_267">Previously, the <code class="code" id="-w8yckf_275">parse()</code> function only accepted UUIDs in the hex-and-dash format. With Kotlin 2.1.20, you can use <code class="code" id="-w8yckf_276">parse()</code> for <span class="emphasis" id="-w8yckf_277">both</span> the hex-and-dash and the plain hexadecimal (without dashes) formats.</p><p id="-w8yckf_268">We've also introduced functions specific to operations with the hex-and-dash format in this release:</p><ul class="list _bullet" id="-w8yckf_269"><li class="list__item" id="-w8yckf_278"><p id="-w8yckf_280"><code class="code" id="-w8yckf_281">parseHexDash()</code> parses UUIDs from the hex-and-dash format.</p></li><li class="list__item" id="-w8yckf_279"><p id="-w8yckf_282"><code class="code" id="-w8yckf_283">toHexDashString()</code> converts a <code class="code" id="-w8yckf_284">Uuid</code> into a <code class="code" id="-w8yckf_285">String</code> in the hex-and-dash format (mirroring the functionality of <code class="code" id="-w8yckf_286">toString()</code>).</p></li></ul><p id="-w8yckf_270">These functions work similarly to <a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin.uuid/-uuid/-companion/parse-hex.html" id="-w8yckf_287" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_289">parseHex()</code></a> and <a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin.uuid/-uuid/to-hex-string.html" id="-w8yckf_288" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_290">toHexString()</code></a>, which were introduced earlier for the hexadecimal format. Explicit naming for parsing and formatting functionality should improve code clarity and your overall experience with UUIDs.</p><p id="-w8yckf_271">UUIDs in Kotlin are now <code class="code" id="-w8yckf_291">Comparable</code>. Starting with Kotlin 2.1.20, you can directly compare and sort values of the <code class="code" id="-w8yckf_292">Uuid</code> type. This enables the use of the <code class="code" id="-w8yckf_293">&lt;</code> and <code class="code" id="-w8yckf_294">&gt;</code> operators and standard library extensions available exclusively for <code class="code" id="-w8yckf_295">Comparable</code> types or their collections (such as <code class="code" id="-w8yckf_296">sorted()</code>), and it also allows passing UUIDs to any functions or APIs that require the <code class="code" id="-w8yckf_297">Comparable</code> interface.</p><p id="-w8yckf_272">Remember that the UUID support in the standard library is still <a href="components-stability.html#stability-levels-explained" id="-w8yckf_298">Experimental</a>. To opt in, use the <code class="code" id="-w8yckf_299">@OptIn(ExperimentalUuidApi::class)</code> annotation or the compiler option <code class="code" id="-w8yckf_300">-opt-in=kotlin.uuid.ExperimentalUuidApi</code>:</p><div class="code-block" data-lang="kotlin" data-runnable="true" data-min-compiler-version="2.1.20">
import kotlin.uuid.ExperimentalUuidApi
import kotlin.uuid.Uuid

//sampleStart
@OptIn(ExperimentalUuidApi::class)
fun main() {
    // parse() accepts a UUID in a plain hexadecimal format
    val uuid = Uuid.parse(&quot;550e8400e29b41d4a716446655440000&quot;)

    // Converts it to the hex-and-dash format
    val hexDashFormat = uuid.toHexDashString()
 
    // Outputs the UUID in the hex-and-dash format
    println(hexDashFormat)

    // Outputs UUIDs in ascending order
    println(
        listOf(
            uuid,
            Uuid.parse(&quot;780e8400e29b41d4a716446655440005&quot;),
            Uuid.parse(&quot;5ab88400e29b41d4a716446655440076&quot;)
        ).sorted()
    )
   }
//sampleEnd
</div></section><section class="chapter"><h3 id="new-time-tracking-functionality" data-toc="new-time-tracking-functionality" data-label-id="experimental-opt-in">New time tracking functionality</h3><p id="-w8yckf_302">Starting with Kotlin 2.1.20, the standard library provides the ability to represent a moment in time. This functionality was previously only available in <a href="https://kotlinlang.org/api/kotlinx-datetime/" id="-w8yckf_310" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_311">kotlinx-datetime</code></a>, an official Kotlin library.</p><p id="-w8yckf_303">The <a href="https://kotlinlang.org/api/kotlinx-datetime/kotlinx-datetime/kotlinx.datetime/-clock/" id="-w8yckf_312" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_318">kotlinx.datetime.Clock</code></a> interface is introduced to the standard library as <code class="code" id="-w8yckf_313">kotlin.time.Clock</code> and the <a href="https://kotlinlang.org/api/kotlinx-datetime/kotlinx-datetime/kotlinx.datetime/-instant/" id="-w8yckf_314" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-w8yckf_319">kotlinx.datetime.Instant</code></a> class as <code class="code" id="-w8yckf_315">kotlin.time.Instant</code>. These concepts naturally align with the <code class="code" id="-w8yckf_316">time</code> package in the standard library because they're only concerned with moments in time compared to a more complex calendar and timezone functionality that remains in <code class="code" id="-w8yckf_317">kotlinx-datetime</code>.</p><p id="-w8yckf_304"><code class="code" id="-w8yckf_320">Instant</code> and <code class="code" id="-w8yckf_321">Clock</code> are useful when you need precise time tracking without considering time zones or dates. For example, you can use them to log events with timestamps, measure durations between two points in time, and obtain the current moment for system processes.</p><p id="-w8yckf_305">To provide interoperability with other languages, additional converter functions are available:</p><ul class="list _bullet" id="-w8yckf_306"><li class="list__item" id="-w8yckf_322"><p id="-w8yckf_325"><code class="code" id="-w8yckf_326">.toKotlinInstant()</code> converts a time value to a <code class="code" id="-w8yckf_327">kotlin.time.Instant</code> instance.</p></li><li class="list__item" id="-w8yckf_323"><p id="-w8yckf_328"><code class="code" id="-w8yckf_329">.toJavaInstant()</code> converts the <code class="code" id="-w8yckf_330">kotlin.time.Instant</code> value to a <code class="code" id="-w8yckf_331">java.time.Instant</code> value.</p></li><li class="list__item" id="-w8yckf_324"><p id="-w8yckf_332"><code class="code" id="-w8yckf_333">Instant.toJSDate()</code> converts the <code class="code" id="-w8yckf_334">kotlin.time.Instant</code> value to an instance of the JS <code class="code" id="-w8yckf_335">Date</code> class. This conversion is not precise; JS uses millisecond precision to represent dates, while Kotlin allows for nanosecond resolution.</p></li></ul><p id="-w8yckf_307">The new time features of the standard library are still <a href="components-stability.html#stability-levels-explained" id="-w8yckf_336">Experimental</a>. To opt in, use the <code class="code" id="-w8yckf_337">@OptIn(ExperimentalTime::class)</code> annotation:</p><div class="code-block" data-lang="kotlin" data-runnable="true" data-min-compiler-version="2.1.20">
import kotlin.time.*

@OptIn(ExperimentalTime::class)
fun main() {

    // Get the current moment in time
    val currentInstant = Clock.System.now()
    println(&quot;Current time: $currentInstant&quot;)

    // Find the difference between two moments in time
    val pastInstant = Instant.parse(&quot;2023-01-01T00:00:00Z&quot;)
    val duration = currentInstant - pastInstant

    println(&quot;Time elapsed since 2023-01-01: $duration&quot;)
}
</div><p id="-w8yckf_309">For more information on the implementation, see this <a href="https://github.com/Kotlin/KEEP/pull/387/files" id="-w8yckf_338" data-external="true" rel="noopener noreferrer" target="_blank">KEEP proposal</a>.</p></section></section><section class="chapter"><h2 id="compose-compiler" data-toc="compose-compiler">Compose compiler</h2><p id="-w8yckf_339">In 2.1.20, the Compose compiler relaxes some restrictions on <code class="code" id="-w8yckf_344">@Composable</code> functions introduced in previous releases. In addition, the Compose compiler Gradle plugin is set to include source information by default, aligning the behavior on all platforms with Android.</p><section class="chapter"><h3 id="support-for-parameters-with-default-values-in-open-composable-functions" data-toc="support-for-parameters-with-default-values-in-open-composable-functions">Support for parameters with default values in open <code class="code" id="-w8yckf_349">@Composable</code> functions</h3><p id="-w8yckf_346">The compiler previously restricted parameters with default values in open <code class="code" id="-w8yckf_350">@Composable</code> functions due to incorrect compiler output, which would result in crashes at runtime. The underlying issue is now resolved, and parameters with default values are fully supported when used with Kotlin 2.1.20 or newer.</p><p id="-w8yckf_347">Compose compiler allowed parameters with default values in open functions before <a href="https://developer.android.com/jetpack/androidx/releases/compose-compiler#1.5.8" id="-w8yckf_351" data-external="true" rel="noopener noreferrer" target="_blank">version 1.5.8</a>, so the support depends on project configuration:</p><ul class="list _bullet" id="-w8yckf_348"><li class="list__item" id="-w8yckf_352"><p id="-w8yckf_354">If an open composable function is compiled with Kotlin version 2.1.20 or newer, the compiler generates correct wrappers for parameters with default values. This includes wrappers compatible with pre-1.5.8 binaries, meaning that downstream libraries will also be able to use this open function.</p></li><li class="list__item" id="-w8yckf_353"><p id="-w8yckf_355">If the open composable function is compiled with Kotlin older than 2.1.20, Compose uses a compatibility mode, which might result in runtime crashes. When using the compatibility mode, the compiler emits a warning to highlight potential problems.</p></li></ul></section><section class="chapter"><h3 id="final-overridden-functions-are-allowed-to-be-restartable" data-toc="final-overridden-functions-are-allowed-to-be-restartable">Final overridden functions are allowed to be restartable</h3><p id="-w8yckf_356">Virtual functions (overrides of <code class="code" id="-w8yckf_358">open</code> and <code class="code" id="-w8yckf_359">abstract</code>, including interfaces) <a href="whatsnew21.html#changes-to-open-and-overridden-composable-functions" id="-w8yckf_360">were forced to be non-restartable with the 2.1.0 release</a>. This restriction is now relaxed for functions that are members of final classes or are <code class="code" id="-w8yckf_361">final</code> themselves &ndash; they will be restarted or skipped as usual.</p><p id="-w8yckf_357">You might observe some behavior changes in affected functions after upgrading to Kotlin 2.1.20. To force non-restartable logic from the previous version, apply the <code class="code" id="-w8yckf_362">@NonRestartableComposable</code> annotation to the function.</p></section><section class="chapter"><h3 id="composablesingletons-removed-from-public-api" data-toc="composablesingletons-removed-from-public-api"><code class="code" id="-w8yckf_366">ComposableSingletons</code> removed from public API</h3><p id="-w8yckf_364"><code class="code" id="-w8yckf_367">ComposableSingletons</code> is a class created by the Compose compiler when optimizing <code class="code" id="-w8yckf_368">@Composable</code> lambdas. Lambdas that do not capture any parameters are allocated once and cached in a property of the class, saving allocations during runtime. The class is generated with internal visibility and is only intended for optimizing lambdas inside a compilation unit (usually a file).</p><p id="-w8yckf_365">However, this optimization was also applied to <code class="code" id="-w8yckf_369">inline</code> function bodies, which resulted in singleton lambda instances leaking into the public API. To fix this problem, starting with 2.1.20, <code class="code" id="-w8yckf_370">@Composable</code> lambdas are no longer optimized into singletons inside inline functions. At the same time, the Compose compiler will continue generating singleton classes and lambdas for inline functions to support binary compatibility for modules that were compiled under the previous model.</p></section><section class="chapter"><h3 id="source-information-included-by-default" data-toc="source-information-included-by-default">Source information included by default</h3><p id="-w8yckf_371">The Compose compiler Gradle plugin already has the <a href="https://kotlinlang.org/api/kotlin-gradle-plugin/compose-compiler-gradle-plugin/org.jetbrains.kotlin.compose.compiler.gradle/-compose-compiler-gradle-plugin-extension/include-source-information.html" id="-w8yckf_373" data-external="true" rel="noopener noreferrer" target="_blank">including source information</a> feature enabled by default on Android. Starting with Kotlin 2.1.20, this feature will be enabled by default on all platforms.</p><p id="-w8yckf_372">Remember to check if you set this option using <code class="code" id="-w8yckf_374">freeCompilerArgs</code>. This method can cause the build to fail when used alongside the plugin, due to an option being effectively set twice.</p></section></section><section class="chapter"><h2 id="breaking-changes-and-deprecations" data-toc="breaking-changes-and-deprecations">Breaking changes and deprecations</h2><ul class="list _bullet" id="-w8yckf_375"><li class="list__item" id="-w8yckf_376"><p id="-w8yckf_379">To align Kotlin Multiplatform with upcoming changes in Gradle, we are phasing out the <code class="code" id="-w8yckf_380">withJava()</code> function. <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-compatibility-guide.html#java-source-sets-created-by-default" id="-w8yckf_381" data-external="true" rel="noopener noreferrer" target="_blank">Java source sets are now created by default</a>. If you use the <a href="https://docs.gradle.org/current/userguide/java_testing.html#sec:java_test_fixtures" id="-w8yckf_382" data-external="true" rel="noopener noreferrer" target="_blank">Java test fixtures</a> Gradle plugin, upgrade directly to <a href="releases.html#release-details" id="-w8yckf_383">Kotlin 2.1.21</a> to avoid compatibility issues.</p></li><li class="list__item" id="-w8yckf_377"><p id="-w8yckf_384">The JetBrains team is proceeding with the deprecation of the <code class="code" id="-w8yckf_385">kotlin-android-extensions</code> plugin. If you try to use it in your project, you'll now get a configuration error, and no plugin code will be executed.</p></li><li class="list__item" id="-w8yckf_378"><p id="-w8yckf_386">The legacy <code class="code" id="-w8yckf_387">kotlin.incremental.classpath.snapshot.enabled</code> property has been removed from the Kotlin Gradle plugin. The property used to provide an opportunity to fall back to a built-in ABI snapshot on the JVM. The plugin now uses other methods to detect and avoid unnecessary recompilations, making the property obsolete.</p></li></ul></section><section class="chapter"><h2 id="documentation-updates" data-toc="documentation-updates">Documentation updates</h2><p id="-w8yckf_388">The Kotlin documentation has received some notable changes:</p><section class="chapter"><h3 id="revamped-and-new-pages" data-toc="revamped-and-new-pages">Revamped and new pages</h3><ul class="list _bullet" id="-w8yckf_391"><li class="list__item" id="-w8yckf_392"><p id="-w8yckf_398"><a href="roadmap.html" id="-w8yckf_399">Kotlin roadmap</a> &ndash; see the updated list of Kotlin's priorities on language and ecosystem evolution.</p></li><li class="list__item" id="-w8yckf_393"><p id="-w8yckf_400"><a href="gradle-best-practices.html" id="-w8yckf_401">Gradle best practices</a> page &ndash; learn essential best practices for optimizing your Gradle builds and improving performance.</p></li><li class="list__item" id="-w8yckf_394"><p id="-w8yckf_402"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/compose-multiplatform-and-jetpack-compose.html" id="-w8yckf_403" data-external="true" rel="noopener noreferrer" target="_blank">Compose Multiplatform and Jetpack Compose</a> &ndash; an overview of the relation between the two UI frameworks.</p></li><li class="list__item" id="-w8yckf_395"><p id="-w8yckf_404"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/kotlin-multiplatform-flutter.html" id="-w8yckf_405" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Multiplatform and Flutter</a> &ndash; see the comparison of two popular cross-platform frameworks.</p></li><li class="list__item" id="-w8yckf_396"><p id="-w8yckf_406"><a href="native-c-interop.html" id="-w8yckf_407">Interoperability with C</a> &ndash; explore the details of Kotlin's interoperability with C.</p></li><li class="list__item" id="-w8yckf_397"><p id="-w8yckf_408"><a href="numbers.html" id="-w8yckf_409">Numbers</a> &ndash; learn about different Kotlin types for representing numbers.</p></li></ul></section><section class="chapter"><h3 id="new-and-updated-tutorials" data-toc="new-and-updated-tutorials">New and updated tutorials</h3><ul class="list _bullet" id="-w8yckf_410"><li class="list__item" id="-w8yckf_411"><p id="-w8yckf_414"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-publish-libraries.html" id="-w8yckf_415" data-external="true" rel="noopener noreferrer" target="_blank">Publish your library to Maven Central</a> &ndash; learn how to publish KMP library artifacts to the most popular Maven repository.</p></li><li class="list__item" id="-w8yckf_412"><p id="-w8yckf_416"><a href="native-dynamic-libraries.html" id="-w8yckf_417">Kotlin/Native as a dynamic library</a> &ndash; create a dynamic Kotlin library.</p></li><li class="list__item" id="-w8yckf_413"><p id="-w8yckf_418"><a href="apple-framework.html" id="-w8yckf_419">Kotlin/Native as an Apple framework</a> &ndash; create your own framework and use Kotlin/Native code from Swift/Objective-C applications on macOS and iOS.</p></li></ul></section></section><section class="chapter"><h2 id="how-to-update-to-kotlin-2-1-20" data-toc="how-to-update-to-kotlin-2-1-20">How to update to Kotlin 2.1.20</h2><p id="-w8yckf_420">Starting from IntelliJ IDEA 2023.3 and Android Studio Iguana (2023.2.1) Canary 15, the Kotlin plugin is distributed as a bundled plugin included in your IDE. This means that you can't install the plugin from JetBrains Marketplace anymore.</p><p id="-w8yckf_421">To update to the new Kotlin version, <a href="releases.html#update-to-a-new-kotlin-version" id="-w8yckf_422">change the Kotlin version</a> to 2.1.20 in your build scripts.</p></section><div class="last-modified">16 July 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="whatsnew-eap.html" class="navigation-links__prev">What's new in Kotlin 2.2.20-Beta1</a><a href="whatsnew21.html" class="navigation-links__next">What's new in Kotlin 2.1.0</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>