<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-07-28T16:03:11.294626851"><link rel="canonical" href="https://kotlinlang.org/docs/whatsnew1820.html" data-react-helmet="true"><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
<title>What's new in Kotlin 1.8.20 | Kotlin Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"ide-support","level":0,"title":"IDE support","anchor":"#ide-support"},{"id":"new-kotlin-k2-compiler-updates","level":0,"title":"New Kotlin K2 compiler updates","anchor":"#new-kotlin-k2-compiler-updates"},{"id":"how-to-enable-the-kotlin-k2-compiler","level":1,"title":"How to enable the Kotlin K2 compiler","anchor":"#how-to-enable-the-kotlin-k2-compiler"},{"id":"leave-your-feedback-on-the-new-k2-compiler","level":1,"title":"Leave your feedback on the new K2 compiler","anchor":"#leave-your-feedback-on-the-new-k2-compiler"},{"id":"language","level":0,"title":"Language","anchor":"#language"},{"id":"a-modern-and-performant-replacement-of-the-enum-class-values-function","level":1,"title":"A modern and performant replacement of the Enum class values function","anchor":"#a-modern-and-performant-replacement-of-the-enum-class-values-function"},{"id":"preview-of-data-objects-for-symmetry-with-data-classes","level":1,"title":"Preview of data objects for symmetry with data classes","anchor":"#preview-of-data-objects-for-symmetry-with-data-classes"},{"id":"preview-of-lifting-restriction-on-secondary-constructors-with-bodies-in-inline-classes","level":1,"title":"Preview of lifting restriction on secondary constructors with bodies in inline classes","anchor":"#preview-of-lifting-restriction-on-secondary-constructors-with-bodies-in-inline-classes"},{"id":"new-kotlin-wasm-target","level":0,"title":"New Kotlin/Wasm target","anchor":"#new-kotlin-wasm-target"},{"id":"how-to-enable-kotlin-wasm","level":1,"title":"How to enable Kotlin/Wasm","anchor":"#how-to-enable-kotlin-wasm"},{"id":"leave-your-feedback-on-kotlin-wasm","level":1,"title":"Leave your feedback on Kotlin/Wasm","anchor":"#leave-your-feedback-on-kotlin-wasm"},{"id":"kotlin-jvm","level":0,"title":"Kotlin/JVM","anchor":"#kotlin-jvm"},{"id":"preview-of-java-synthetic-property-references","level":1,"title":"Preview of Java synthetic property references","anchor":"#preview-of-java-synthetic-property-references"},{"id":"support-for-the-jvm-ir-backend-in-kapt-stub-generating-task-by-default","level":1,"title":"Support for the JVM IR backend in kapt stub generating task by default","anchor":"#support-for-the-jvm-ir-backend-in-kapt-stub-generating-task-by-default"},{"id":"kotlin-native","level":0,"title":"Kotlin/Native","anchor":"#kotlin-native"},{"id":"update-for-kotlin-native-targets","level":1,"title":"Update for Kotlin/Native targets","anchor":"#update-for-kotlin-native-targets"},{"id":"deprecation-of-the-legacy-memory-manager","level":1,"title":"Deprecation of the legacy memory manager","anchor":"#deprecation-of-the-legacy-memory-manager"},{"id":"support-for-objective-c-headers-with-import-directives","level":1,"title":"Support for Objective-C headers with @import directives","anchor":"#support-for-objective-c-headers-with-import-directives"},{"id":"support-for-the-link-only-mode-in-cocoapods-gradle-plugin","level":1,"title":"Support for the link-only mode in Cocoapods Gradle plugin","anchor":"#support-for-the-link-only-mode-in-cocoapods-gradle-plugin"},{"id":"import-objective-c-extensions-as-class-members-in-uikit","level":1,"title":"Import Objective-C extensions as class members in UIKit","anchor":"#import-objective-c-extensions-as-class-members-in-uikit"},{"id":"reimplementation-of-compiler-cache-management-in-the-compiler","level":1,"title":"Reimplementation of compiler cache management in the compiler","anchor":"#reimplementation-of-compiler-cache-management-in-the-compiler"},{"id":"deprecation-of-uselibraries-in-cocoapods-gradle-plugin","level":1,"title":"Deprecation of useLibraries() in Cocoapods Gradle plugin","anchor":"#deprecation-of-uselibraries-in-cocoapods-gradle-plugin"},{"id":"kotlin-multiplatform","level":0,"title":"Kotlin Multiplatform","anchor":"#kotlin-multiplatform"},{"id":"new-approach-to-source-set-hierarchy","level":1,"title":"New approach to source set hierarchy","anchor":"#new-approach-to-source-set-hierarchy"},{"id":"preview-of-gradle-composite-builds-support-in-kotlin-multiplatform","level":1,"title":"Preview of Gradle composite builds support in Kotlin Multiplatform","anchor":"#preview-of-gradle-composite-builds-support-in-kotlin-multiplatform"},{"id":"improved-output-for-gradle-errors-in-xcode","level":1,"title":"Improved output for Gradle errors in Xcode","anchor":"#improved-output-for-gradle-errors-in-xcode"},{"id":"kotlin-javascript","level":0,"title":"Kotlin/JavaScript","anchor":"#kotlin-javascript"},{"id":"removal-of-dukat-integration-from-gradle-plugin","level":1,"title":"Removal of Dukat integration from Gradle plugin","anchor":"#removal-of-dukat-integration-from-gradle-plugin"},{"id":"kotlin-variable-and-function-names-in-source-maps","level":1,"title":"Kotlin variable and function names in source maps","anchor":"#kotlin-variable-and-function-names-in-source-maps"},{"id":"opt-in-for-generation-of-typescript-definition-files","level":1,"title":"Opt in for generation of TypeScript definition files","anchor":"#opt-in-for-generation-of-typescript-definition-files"},{"id":"gradle","level":0,"title":"Gradle","anchor":"#gradle"},{"id":"new-gradle-plugins-versions-alignment","level":1,"title":"New Gradle plugins versions alignment","anchor":"#new-gradle-plugins-versions-alignment"},{"id":"new-jvm-incremental-compilation-by-default-in-gradle","level":1,"title":"New JVM incremental compilation by default in Gradle","anchor":"#new-jvm-incremental-compilation-by-default-in-gradle"},{"id":"precise-backup-of-compilation-tasks-outputs","level":1,"title":"Precise backup of compilation tasks\u0027 outputs","anchor":"#precise-backup-of-compilation-tasks-outputs"},{"id":"lazy-kotlin-jvm-tasks-creation-for-all-gradle-versions","level":1,"title":"Lazy Kotlin/JVM tasks creation for all Gradle versions","anchor":"#lazy-kotlin-jvm-tasks-creation-for-all-gradle-versions"},{"id":"non-default-location-of-compile-tasks-destinationdirectory","level":1,"title":"Non-default location of compile tasks\u0027 destinationDirectory","anchor":"#non-default-location-of-compile-tasks-destinationdirectory"},{"id":"ability-to-opt-out-from-reporting-compiler-arguments-to-an-http-statistics-service","level":1,"title":"Ability to opt-out from reporting compiler arguments to an HTTP statistics service","anchor":"#ability-to-opt-out-from-reporting-compiler-arguments-to-an-http-statistics-service"},{"id":"standard-library","level":0,"title":"Standard library","anchor":"#standard-library"},{"id":"support-for-the-autocloseable-interface","level":1,"title":"Support for the AutoCloseable interface","anchor":"#support-for-the-autocloseable-interface"},{"id":"support-for-base64-encoding","level":1,"title":"Support for Base64 encoding","anchor":"#support-for-base64-encoding"},{"id":"support-for-volatile-in-kotlin-native","level":1,"title":"Support for @Volatile in Kotlin/Native","anchor":"#support-for-volatile-in-kotlin-native"},{"id":"bug-fix-for-stack-overflow-when-using-regex-in-kotlin-native","level":1,"title":"Bug fix for stack overflow when using regex in Kotlin/Native","anchor":"#bug-fix-for-stack-overflow-when-using-regex-in-kotlin-native"},{"id":"serialization-updates","level":0,"title":"Serialization updates","anchor":"#serialization-updates"},{"id":"prototype-serialization-compiler-plugin-for-kotlin-k2-compiler","level":1,"title":"Prototype serialization compiler plugin for Kotlin K2 compiler","anchor":"#prototype-serialization-compiler-plugin-for-kotlin-k2-compiler"},{"id":"prohibit-implicit-serializer-customization-via-companion-object","level":1,"title":"Prohibit implicit serializer customization via companion object","anchor":"#prohibit-implicit-serializer-customization-via-companion-object"},{"id":"documentation-updates","level":0,"title":"Documentation updates","anchor":"#documentation-updates"},{"id":"install-kotlin-1-8-20","level":0,"title":"Install Kotlin 1.8.20","anchor":"#install-kotlin-1-8-20"},{"id":"check-the-ide-version","level":1,"title":"Check the IDE version","anchor":"#check-the-ide-version"},{"id":"configure-gradle-settings","level":1,"title":"Configure Gradle settings","anchor":"#configure-gradle-settings"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="https://kotlinlang.org/assets/images/favicon.svg?v2"><link rel="icon" type="image/x-icon" sizes="32x32" href="https://kotlinlang.org/assets/images/favicon.ico?v2"><link rel="icon" type="image/png" sizes="96x96" href="https://kotlinlang.org/assets/images/apple-touch-icon.png?v2"><link rel="icon" type="image/png" sizes="300x300" href="https://kotlinlang.org/assets/images/apple-touch-icon-72x72.png?v2"><link rel="icon" type="image/png" sizes="500x500" href="https://kotlinlang.org/assets/images/apple-touch-icon-114x114.png?v2"><meta name="image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- Open Graph --><meta property="og:title" content="What's new in Kotlin 1.8.20 | Kotlin"><meta property="og:description" content=""><meta property="og:image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://kotlinlang.org/docs/whatsnew1820.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@kotlin"><meta name="twitter:title" content="What's new in Kotlin 1.8.20 | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@kotlin"><meta name="twitter:image:src" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://kotlinlang.org/docs/whatsnew1820.html#webpage",
    "url": "https://kotlinlang.org/docs/whatsnew1820.html",
    "name": "What's new in Kotlin 1.8.20 | Kotlin",
    "description": "",
    "image": "https://kotlinlang.org/assets/images/open-graph/docs.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://kotlinlang.org/docs/#website",
    "url": "https://kotlinlang.org/docs/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --><style>a[href="test-page.html"] { visibility: hidden; }</style></head><body data-id="whatsnew1820" data-main-title="What's new in Kotlin 1.8.20" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="What's new in Kotlin///Earlier versions" data-edit-url="https://github.com/JetBrains/kotlin-web-site/edit/master/docs/topics/whatsnew/whatsnew1820.md"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="whatsnew1820" id="whatsnew1820.md">What's new in Kotlin 1.8.20</h1><p id="p6l019_2"><span class="emphasis" id="p6l019_20"><a href="releases.html#release-details" id="p6l019_21">Released: 25 April 2023</a></span></p><p id="p6l019_3">The Kotlin 1.8.20 release is out and here are some of its biggest highlights:</p><ul class="list _bullet" id="p6l019_4"><li class="list__item" id="p6l019_22"><p id="p6l019_30"><a href="#new-kotlin-k2-compiler-updates" id="p6l019_31">New Kotlin K2 compiler updates</a></p></li><li class="list__item" id="p6l019_23"><p id="p6l019_32"><a href="#new-kotlin-wasm-target" id="p6l019_33">New experimental Kotlin/Wasm target</a></p></li><li class="list__item" id="p6l019_24"><p id="p6l019_34"><a href="#new-jvm-incremental-compilation-by-default-in-gradle" id="p6l019_35">New JVM incremental compilation by default in Gradle</a></p></li><li class="list__item" id="p6l019_25"><p id="p6l019_36"><a href="#update-for-kotlin-native-targets" id="p6l019_37">Update for Kotlin/Native targets</a></p></li><li class="list__item" id="p6l019_26"><p id="p6l019_38"><a href="#preview-of-gradle-composite-builds-support-in-kotlin-multiplatform" id="p6l019_39">Preview of Gradle composite builds in Kotlin Multiplatform</a></p></li><li class="list__item" id="p6l019_27"><p id="p6l019_40"><a href="#improved-output-for-gradle-errors-in-xcode" id="p6l019_41">Improved output for Gradle errors in Xcode</a></p></li><li class="list__item" id="p6l019_28"><p id="p6l019_42"><a href="#support-for-the-autocloseable-interface" id="p6l019_43">Experimental support for the AutoCloseable interface in the standard library</a></p></li><li class="list__item" id="p6l019_29"><p id="p6l019_44"><a href="#support-for-base64-encoding" id="p6l019_45">Experimental support for Base64 encoding in the standard library</a></p></li></ul><p id="p6l019_5">You can also find a short overview of the changes in this video:</p><div class="video-player" id="p6l019_6"><object class="article__bordered-element" width="560" height="315" data-theme="light" type="application/x-shockwave-flash" data="https://www.youtube.com/v/R1JpkpPzyBU?color2=FBE9EC&amp;rel=0&amp;hd=1&amp;autoplay=0&amp;version=3&amp;modestbranding=1&amp;fs=1"></object></div><section class="chapter"><h2 id="ide-support" data-toc="ide-support">IDE support</h2><p id="p6l019_46">The Kotlin plugins that support 1.8.20 are available for:</p><div class="table-wrapper"><table class="wide" id="p6l019_47"><thead><tr class="ijRowHead" id="p6l019_49"><th id="p6l019_52"><p>IDE</p></th><th id="p6l019_53"><p>Supported versions</p></th></tr></thead><tbody><tr id="p6l019_50"><td id="p6l019_54"><p>IntelliJ IDEA</p></td><td id="p6l019_55"><p>2022.2.x, 2022.3.x, 2023.1.x</p></td></tr><tr id="p6l019_51"><td id="p6l019_56"><p>Android Studio</p></td><td id="p6l019_57"><p>Flamingo (222)</p></td></tr></tbody></table></div><aside class="prompt" data-type="warning" data-title="" id="p6l019_48"><p id="p6l019_58">To download Kotlin artifacts and dependencies properly, <a href="#configure-gradle-settings" id="p6l019_59">configure Gradle settings</a> to use the Maven Central repository.</p></aside></section><section class="chapter"><h2 id="new-kotlin-k2-compiler-updates" data-toc="new-kotlin-k2-compiler-updates">New Kotlin K2 compiler updates</h2><p id="p6l019_60">The Kotlin team continues to stabilize the K2 compiler. As mentioned in the <a href="whatsnew17.html#new-kotlin-k2-compiler-for-the-jvm-in-alpha" id="p6l019_67">Kotlin 1.7.0 announcement</a>, it's still in <span class="control" id="p6l019_68">Alpha</span>. This release introduces further improvements on the road to <a href="https://youtrack.jetbrains.com/issue/KT-52604" id="p6l019_69" data-external="true" rel="noopener noreferrer" target="_blank">K2 Beta</a>.</p><p id="p6l019_61">Starting with this 1.8.20 release, the Kotlin K2 compiler:</p><ul class="list _bullet" id="p6l019_62"><li class="list__item" id="p6l019_70"><p id="p6l019_73">Has a preview version of the serialization plugin.</p></li><li class="list__item" id="p6l019_71"><p id="p6l019_74">Provides Alpha support for the <a href="js-ir-compiler.html" id="p6l019_75">JS IR compiler</a>.</p></li><li class="list__item" id="p6l019_72"><p id="p6l019_76">Introduces the future release of the <a href="https://blog.jetbrains.com/kotlin/2023/02/k2-kotlin-2-0/" id="p6l019_77" data-external="true" rel="noopener noreferrer" target="_blank">new language version, Kotlin 2.0</a>.</p></li></ul><p id="p6l019_63">Learn more about the new compiler and its benefits in the following videos:</p><ul class="list _bullet" id="p6l019_64"><li class="list__item" id="p6l019_78"><p id="p6l019_80"><a href="https://www.youtube.com/watch?v=iTdJJq_LyoY" id="p6l019_81" data-external="true" rel="noopener noreferrer" target="_blank">What Everyone Must Know About The NEW Kotlin K2 Compiler</a></p></li><li class="list__item" id="p6l019_79"><p id="p6l019_82"><a href="https://www.youtube.com/watch?v=db19VFLZqJM" id="p6l019_83" data-external="true" rel="noopener noreferrer" target="_blank">The New Kotlin K2 Compiler: Expert Review</a></p></li></ul><section class="chapter"><h3 id="how-to-enable-the-kotlin-k2-compiler" data-toc="how-to-enable-the-kotlin-k2-compiler">How to enable the Kotlin K2 compiler</h3><p id="p6l019_84">To enable and test the Kotlin K2 compiler, use the new language version with the following compiler option:</p><div class="code-block" data-lang="bash">
-language-version 2.0
</div><p id="p6l019_86">You can specify it in your <code class="code" id="p6l019_90">build.gradle(.kts)</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
   sourceSets.all {
       languageSettings {
           languageVersion = &quot;2.0&quot;
       }
   }
}
</div><p id="p6l019_88">The previous <code class="code" id="p6l019_91">-Xuse-k2</code> compiler option has been deprecated.</p><aside class="prompt" data-type="warning" data-title="" id="p6l019_89"><p id="p6l019_92">The Alpha version of the new K2 compiler only works with JVM and JS IR projects. It doesn't support Kotlin/Native or any of the multiplatform projects yet.</p></aside></section><section class="chapter"><h3 id="leave-your-feedback-on-the-new-k2-compiler" data-toc="leave-your-feedback-on-the-new-k2-compiler">Leave your feedback on the new K2 compiler</h3><p id="p6l019_93">We would appreciate any feedback you may have!</p><ul class="list _bullet" id="p6l019_94"><li class="list__item" id="p6l019_95"><p id="p6l019_98">Provide your feedback directly to K2 developers on Kotlin Slack &ndash; <a href="https://surveys.jetbrains.com/s3/kotlin-slack-sign-up?_gl=1*ju6cbn*_ga*MTA3MTk5NDkzMC4xNjQ2MDY3MDU4*_ga_9J976DJZ68*MTY1ODMzNzA3OS4xMDAuMS4xNjU4MzQwODEwLjYw" id="p6l019_99" data-external="true" rel="noopener noreferrer" target="_blank">get an invite</a> and join the <a href="https://kotlinlang.slack.com/archives/C03PK0PE257" id="p6l019_100" data-external="true" rel="noopener noreferrer" target="_blank">#k2-early-adopters</a> channel.</p></li><li class="list__item" id="p6l019_96"><p id="p6l019_101">Report any problems you faced with the new K2 compiler on <a href="https://kotl.in/issue" id="p6l019_102" data-external="true" rel="noopener noreferrer" target="_blank">our issue tracker</a>.</p></li><li class="list__item" id="p6l019_97"><p id="p6l019_103"><a href="https://www.jetbrains.com/help/idea/settings-usage-statistics.html" id="p6l019_104" data-external="true" rel="noopener noreferrer" target="_blank">Enable the <span class="control" id="p6l019_105">Send usage statistics</span> option</a> to allow JetBrains to collect anonymous data about K2 usage.</p></li></ul></section></section><section class="chapter"><h2 id="language" data-toc="language">Language</h2><p id="p6l019_106">As Kotlin continues to evolve, we're introducing preview versions for new language features in 1.8.20:</p><ul class="list _bullet" id="p6l019_107"><li class="list__item" id="p6l019_111"><p id="p6l019_114"><a href="#a-modern-and-performant-replacement-of-the-enum-class-values-function" id="p6l019_115">A modern and performant replacement of the Enum class values function</a></p></li><li class="list__item" id="p6l019_112"><p id="p6l019_116"><a href="#preview-of-data-objects-for-symmetry-with-data-classes" id="p6l019_117">Data objects for symmetry with data classes</a></p></li><li class="list__item" id="p6l019_113"><p id="p6l019_118"><a href="#preview-of-lifting-restriction-on-secondary-constructors-with-bodies-in-inline-classes" id="p6l019_119">Lifting restrictions on secondary constructors with bodies in inline classes</a></p></li></ul><section class="chapter"><h3 id="a-modern-and-performant-replacement-of-the-enum-class-values-function" data-toc="a-modern-and-performant-replacement-of-the-enum-class-values-function">A modern and performant replacement of the Enum class values function</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_120"><p id="p6l019_125">This feature is <a href="components-stability.html#stability-levels-explained" id="p6l019_126">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below). Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="p6l019_127" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_121">Enum classes have a synthetic <code class="code" id="p6l019_128">values()</code> function, which returns an array of defined enum constants. However, using an array can lead to <a href="https://github.com/Kotlin/KEEP/blob/master/proposals/enum-entries.md#examples-of-performance-issues" id="p6l019_129" data-external="true" rel="noopener noreferrer" target="_blank">hidden performance issues</a> in Kotlin and Java. In addition, most of the APIs use collections, which require eventual conversion. To fix these problems, we've introduced the <code class="code" id="p6l019_130">entries</code> property for Enum classes, which should be used instead of the <code class="code" id="p6l019_131">values()</code> function. When called, the <code class="code" id="p6l019_132">entries</code> property returns a pre-allocated immutable list of defined enum constants.</p><aside class="prompt" data-type="tip" data-title="" id="p6l019_122"><p id="p6l019_133">The <code class="code" id="p6l019_134">values()</code> function is still supported, but we recommend that you use the <code class="code" id="p6l019_135">entries</code> property instead.</p></aside><div class="code-block" data-lang="kotlin">
enum class Color(val colorName: String, val rgb: String) {
    RED(&quot;Red&quot;, &quot;#FF0000&quot;),
    ORANGE(&quot;Orange&quot;, &quot;#FF7F00&quot;),
    YELLOW(&quot;Yellow&quot;, &quot;#FFFF00&quot;)
}

@OptIn(ExperimentalStdlibApi::class)
fun findByRgb(rgb: String): Color? = Color.entries.find { it.rgb == rgb }
</div><section class="chapter"><h4 id="how-to-enable-the-entries-property" data-toc="how-to-enable-the-entries-property">How to enable the entries property</h4><p id="p6l019_136">To try this feature out, opt in with <code class="code" id="p6l019_140">@OptIn(ExperimentalStdlibApi)</code> and enable the <code class="code" id="p6l019_141">-language-version 1.9</code> compiler option. In a Gradle project, you can do so by adding the following to your <code class="code" id="p6l019_142">build.gradle(.kts)</code> file:</p><div class="tabs" id="p6l019_137" data-group="build-script" data-anchors="[p6l019_143,p6l019_144]"><div class="tabs__content" data-gtm="tab" id="p6l019_143" data-sync-tabs="kotlin" data-title="Kotlin"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
tasks
    .withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask&lt;*&gt;&gt;()
    .configureEach {
        compilerOptions
            .languageVersion
            .set(
                org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
            )
    }
</div></div><div class="tabs__content" data-gtm="tab" id="p6l019_144" data-sync-tabs="groovy" data-title="Groovy"><div class="code-block" data-lang="groovy" data-title="Groovy">
tasks
    .withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask.class)
    .configureEach {
        compilerOptions.languageVersion =
            org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
    }
</div></div></div><aside class="prompt" data-type="tip" data-title="" id="p6l019_138"><p id="p6l019_147">Starting with IntelliJ IDEA 2023.1, if you have opted in to this feature, the appropriate IDE inspection will notify you about converting from <code class="code" id="p6l019_148">values()</code> to <code class="code" id="p6l019_149">entries</code> and offer a quick-fix.</p></aside><p id="p6l019_139">For more information on the proposal, see the <a href="https://github.com/Kotlin/KEEP/blob/master/proposals/enum-entries.md" id="p6l019_150" data-external="true" rel="noopener noreferrer" target="_blank">KEEP note</a>.</p></section></section><section class="chapter"><h3 id="preview-of-data-objects-for-symmetry-with-data-classes" data-toc="preview-of-data-objects-for-symmetry-with-data-classes">Preview of data objects for symmetry with data classes</h3><p id="p6l019_151">Data objects allow you to declare objects with singleton semantics and a clean <code class="code" id="p6l019_157">toString()</code> representation. In this snippet, you can see how adding the <code class="code" id="p6l019_158">data</code> keyword to an object declaration improves the readability of its <code class="code" id="p6l019_159">toString()</code> output:</p><div class="code-block" data-lang="kotlin">
package org.example
object MyObject
data object MyDataObject

fun main() {
    println(MyObject) // org.example.MyObject@1f32e575
    println(MyDataObject) // MyDataObject
}
</div><p id="p6l019_153">Especially for <code class="code" id="p6l019_160">sealed</code> hierarchies (like a <code class="code" id="p6l019_161">sealed class</code> or <code class="code" id="p6l019_162">sealed interface</code> hierarchy), <code class="code" id="p6l019_163">data objects</code> are an excellent fit because they can be used conveniently alongside <code class="code" id="p6l019_164">data class</code> declarations. In this snippet, declaring <code class="code" id="p6l019_165">EndOfFile</code> as a <code class="code" id="p6l019_166">data object</code> instead of a plain <code class="code" id="p6l019_167">object</code> means that it will get a pretty <code class="code" id="p6l019_168">toString</code> without the need to override it manually. This maintains symmetry with the accompanying data class definitions.</p><div class="code-block" data-lang="kotlin">
sealed interface ReadResult
data class Number(val number: Int) : ReadResult
data class Text(val text: String) : ReadResult
data object EndOfFile : ReadResult

fun main() {
    println(Number(7)) // Number(number=7)
    println(EndOfFile) // EndOfFile
}
</div><section class="chapter"><h4 id="semantics-of-data-objects" data-toc="semantics-of-data-objects">Semantics of data objects</h4><p id="p6l019_169">Since their first preview version in <a href="whatsnew1720.html#improved-string-representations-for-singletons-and-sealed-class-hierarchies-with-data-objects" id="p6l019_173">Kotlin 1.7.20</a>, the semantics of data objects have been refined. The compiler now automatically generates a number of convenience functions for them:</p><section class="chapter"><h5 id="tostring" data-toc="tostring">toString</h5><p id="p6l019_174">The <code class="code" id="p6l019_176">toString()</code> function of a data object returns the simple name of the object:</p><div class="code-block" data-lang="kotlin">
data object MyDataObject {
    val x: Int = 3
}

fun main() {
    println(MyDataObject) // MyDataObject
}
</div></section><section class="chapter"><h5 id="equals-and-hashcode" data-toc="equals-and-hashcode">equals and hashCode</h5><p id="p6l019_177">The <code class="code" id="p6l019_181">equals()</code> function for a <code class="code" id="p6l019_182">data object</code> ensures that all objects that have the type of your <code class="code" id="p6l019_183">data object</code> are considered equal. In most cases, you will only have a single instance of your data object at runtime (after all, a <code class="code" id="p6l019_184">data object</code> declares a singleton). However, in the edge case where another object of the same type is generated at runtime (for example, via platform reflection through <code class="code" id="p6l019_185">java.lang.reflect</code>, or by using a JVM serialization library that uses this API under the hood), this ensures that the objects are treated as equal.</p><p id="p6l019_178">Make sure to only compare <code class="code" id="p6l019_186">data objects</code> structurally (using the <code class="code" id="p6l019_187">==</code> operator) and never by reference (the <code class="code" id="p6l019_188">===</code> operator). This helps avoid pitfalls when more than one instance of a data object exists at runtime. The following snippet illustrates this specific edge case:</p><div class="code-block" data-lang="kotlin">
import java.lang.reflect.Constructor

data object MySingleton

fun main() {
    val evilTwin = createInstanceViaReflection()

    println(MySingleton) // MySingleton
    println(evilTwin) // MySingleton

    // Even when a library forcefully creates a second instance of MySingleton, its `equals` method returns true:
    println(MySingleton == evilTwin) // true

    // Do not compare data objects via ===.
    println(MySingleton === evilTwin) // false
}

fun createInstanceViaReflection(): MySingleton {
    // Kotlin reflection does not permit the instantiation of data objects.
    // This creates a new MySingleton instance &quot;by force&quot; (i.e., Java platform reflection)
    // Don't do this yourself!
    return (MySingleton.javaClass.declaredConstructors[0].apply { isAccessible = true } as Constructor&lt;MySingleton&gt;).newInstance()
}
</div><p id="p6l019_180">The behavior of the generated <code class="code" id="p6l019_189">hashCode()</code> function is consistent with that of the <code class="code" id="p6l019_190">equals()</code> function, so that all runtime instances of a <code class="code" id="p6l019_191">data object</code> have the same hash code.</p></section><section class="chapter"><h5 id="no-copy-and-componentn-functions-for-data-objects" data-toc="no-copy-and-componentn-functions-for-data-objects">No copy and componentN functions for data objects</h5><p id="p6l019_192">While <code class="code" id="p6l019_196">data object</code> and <code class="code" id="p6l019_197">data class</code> declarations are often used together and have some similarities, there are some functions that are not generated for a <code class="code" id="p6l019_198">data object</code>:</p><p id="p6l019_193">Because a <code class="code" id="p6l019_199">data object</code> declaration is intended to be used as a singleton object, no <code class="code" id="p6l019_200">copy()</code> function is generated. The singleton pattern restricts the instantiation of a class to a single instance, and allowing copies of the instance to be created would violate that restriction.</p><p id="p6l019_194">Also, unlike a <code class="code" id="p6l019_201">data class</code>, a <code class="code" id="p6l019_202">data object</code> does not have any data properties. Since attempting to destructure such an object would not make sense, no <code class="code" id="p6l019_203">componentN()</code> functions are generated.</p><p id="p6l019_195">We would appreciate your feedback on this feature in <a href="https://youtrack.jetbrains.com/issue/KT-4107" id="p6l019_204" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section></section><section class="chapter"><h4 id="how-to-enable-the-data-objects-preview" data-toc="how-to-enable-the-data-objects-preview">How to enable the data objects preview</h4><p id="p6l019_205">To try this feature out, enable the <code class="code" id="p6l019_207">-language-version 1.9</code> compiler option. In a Gradle project, you can do so by adding the following to your <code class="code" id="p6l019_208">build.gradle(.kts)</code> file:</p><div class="tabs" id="p6l019_206" data-group="build-script" data-anchors="[p6l019_209,p6l019_210]"><div class="tabs__content" data-gtm="tab" id="p6l019_209" data-sync-tabs="kotlin" data-title="Kotlin"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
tasks
    .withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask&lt;*&gt;&gt;()
    .configureEach {
        compilerOptions
            .languageVersion
            .set(
                org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
            )
    }
</div></div><div class="tabs__content" data-gtm="tab" id="p6l019_210" data-sync-tabs="groovy" data-title="Groovy"><div class="code-block" data-lang="groovy" data-title="Groovy">
tasks
    .withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask.class)
    .configureEach {
        compilerOptions.languageVersion =
            org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
    }
</div></div></div></section></section><section class="chapter"><h3 id="preview-of-lifting-restriction-on-secondary-constructors-with-bodies-in-inline-classes" data-toc="preview-of-lifting-restriction-on-secondary-constructors-with-bodies-in-inline-classes">Preview of lifting restriction on secondary constructors with bodies in inline classes</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_213"><p id="p6l019_219">This feature is <a href="components-stability.html#stability-levels-explained" id="p6l019_220">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below). Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="p6l019_221" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_214">Kotlin 1.8.20 lifts restrictions on the use of secondary constructors with bodies in <a href="inline-classes.html" id="p6l019_222">inline classes</a>.</p><p id="p6l019_215">Inline classes used to allow only a public primary constructor without <code class="code" id="p6l019_223">init</code> blocks or secondary constructors to have clear initialization semantics. As a result, it was impossible to encapsulate underlying values or create an inline class that would represent some constrained values.</p><p id="p6l019_216">These issues were fixed when Kotlin 1.4.30 lifted restrictions on <code class="code" id="p6l019_224">init</code> blocks. Now we're taking it a step further and allowing secondary constructors with bodies in preview mode:</p><div class="code-block" data-lang="kotlin">
@JvmInline
value class Person(private val fullName: String) {
    // Allowed since Kotlin 1.4.30:
    init { 
        check(fullName.isNotBlank()) {
            &quot;Full name shouldn't be empty&quot;
        }
    }

    // Preview available since Kotlin 1.8.20:
    constructor(name: String, lastName: String) : this(&quot;$name $lastName&quot;) {
        check(lastName.isNotBlank()) {
            &quot;Last name shouldn't be empty&quot;
        }
    }
}
</div><section class="chapter"><h4 id="how-to-enable-secondary-constructors-with-bodies" data-toc="how-to-enable-secondary-constructors-with-bodies">How to enable secondary constructors with bodies</h4><p id="p6l019_225">To try this feature out, enable the <code class="code" id="p6l019_229">-language-version 1.9</code> compiler option. In a Gradle project, you can do so by adding the following to your <code class="code" id="p6l019_230">build.gradle(.kts)</code>:</p><div class="tabs" id="p6l019_226" data-group="build-script" data-anchors="[p6l019_231,p6l019_232]"><div class="tabs__content" data-gtm="tab" id="p6l019_231" data-sync-tabs="kotlin" data-title="Kotlin"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
tasks
    .withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask&lt;*&gt;&gt;()
    .configureEach {
        compilerOptions
            .languageVersion
            .set(
                org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
            )
    }
</div></div><div class="tabs__content" data-gtm="tab" id="p6l019_232" data-sync-tabs="groovy" data-title="Groovy"><div class="code-block" data-lang="groovy" data-title="Groovy">
tasks
    .withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask.class)
    .configureEach {
        compilerOptions.languageVersion =
            org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
    }
</div></div></div><p id="p6l019_227">We encourage you to try this feature out and submit all reports in <a href="https://kotl.in/issue" id="p6l019_235" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a> to help us make it the default in Kotlin 1.9.0.</p><p id="p6l019_228">Learn more about the development of Kotlin inline classes in <a href="https://github.com/Kotlin/KEEP/blob/master/proposals/inline-classes.md" id="p6l019_236" data-external="true" rel="noopener noreferrer" target="_blank">this KEEP</a>.</p></section></section></section><section class="chapter"><h2 id="new-kotlin-wasm-target" data-toc="new-kotlin-wasm-target">New Kotlin/Wasm target</h2><p id="p6l019_237">Kotlin/Wasm (Kotlin WebAssembly) goes <a href="components-stability.html#stability-levels-explained" id="p6l019_245">Experimental</a> in this release. The Kotlin team finds <a href="https://webassembly.org/" id="p6l019_246" data-external="true" rel="noopener noreferrer" target="_blank">WebAssembly</a> to be a promising technology and wants to find better ways for you to use it and get all of the benefits of Kotlin.</p><p id="p6l019_238">WebAssembly binary format is independent of the platform because it runs using its own virtual machine. Almost all modern browsers already support WebAssembly 1.0. To set up the environment to run WebAssembly, you only need to enable an experimental garbage collection mode that Kotlin/Wasm targets. You can find detailed instructions here: <a href="#how-to-enable-kotlin-wasm" id="p6l019_247">How to enable Kotlin/Wasm</a>.</p><p id="p6l019_239">We want to highlight the following advantages of the new Kotlin/Wasm target:</p><ul class="list _bullet" id="p6l019_240"><li class="list__item" id="p6l019_248"><p id="p6l019_252">Faster compilation speed compared to the <code class="code" id="p6l019_253">wasm32</code> Kotlin/Native target, since Kotlin/Wasm doesn't have to use LLVM.</p></li><li class="list__item" id="p6l019_249"><p id="p6l019_254">Easier interoperability with JS and integration with browsers compared to the <code class="code" id="p6l019_255">wasm32</code> target, thanks to the <a href="https://github.com/WebAssembly/gc" id="p6l019_256" data-external="true" rel="noopener noreferrer" target="_blank">Wasm garbage collection</a>.</p></li><li class="list__item" id="p6l019_250"><p id="p6l019_257">Potentially faster application startup compared to Kotlin/JS and JavaScript because Wasm has a compact and easy-to-parse bytecode.</p></li><li class="list__item" id="p6l019_251"><p id="p6l019_258">Improved application runtime performance compared to Kotlin/JS and JavaScript because Wasm is a statically typed language.</p></li></ul><p id="p6l019_241">Starting with the 1.8.20 release, you can use Kotlin/Wasm in your experimental projects. We provide the Kotlin standard library (<code class="code" id="p6l019_259">stdlib</code>) and test library (<code class="code" id="p6l019_260">kotlin.test</code>) for Kotlin/Wasm out of the box. IDE support will be added in future releases.</p><p id="p6l019_242"><a href="https://www.youtube.com/watch?v=-pqz9sKXatw" id="p6l019_261" data-external="true" rel="noopener noreferrer" target="_blank">Learn more about Kotlin/Wasm in this YouTube video</a>.</p><section class="chapter"><h3 id="how-to-enable-kotlin-wasm" data-toc="how-to-enable-kotlin-wasm">How to enable Kotlin/Wasm</h3><p id="p6l019_262">To enable and test Kotlin/Wasm, update your <code class="code" id="p6l019_267">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
plugins {
    kotlin(&quot;multiplatform&quot;) version &quot;1.8.20&quot;
}

kotlin {
    wasm {
        binaries.executable()
        browser {
        }
    }
    sourceSets {
        val commonMain by getting
        val commonTest by getting {
            dependencies {
                implementation(kotlin(&quot;test&quot;))
            }
        }
        val wasmMain by getting
        val wasmTest by getting
    }
}
</div><aside class="prompt" data-type="tip" data-title="" id="p6l019_264"><p id="p6l019_268">Check out the <a href="https://github.com/Kotlin/kotlin-wasm-examples" id="p6l019_269" data-external="true" rel="noopener noreferrer" target="_blank">GitHub repository with Kotlin/Wasm examples</a>.</p></aside><p id="p6l019_265">To run a Kotlin/Wasm project, you need to update the settings of the target environment:</p><div class="tabs" id="p6l019_266" data-anchors="[p6l019_270,p6l019_271,p6l019_272]"><div class="tabs__content" data-gtm="tab" id="p6l019_270" data-title="Chrome"><ul class="list _bullet" id="p6l019_273"><li class="list__item" id="p6l019_274"><p id="p6l019_276">For version 109:</p><p id="p6l019_277">Run the application with the <code class="code" id="p6l019_278">--js-flags=--experimental-wasm-gc</code> command line argument.</p></li><li class="list__item" id="p6l019_275"><p id="p6l019_279">For version 110 or later:</p><ol class="list _decimal" id="p6l019_280" type="1"><li class="list__item" id="p6l019_281"><p id="p6l019_284">Go to <code class="code" id="p6l019_285">chrome://flags/#enable-webassembly-garbage-collection</code> in your browser.</p></li><li class="list__item" id="p6l019_282"><p id="p6l019_286">Enable <span class="control" id="p6l019_287">WebAssembly Garbage Collection</span>.</p></li><li class="list__item" id="p6l019_283"><p id="p6l019_288">Relaunch your browser.</p></li></ol></li></ul></div><div class="tabs__content" data-gtm="tab" id="p6l019_271" data-title="Firefox"><p id="p6l019_289">For version 109 or later:</p><ol class="list _decimal" id="p6l019_290" type="1"><li class="list__item" id="p6l019_291"><p id="p6l019_294">Go to <code class="code" id="p6l019_295">about:config</code> in your browser.</p></li><li class="list__item" id="p6l019_292"><p id="p6l019_296">Enable <code class="code" id="p6l019_297">javascript.options.wasm_function_references</code> and <code class="code" id="p6l019_298">javascript.options.wasm_gc</code> options.</p></li><li class="list__item" id="p6l019_293"><p id="p6l019_299">Relaunch your browser.</p></li></ol></div><div class="tabs__content" data-gtm="tab" id="p6l019_272" data-title="Edge"><p id="p6l019_300">For version 109 or later:</p><p id="p6l019_301">Run the application with the <code class="code" id="p6l019_302">--js-flags=--experimental-wasm-gc</code> command line argument.</p></div></div></section><section class="chapter"><h3 id="leave-your-feedback-on-kotlin-wasm" data-toc="leave-your-feedback-on-kotlin-wasm">Leave your feedback on Kotlin/Wasm</h3><p id="p6l019_303">We would appreciate any feedback you may have!</p><ul class="list _bullet" id="p6l019_304"><li class="list__item" id="p6l019_305"><p id="p6l019_307">Provide your feedback directly to developers in Kotlin Slack &ndash; <a href="https://surveys.jetbrains.com/s3/kotlin-slack-sign-up?_gl=1*ju6cbn*_ga*MTA3MTk5NDkzMC4xNjQ2MDY3MDU4*_ga_9J976DJZ68*MTY1ODMzNzA3OS4xMDAuMS4xNjU4MzQwODEwLjYw" id="p6l019_308" data-external="true" rel="noopener noreferrer" target="_blank">get an invite</a> and join the <a href="https://kotlinlang.slack.com/archives/CDFP59223" id="p6l019_309" data-external="true" rel="noopener noreferrer" target="_blank">#webassembly</a> channel.</p></li><li class="list__item" id="p6l019_306"><p id="p6l019_310">Report any problems you faced with Kotlin/Wasm on <a href="https://youtrack.jetbrains.com/issue/KT-56492" id="p6l019_311" data-external="true" rel="noopener noreferrer" target="_blank">this YouTrack issue</a>.</p></li></ul></section></section><section class="chapter"><h2 id="kotlin-jvm" data-toc="kotlin-jvm">Kotlin/JVM</h2><p id="p6l019_312">Kotlin 1.8.20 introduces a <a href="#preview-of-java-synthetic-property-references" id="p6l019_315">preview of Java synthetic property references</a> and <a href="#support-for-the-jvm-ir-backend-in-kapt-stub-generating-task-by-default" id="p6l019_316">support for the JVM IR backend in the kapt stub generating task by default</a>.</p><section class="chapter"><h3 id="preview-of-java-synthetic-property-references" data-toc="preview-of-java-synthetic-property-references">Preview of Java synthetic property references</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_317"><p id="p6l019_323">This feature is <a href="components-stability.html#stability-levels-explained" id="p6l019_324">Experimental</a>. It may be dropped or changed at any time. Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="p6l019_325" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_318">Kotlin 1.8.20 introduces the ability to create references to Java synthetic properties, for example, for such Java code:</p><div class="code-block" data-lang="java">
public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public int getAge() {
        return age;
    }
}
</div><p id="p6l019_320">Kotlin has always allowed you to write <code class="code" id="p6l019_326">person.age</code>, where <code class="code" id="p6l019_327">age</code> is a synthetic property. Now, you can also create references to <code class="code" id="p6l019_328">Person::age</code> and <code class="code" id="p6l019_329">person::age</code>. All the same works for <code class="code" id="p6l019_330">name</code>, as well.</p><div class="code-block" data-lang="kotlin">
val persons = listOf(Person(&quot;Jack&quot;, 11), Person(&quot;Sofie&quot;, 12), Person(&quot;Peter&quot;, 11))
    persons
        // Call a reference to Java synthetic property:
        .sortedBy(Person::age)
        // Call Java getter via the Kotlin property syntax:
        .forEach { person -&gt; println(person.name) }
</div><section class="chapter"><h4 id="how-to-enable-java-synthetic-property-references" data-toc="how-to-enable-java-synthetic-property-references">How to enable Java synthetic property references</h4><p id="p6l019_331">To try this feature out, enable the <code class="code" id="p6l019_333">-language-version 1.9</code> compiler option. In a Gradle project, you can do so by adding the following to your <code class="code" id="p6l019_334">build.gradle(.kts)</code>:</p><div class="tabs" id="p6l019_332" data-group="build-script" data-anchors="[p6l019_335,p6l019_336]"><div class="tabs__content" data-gtm="tab" id="p6l019_335" data-sync-tabs="kotlin" data-title="Kotlin"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
tasks
    .withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask&lt;*&gt;&gt;()
    .configureEach {
        compilerOptions
            .languageVersion
            .set(
                org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
            )
    }
</div></div><div class="tabs__content" data-gtm="tab" id="p6l019_336" data-sync-tabs="groovy" data-title="Groovy"><div class="code-block" data-lang="groovy" data-title="Groovy">
tasks
    .withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask.class)
    .configureEach {
        compilerOptions.languageVersion =
            org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
    }
</div></div></div></section></section><section class="chapter"><h3 id="support-for-the-jvm-ir-backend-in-kapt-stub-generating-task-by-default" data-toc="support-for-the-jvm-ir-backend-in-kapt-stub-generating-task-by-default">Support for the JVM IR backend in kapt stub generating task by default</h3><p id="p6l019_339">In Kotlin 1.7.20, we introduced <a href="whatsnew1720.html#support-for-the-jvm-ir-backend-in-kapt-stub-generating-task" id="p6l019_340">support for the JVM IR backend in the kapt stub generating task</a>. Starting with this release, this support works by default. You no longer need to specify <code class="code" id="p6l019_341">kapt.use.jvm.ir=true</code> in your <code class="code" id="p6l019_342">gradle.properties</code> to enable it. We would appreciate your feedback on this feature in <a href="https://youtrack.jetbrains.com/issue/KT-49682" id="p6l019_343" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section></section><section class="chapter"><h2 id="kotlin-native" data-toc="kotlin-native">Kotlin/Native</h2><p id="p6l019_344">Kotlin 1.8.20 includes changes to supported Kotlin/Native targets, interoperability with Objective-C, and improvements to the CocoaPods Gradle plugin, among other updates:</p><ul class="list _bullet" id="p6l019_345"><li class="list__item" id="p6l019_353"><p id="p6l019_360"><a href="#update-for-kotlin-native-targets" id="p6l019_361">Update for Kotlin/Native targets</a></p></li><li class="list__item" id="p6l019_354"><p id="p6l019_362"><a href="#deprecation-of-the-legacy-memory-manager" id="p6l019_363">Deprecation of the legacy memory manager</a></p></li><li class="list__item" id="p6l019_355"><p id="p6l019_364"><a href="#support-for-objective-c-headers-with-import-directives" id="p6l019_365">Support for Objective-C headers with @import directives</a></p></li><li class="list__item" id="p6l019_356"><p id="p6l019_366"><a href="#support-for-the-link-only-mode-in-cocoapods-gradle-plugin" id="p6l019_367">Support for link-only mode in the Cocoapods Gradle plugin</a></p></li><li class="list__item" id="p6l019_357"><p id="p6l019_368"><a href="#import-objective-c-extensions-as-class-members-in-uikit" id="p6l019_369">Import Objective-C extensions as class members in UIKit</a></p></li><li class="list__item" id="p6l019_358"><p id="p6l019_370"><a href="#reimplementation-of-compiler-cache-management-in-the-compiler" id="p6l019_371">Reimplementation of compiler cache management in the compiler</a></p></li><li class="list__item" id="p6l019_359"><p id="p6l019_372"><a href="#deprecation-of-uselibraries-in-cocoapods-gradle-plugin" id="p6l019_373">Deprecation of <code class="code" id="p6l019_374">useLibraries()</code> in Cocoapods Gradle plugin</a></p></li></ul><section class="chapter"><h3 id="update-for-kotlin-native-targets" data-toc="update-for-kotlin-native-targets">Update for Kotlin/Native targets</h3><p id="p6l019_375">The Kotlin team decided to revisit the list of targets supported by Kotlin/Native, split them into tiers, and deprecate some of them starting with Kotlin 1.8.20. See the <a href="native-target-support.html" id="p6l019_381">Kotlin/Native target support</a> section for the full list of supported and deprecated targets.</p><p id="p6l019_376">The following targets have been deprecated with Kotlin 1.8.20 and will be removed in 1.9.20:</p><ul class="list _bullet" id="p6l019_377"><li class="list__item" id="p6l019_382"><p id="p6l019_389"><code class="code" id="p6l019_390">iosArm32</code></p></li><li class="list__item" id="p6l019_383"><p id="p6l019_391"><code class="code" id="p6l019_392">watchosX86</code></p></li><li class="list__item" id="p6l019_384"><p id="p6l019_393"><code class="code" id="p6l019_394">wasm32</code></p></li><li class="list__item" id="p6l019_385"><p id="p6l019_395"><code class="code" id="p6l019_396">mingwX86</code></p></li><li class="list__item" id="p6l019_386"><p id="p6l019_397"><code class="code" id="p6l019_398">linuxArm32Hfp</code></p></li><li class="list__item" id="p6l019_387"><p id="p6l019_399"><code class="code" id="p6l019_400">linuxMips32</code></p></li><li class="list__item" id="p6l019_388"><p id="p6l019_401"><code class="code" id="p6l019_402">linuxMipsel32</code></p></li></ul><p id="p6l019_378">As for the remaining targets, there are now three tiers of support depending on how well a target is supported and tested in the Kotlin/Native compiler. A target can be moved to a different tier. For example, we'll do our best to provide full support for <code class="code" id="p6l019_403">iosArm64</code> in the future, as it is important for <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/get-started.html" id="p6l019_404" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Multiplatform</a>.</p><p id="p6l019_379">If you're a library author, these target tiers can help you decide which targets to test on CI tools and which ones to skip. The Kotlin team will use the same approach when developing official Kotlin libraries, like <span id="p6l019_405">kotlinx.coroutines</span>.</p><p id="p6l019_380">Check out our <a href="https://blog.jetbrains.com/kotlin/2023/02/update-regarding-kotlin-native-targets/" id="p6l019_406" data-external="true" rel="noopener noreferrer" target="_blank">blog post</a> to learn more about the reasons for these changes.</p></section><section class="chapter"><h3 id="deprecation-of-the-legacy-memory-manager" data-toc="deprecation-of-the-legacy-memory-manager">Deprecation of the legacy memory manager</h3><p id="p6l019_407">Starting with 1.8.20, the legacy memory manager is deprecated and will be removed in 1.9.20. The <a href="native-memory-manager.html" id="p6l019_410">new memory manager</a> was enabled by default in 1.7.20 and has been receiving further stability updates and performance improvements.</p><p id="p6l019_408">If you're still using the legacy memory manager, remove the <code class="code" id="p6l019_411">kotlin.native.binary.memoryModel=strict</code> option from your <code class="code" id="p6l019_412">gradle.properties</code> and follow our <a href="native-migration-guide.html" id="p6l019_413">Migration guide</a> to make the necessary changes.</p><p id="p6l019_409">The new memory manager doesn't support the <code class="code" id="p6l019_414">wasm32</code> target. This target is also deprecated <a href="#update-for-kotlin-native-targets" id="p6l019_415">starting with this release</a> and will be removed in 1.9.20.</p></section><section class="chapter"><h3 id="support-for-objective-c-headers-with-import-directives" data-toc="support-for-objective-c-headers-with-import-directives">Support for Objective-C headers with @import directives</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_416"><p id="p6l019_422">This feature is <a href="components-stability.html#stability-levels-explained" id="p6l019_423">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below). Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="p6l019_424" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_417">Kotlin/Native can now import Objective-C headers with <code class="code" id="p6l019_425">@import</code> directives. This feature is useful for consuming Swift libraries that have auto-generated Objective-C headers or classes of CocoaPods dependencies written in Swift.</p><p id="p6l019_418">Previously, the cinterop tool failed to analyze headers that depended on Objective-C modules via the <code class="code" id="p6l019_426">@import</code> directive. The reason was that it lacked support for the <code class="code" id="p6l019_427">-fmodules</code> option.</p><p id="p6l019_419">Starting with Kotlin 1.8.20, you can use Objective-C headers with <code class="code" id="p6l019_428">@import</code>. To do so, pass the <code class="code" id="p6l019_429">-fmodules</code> option to the compiler in the definition file as <code class="code" id="p6l019_430">compilerOpts</code>. If you use <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-overview.html" id="p6l019_431" data-external="true" rel="noopener noreferrer" target="_blank">CocoaPods integration</a>, specify the cinterop option in the configuration block of the <code class="code" id="p6l019_432">pod()</code> function like this:</p><div class="code-block" data-lang="kotlin">
kotlin {
    ios()

    cocoapods {
        summary = &quot;CocoaPods test library&quot;
        homepage = &quot;https://github.com/JetBrains/kotlin&quot;

        ios.deploymentTarget = &quot;13.5&quot;

        pod(&quot;PodName&quot;) {
            extraOpts = listOf(&quot;-compiler-option&quot;, &quot;-fmodules&quot;)
        }
    }
}
</div><p id="p6l019_421">This was a <a href="https://youtrack.jetbrains.com/issue/KT-39120" id="p6l019_433" data-external="true" rel="noopener noreferrer" target="_blank">highly awaited feature</a>, and we welcome your feedback about it in <a href="https://kotl.in/issue" id="p6l019_434" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a> to help us make it the default in future releases.</p></section><section class="chapter"><h3 id="support-for-the-link-only-mode-in-cocoapods-gradle-plugin" data-toc="support-for-the-link-only-mode-in-cocoapods-gradle-plugin">Support for the link-only mode in Cocoapods Gradle plugin</h3><p id="p6l019_435">With Kotlin 1.8.20, you can use Pod dependencies with dynamic frameworks only for linking, without generating cinterop bindings. This may come in handy when cinterop bindings are already generated.</p><p id="p6l019_436">Consider a project with 2 modules, a library and an app. The library depends on a Pod but doesn't produce a framework, only a <code class="code" id="p6l019_440">.klib</code>. The app depends on the library and produces a dynamic framework. In this case, you need to link this framework with the Pods that the library depends on, but you don't need cinterop bindings because they are already generated for the library.</p><p id="p6l019_437">To enable the feature, use the <code class="code" id="p6l019_441">linkOnly</code> option or a builder property when adding a dependency on a Pod:</p><div class="code-block" data-lang="kotlin">
cocoapods {
    summary = &quot;CocoaPods test library&quot;
    homepage = &quot;https://github.com/JetBrains/kotlin&quot;

    pod(&quot;Alamofire&quot;, linkOnly = true) {
        version = &quot;5.7.0&quot;
    }
}
</div><aside class="prompt" data-type="note" data-title="" id="p6l019_439"><p id="p6l019_442">If you use this option with static frameworks, it will remove the Pod dependency entirely because Pods are not used for static framework linking.</p></aside></section><section class="chapter"><h3 id="import-objective-c-extensions-as-class-members-in-uikit" data-toc="import-objective-c-extensions-as-class-members-in-uikit">Import Objective-C extensions as class members in UIKit</h3><p id="p6l019_443">Since Xcode 14.1, some methods from Objective-C classes have been moved to category members. That led to the generation of a different Kotlin API, and these methods were imported as Kotlin extensions instead of methods.</p><p id="p6l019_444">You may have experienced issues resulting from this when overriding methods using UIKit. For example, it became impossible to override <code class="code" id="p6l019_447">drawRect()</code> or <code class="code" id="p6l019_448">layoutSubviews()</code> methods when subclassing a UIVIew in Kotlin.</p><p id="p6l019_445">Since 1.8.20, category members that are declared in the same headers as NSView and UIView classes are imported as members of these classes. This means that the methods subclassing from NSView and UIView can be easily overridden, like any other method.</p><p id="p6l019_446">If everything goes well, we're planning to enable this behavior by default for all of the Objective-C classes.</p></section><section class="chapter"><h3 id="reimplementation-of-compiler-cache-management-in-the-compiler" data-toc="reimplementation-of-compiler-cache-management-in-the-compiler">Reimplementation of compiler cache management in the compiler</h3><p id="p6l019_449">To speed up the evolution of compiler caches, we've moved compiler cache management from the Kotlin Gradle plugin to the Kotlin/Native compiler. This unblocks work on several important improvements, including those to do with compilation times and compiler cache flexibility.</p><p id="p6l019_450">If you encounter some problem and need to return to the old behavior, use the <code class="code" id="p6l019_452">kotlin.native.cacheOrchestration=gradle</code> Gradle property.</p><p id="p6l019_451">We would appreciate your feedback on this <a href="https://kotl.in/issue" id="p6l019_453" data-external="true" rel="noopener noreferrer" target="_blank">in YouTrack</a>.</p></section><section class="chapter"><h3 id="deprecation-of-uselibraries-in-cocoapods-gradle-plugin" data-toc="deprecation-of-uselibraries-in-cocoapods-gradle-plugin">Deprecation of useLibraries() in Cocoapods Gradle plugin</h3><p id="p6l019_454">Kotlin 1.8.20 starts the deprecation cycle of the <code class="code" id="p6l019_458">useLibraries()</code> function used in the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-overview.html" id="p6l019_459" data-external="true" rel="noopener noreferrer" target="_blank">CocoaPods integration</a> for static libraries.</p><p id="p6l019_455">We introduced the <code class="code" id="p6l019_460">useLibraries()</code> function to allow dependencies on Pods containing static libraries. With time, this case has become very rare. Most of the Pods are distributed by sources, and Objective-C frameworks or XCFrameworks are a common choice for binary distribution.</p><p id="p6l019_456">Since this function is unpopular and it creates issues that complicate the development of the Kotlin CocoaPods Gradle plugin, we've decided to deprecate it.</p><p id="p6l019_457">For more information on frameworks and XCFrameworks, see <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-build-native-binaries.html" id="p6l019_461" data-external="true" rel="noopener noreferrer" target="_blank">Build final native binaries</a>.</p></section></section><section class="chapter"><h2 id="kotlin-multiplatform" data-toc="kotlin-multiplatform">Kotlin Multiplatform</h2><p id="p6l019_462">Kotlin 1.8.20 strives to improve the developer experience with the following updates to Kotlin Multiplatform:</p><ul class="list _bullet" id="p6l019_463"><li class="list__item" id="p6l019_467"><p id="p6l019_470"><a href="#new-approach-to-source-set-hierarchy" id="p6l019_471">New approach for setting up source set hierarchy</a></p></li><li class="list__item" id="p6l019_468"><p id="p6l019_472"><a href="#preview-of-gradle-composite-builds-support-in-kotlin-multiplatform" id="p6l019_473">Preview of Gradle composite builds support in Kotlin Multiplatform</a></p></li><li class="list__item" id="p6l019_469"><p id="p6l019_474"><a href="#improved-output-for-gradle-errors-in-xcode" id="p6l019_475">Improved output for Gradle errors in Xcode</a></p></li></ul><section class="chapter"><h3 id="new-approach-to-source-set-hierarchy" data-toc="new-approach-to-source-set-hierarchy">New approach to source set hierarchy</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_476"><p id="p6l019_483">The new approach to source set hierarchy is <a href="components-stability.html#stability-levels-explained" id="p6l019_484">Experimental</a>. It may be changed in future Kotlin releases without prior notice. Opt-in is required (see the details below). We would appreciate your feedback in <a href="https://kotl.in/issue" id="p6l019_485" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_477">Kotlin 1.8.20 offers a new way of setting up source set hierarchy in your multiplatform projects &minus; the default target hierarchy. The new approach is intended to replace target shortcuts like <code class="code" id="p6l019_486">ios</code>, which have their <a href="#why-replace-shortcuts" id="p6l019_487">design flaws</a>.</p><p id="p6l019_478">The idea behind the default target hierarchy is simple: You explicitly declare all the targets to which your project compiles, and the Kotlin Gradle plugin automatically creates shared source sets based on the specified targets.</p><section class="chapter"><h4 id="set-up-your-project" data-toc="set-up-your-project">Set up your project</h4><p id="p6l019_488">Consider this example of a simple multiplatform mobile app:</p><div class="code-block" data-lang="kotlin">
@OptIn(ExperimentalKotlinGradlePluginApi::class)
kotlin {
    // Enable the default target hierarchy:
    targetHierarchy.default()

    android()
    iosArm64()
    iosSimulatorArm64()
}
</div><p id="p6l019_490">You can think of the default target hierarchy as a template for all possible targets and their shared source sets. When you declare the final targets <code class="code" id="p6l019_496">android</code>, <code class="code" id="p6l019_497">iosArm64</code>, and <code class="code" id="p6l019_498">iosSimulatorArm64</code> in your code, the Kotlin Gradle plugin finds suitable shared source sets from the template and creates them for you. The resulting hierarchy looks like this:</p><figure id="p6l019_491"><a href="images/default-hierarchy-example.svg" class="lightbox"><img alt="An example of using the default target hierarchy" src="images/default-hierarchy-example.svg" title="An example of using the default target hierarchy" width="350" height="225"></a></figure><p id="p6l019_492">Green source sets are actually created and present in the project, while gray ones from the default template are ignored. As you can see, the Kotlin Gradle plugin hasn't created the <code class="code" id="p6l019_499">watchos</code> source set, for example, because there are no watchOS targets in the project.</p><p id="p6l019_493">If you add a watchOS target, such as <code class="code" id="p6l019_500">watchosArm64</code>, the <code class="code" id="p6l019_501">watchos</code> source set is created, and the code from the <code class="code" id="p6l019_502">apple</code>, <code class="code" id="p6l019_503">native</code>, and <code class="code" id="p6l019_504">common</code> source sets is compiled to <code class="code" id="p6l019_505">watchosArm64</code>, as well.</p><p id="p6l019_494">You can find the complete scheme for the default target hierarchy in the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-hierarchy.html#default-hierarchy-template" id="p6l019_506" data-external="true" rel="noopener noreferrer" target="_blank">documentation</a>.</p><aside class="prompt" data-type="note" data-title="" id="p6l019_495"><p id="p6l019_507">In this example, the <code class="code" id="p6l019_508">apple</code> and <code class="code" id="p6l019_509">native</code> source sets compile only to the <code class="code" id="p6l019_510">iosArm64</code> and <code class="code" id="p6l019_511">iosSimulatorArm64</code> targets. Therefore, despite their names, they have access to the full iOS API. This might be counter-intuitive for source sets like <code class="code" id="p6l019_512">native</code>, as you may expect that only APIs available on all native targets are accessible in this source set. This behavior may change in the future.</p></aside></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h4 id="why-replace-shortcuts" data-toc="why-replace-shortcuts">Why replace shortcuts</h4></div><div class="collapse__content"><p id="p6l019_513">Creating source sets hierarchies can be verbose, error-prone, and unfriendly for beginners. Our previous solution was to introduce shortcuts like <code class="code" id="p6l019_518">ios</code> that create a part of the hierarchy for you. However, working with shortcuts proved they have a big design flaw: they're difficult to change.</p><p id="p6l019_514">Take the <code class="code" id="p6l019_519">ios</code> shortcut, for example. It creates only the <code class="code" id="p6l019_520">iosArm64</code> and <code class="code" id="p6l019_521">iosX64</code> targets, which can be confusing and may lead to issues when working on an M1-based host that requires the <code class="code" id="p6l019_522">iosSimulatorArm64</code> target as well. However, adding the <code class="code" id="p6l019_523">iosSimulatorArm64</code> target can be a very disruptive change for user projects:</p><ul class="list _bullet" id="p6l019_515"><li class="list__item" id="p6l019_524"><p id="p6l019_527">All dependencies used in the <code class="code" id="p6l019_528">iosMain</code> source set have to support the <code class="code" id="p6l019_529">iosSimulatorArm64</code> target; otherwise, the dependency resolution fails.</p></li><li class="list__item" id="p6l019_525"><p id="p6l019_530">Some native APIs used in <code class="code" id="p6l019_531">iosMain</code> may disappear when adding a new target (though this is unlikely in the case of <code class="code" id="p6l019_532">iosSimulatorArm64</code>).</p></li><li class="list__item" id="p6l019_526"><p id="p6l019_533">In some cases, such as when writing a small pet project on your Intel-based MacBook, you might not even need this change.</p></li></ul><p id="p6l019_516">It became clear that shortcuts didn't solve the problem of configuring hierarchies, which is why we stopped adding new shortcuts at some point.</p><p id="p6l019_517">The default target hierarchy may look similar to shortcuts at first glance, but they have a crucial distinction: <span class="control" id="p6l019_534">users have to explicitly specify the set of targets</span>. This set defines how your project is compiled and published and how it participates in dependency resolution. Since this set is fixed, changes to the default configuration from the Kotlin Gradle plugin should cause significantly less distress in the ecosystem, and it will be much easier to provide tooling-assisted migration.</p></div></div></section><section class="chapter"><h4 id="how-to-enable-the-default-hierarchy" data-toc="how-to-enable-the-default-hierarchy">How to enable the default hierarchy</h4><p id="p6l019_535">This new feature is <a href="components-stability.html#stability-levels-explained" id="p6l019_537">Experimental</a>. For Kotlin Gradle build scripts, you need to opt in with <code class="code" id="p6l019_538">@OptIn(ExperimentalKotlinGradlePluginApi::class)</code>.</p><p id="p6l019_536">For more information, see <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-hierarchy.html#default-hierarchy-template" id="p6l019_539" data-external="true" rel="noopener noreferrer" target="_blank">Hierarchical project structure</a>.</p></section><section class="chapter"><h4 id="leave-feedback" data-toc="leave-feedback">Leave feedback</h4><p id="p6l019_540">This is a significant change to multiplatform projects. We would appreciate your <a href="https://kotl.in/issue" id="p6l019_541" data-external="true" rel="noopener noreferrer" target="_blank">feedback</a> to help make it even better.</p></section></section><section class="chapter"><h3 id="preview-of-gradle-composite-builds-support-in-kotlin-multiplatform" data-toc="preview-of-gradle-composite-builds-support-in-kotlin-multiplatform">Preview of Gradle composite builds support in Kotlin Multiplatform</h3><aside class="prompt" data-type="note" data-title="" id="p6l019_542"><p id="p6l019_548">This feature has been supported in Gradle builds since Kotlin Gradle Plugin 1.8.20. For IDE support, use IntelliJ IDEA 2023.1 Beta 2 (231.8109.2) or later and the Kotlin Gradle plugin 1.8.20 with any Kotlin IDE plugin.</p></aside><p id="p6l019_543">Starting with 1.8.20, Kotlin Multiplatform supports <a href="https://docs.gradle.org/current/userguide/composite_builds.html" id="p6l019_549" data-external="true" rel="noopener noreferrer" target="_blank">Gradle composite builds</a>. Composite builds allow you to include builds of separate projects or parts of the same project into a single build.</p><p id="p6l019_544">Due to some technical challenges, using Gradle composite builds with Kotlin Multiplatform was only partially supported. Kotlin 1.8.20 contains a preview of the improved support that should work with a larger variety of projects. To try it out, add the following option to your <code class="code" id="p6l019_550">gradle.properties</code>:</p><div class="code-block" data-lang="none">
kotlin.mpp.import.enableKgpDependencyResolution=true
</div><p id="p6l019_546">This option enables a preview of the new import mode. Besides the support for composite builds, it provides a smoother import experience in multiplatform projects, as we've included major bug fixes and improvements to make the import more stable.</p><section class="chapter"><h4 id="known-issues" data-toc="known-issues">Known issues</h4><p id="p6l019_551">It's still a preview version that needs further stabilization, and you might encounter some issues with import along the way. Here are some known issues we're planning to fix before the final release of Kotlin 1.8.20:</p><ul class="list _bullet" id="p6l019_552"><li class="list__item" id="p6l019_554"><p id="p6l019_556">There's no Kotlin 1.8.20 plugin available for IntelliJ IDEA 2023.1 EAP yet. Despite that, you can still set the Kotlin Gradle plugin version to 1.8.20 and try out composite builds in this IDE.</p></li><li class="list__item" id="p6l019_555"><p id="p6l019_557">If your projects include builds with a specified <code class="code" id="p6l019_558">rootProject.name</code>, composite builds may fail to resolve the Kotlin metadata. For the workaround and details, see this <a href="https://youtrack.jetbrains.com/issue/KT-56536" id="p6l019_559" data-external="true" rel="noopener noreferrer" target="_blank">Youtrack issue</a>.</p></li></ul><p id="p6l019_553">We encourage you to try it out and submit all reports on <a href="https://kotl.in/issue" id="p6l019_560" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a> to help us make it the default in Kotlin 1.9.0.</p></section></section><section class="chapter"><h3 id="improved-output-for-gradle-errors-in-xcode" data-toc="improved-output-for-gradle-errors-in-xcode">Improved output for Gradle errors in Xcode</h3><p id="p6l019_561">If you had issues building your multiplatform projects in Xcode, you might have encountered a &quot;Command PhaseScriptExecution failed with a nonzero exit code&quot; error. This message signals that the Gradle invocation has failed, but it's not very helpful when trying to detect the problem.</p><p id="p6l019_562">Starting with Kotlin 1.8.20, Xcode can parse the output from the Kotlin/Native compiler. Furthermore, in case the Gradle build fails, you'll see an additional error message from the root cause exception in Xcode. In most cases, it'll help to identify the root problem.</p><figure id="p6l019_563"><img alt="Improved output for Gradle errors in Xcode" src="images/xcode-gradle-output.png" title="Improved output for Gradle errors in Xcode" width="700" height="412"></figure><p id="p6l019_564">The new behavior is enabled by default for the standard Gradle tasks for Xcode integration, like <code class="code" id="p6l019_565">embedAndSignAppleFrameworkForXcode</code> that can connect the iOS framework from your multiplatform project to the iOS application in Xcode. It can also be enabled (or disabled) with the <code class="code" id="p6l019_566">kotlin.native.useXcodeMessageStyle</code> Gradle property.</p></section></section><section class="chapter"><h2 id="kotlin-javascript" data-toc="kotlin-javascript">Kotlin/JavaScript</h2><p id="p6l019_567">Kotlin 1.8.20 changes the ways TypeScript definitions can be generated. It also includes a change designed to improve your debugging experience:</p><ul class="list _bullet" id="p6l019_568"><li class="list__item" id="p6l019_572"><p id="p6l019_575"><a href="#removal-of-dukat-integration-from-gradle-plugin" id="p6l019_576">Removal of Dukat integration from the Gradle plugin</a></p></li><li class="list__item" id="p6l019_573"><p id="p6l019_577"><a href="#kotlin-variable-and-function-names-in-source-maps" id="p6l019_578">Kotlin variable and function names in source maps</a></p></li><li class="list__item" id="p6l019_574"><p id="p6l019_579"><a href="#opt-in-for-generation-of-typescript-definition-files" id="p6l019_580">Opt in for generation of TypeScript definition files</a></p></li></ul><section class="chapter"><h3 id="removal-of-dukat-integration-from-gradle-plugin" data-toc="removal-of-dukat-integration-from-gradle-plugin">Removal of Dukat integration from Gradle plugin</h3><p id="p6l019_581">In Kotlin 1.8.20, we've removed our <a href="components-stability.html#stability-levels-explained" id="p6l019_584">Experimental</a> Dukat integration from the Kotlin/JavaScript Gradle plugin. The Dukat integration supported the automatic conversion of TypeScript declaration files (<code class="code" id="p6l019_585">.d.ts</code>) into Kotlin external declarations.</p><p id="p6l019_582">You can still convert TypeScript declaration files (<code class="code" id="p6l019_586">.d.ts</code>) into Kotlin external declarations by using our <a href="https://github.com/Kotlin/dukat" id="p6l019_587" data-external="true" rel="noopener noreferrer" target="_blank">Dukat tool</a> instead.</p><aside class="prompt" data-type="warning" data-title="" id="p6l019_583"><p id="p6l019_588">The Dukat tool is <a href="components-stability.html#stability-levels-explained" id="p6l019_589">Experimental</a>. It may be dropped or changed at any time.</p></aside></section><section class="chapter"><h3 id="kotlin-variable-and-function-names-in-source-maps" data-toc="kotlin-variable-and-function-names-in-source-maps">Kotlin variable and function names in source maps</h3><p id="p6l019_590">To help with debugging, we've introduced the ability to add the names that you declared in Kotlin code for variables and functions into your source maps. Prior to 1.8.20, these weren't available in source maps, so in the debugger, you always saw the variable and function names of the generated JavaScript.</p><p id="p6l019_591">You can configure what is added by using <code class="code" id="p6l019_597">sourceMapNamesPolicy</code> in your Gradle file <code class="code" id="p6l019_598">build.gradle.kts</code>, or the <code class="code" id="p6l019_599">-source-map-names-policy</code> compiler option. The table below lists the possible settings:</p><div class="table-wrapper"><table class="wide" id="p6l019_592"><thead><tr class="ijRowHead" id="p6l019_600"><th id="p6l019_604"><p>Setting</p></th><th id="p6l019_605"><p>Description</p></th><th id="p6l019_606"><p>Example output</p></th></tr></thead><tbody><tr id="p6l019_601"><td id="p6l019_607"><p><code class="code" id="p6l019_610">simple-names</code></p></td><td id="p6l019_608"><p>Variable names and simple function names are added. (Default)</p></td><td id="p6l019_609"><p><code class="code" id="p6l019_611">main</code></p></td></tr><tr id="p6l019_602"><td id="p6l019_612"><p><code class="code" id="p6l019_615">fully-qualified-names</code></p></td><td id="p6l019_613"><p>Variable names and fully qualified function names are added.</p></td><td id="p6l019_614"><p><code class="code" id="p6l019_616">com.example.kjs.playground.main</code></p></td></tr><tr id="p6l019_603"><td id="p6l019_617"><p><code class="code" id="p6l019_620">no</code></p></td><td id="p6l019_618"><p>No variable or function names are added.</p></td><td id="p6l019_619"><p>N/A</p></td></tr></tbody></table></div><p id="p6l019_593">See below for an example configuration in a <code class="code" id="p6l019_621">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.Kotlin2JsCompile&gt;().configureEach {
    compilercompileOptions.sourceMapNamesPolicy.set(org.jetbrains.kotlin.gradle.dsl.JsSourceMapNamesPolicy.SOURCE_MAP_NAMES_POLICY_FQ_NAMES) // or SOURCE_MAP_NAMES_POLICY_NO, or SOURCE_MAP_NAMES_POLICY_SIMPLE_NAMES
}
</div><p id="p6l019_595">Debugging tools like those provided in Chromium-based browsers can pick up the original Kotlin names from your source map to improve the readability of your stack trace. Happy debugging!</p><aside class="prompt" data-type="warning" data-title="" id="p6l019_596"><p id="p6l019_622">The addition of variable and function names in source maps is <a href="components-stability.html#stability-levels-explained" id="p6l019_623">Experimental</a>. It may be dropped or changed at any time.</p></aside></section><section class="chapter"><h3 id="opt-in-for-generation-of-typescript-definition-files" data-toc="opt-in-for-generation-of-typescript-definition-files">Opt in for generation of TypeScript definition files</h3><p id="p6l019_624">Previously, if you had a project that produced executable files (<code class="code" id="p6l019_628">binaries.executable()</code>), the Kotlin/JS IR compiler collected any top-level declarations marked with <code class="code" id="p6l019_629">@JsExport</code> and automatically generated TypeScript definitions in a <code class="code" id="p6l019_630">.d.ts</code> file.</p><p id="p6l019_625">As this isn't useful for every project, we've changed the behavior in Kotlin 1.8.20. If you want to generate TypeScript definitions, you have to explicitly configure this in your Gradle build file. Add <code class="code" id="p6l019_631">generateTypeScriptDefinitions()</code> to your <code class="code" id="p6l019_632">build.gradle.kts.file</code> in the <a href="js-project-setup.html#execution-environments" id="p6l019_633"><code class="code" id="p6l019_634">js</code> section</a>. For example:</p><div class="code-block" data-lang="kotlin">
kotlin {
    js {
        binaries.executable()
        browser {
        }
        generateTypeScriptDefinitions()
    }
}
</div><aside class="prompt" data-type="warning" data-title="" id="p6l019_627"><p id="p6l019_635">The generation of TypeScript definitions (<code class="code" id="p6l019_636">d.ts</code>) is <a href="components-stability.html#stability-levels-explained" id="p6l019_637">Experimental</a>. It may be dropped or changed at any time.</p></aside></section></section><section class="chapter"><h2 id="gradle" data-toc="gradle">Gradle</h2><p id="p6l019_638">Kotlin 1.8.20 is fully compatible with Gradle 6.8 through 7.6 except for some <a href="https://youtrack.jetbrains.com/issue/KT-55751" id="p6l019_647" data-external="true" rel="noopener noreferrer" target="_blank">special cases in the Multiplatform plugin</a>. You can also use Gradle versions up to the latest Gradle release, but if you do, keep in mind that you might encounter deprecation warnings or some new Gradle features might not work.</p><p id="p6l019_639">This version brings the following changes:</p><ul class="list _bullet" id="p6l019_640"><li class="list__item" id="p6l019_648"><p id="p6l019_654"><a href="#new-gradle-plugins-versions-alignment" id="p6l019_655">New alignment of Gradle plugins' versions</a></p></li><li class="list__item" id="p6l019_649"><p id="p6l019_656"><a href="#new-jvm-incremental-compilation-by-default-in-gradle" id="p6l019_657">New JVM incremental compilation by default in Gradle</a></p></li><li class="list__item" id="p6l019_650"><p id="p6l019_658"><a href="#precise-backup-of-compilation-tasks-outputs" id="p6l019_659">Precise backup of compilation tasks' outputs</a></p></li><li class="list__item" id="p6l019_651"><p id="p6l019_660"><a href="#lazy-kotlin-jvm-tasks-creation-for-all-gradle-versions" id="p6l019_661">Lazy Kotlin/JVM task creation for all Gradle versions</a></p></li><li class="list__item" id="p6l019_652"><p id="p6l019_662"><a href="#non-default-location-of-compile-tasks-destinationdirectory" id="p6l019_663">Non-default location of compile tasks' destinationDirectory</a></p></li><li class="list__item" id="p6l019_653"><p id="p6l019_664"><a href="#ability-to-opt-out-from-reporting-compiler-arguments-to-an-http-statistics-service" id="p6l019_665">Ability to opt-out from reporting compiler arguments to an HTTP statistics service</a></p></li></ul><section class="chapter"><h3 id="new-gradle-plugins-versions-alignment" data-toc="new-gradle-plugins-versions-alignment">New Gradle plugins versions alignment</h3><p id="p6l019_666">Gradle provides a way to ensure dependencies that must work together are always <a href="https://docs.gradle.org/current/userguide/dependency_version_alignment.html#aligning_versions_natively_with_gradle" id="p6l019_668" data-external="true" rel="noopener noreferrer" target="_blank">aligned in their versions</a>. Kotlin 1.8.20 adopted this approach, too. It works by default so that you don't need to change or update your configuration to enable it. In addition, you no longer need to resort to <a href="whatsnew18.html#resolution-of-kotlin-gradle-plugins-transitive-dependencies" id="p6l019_669">this workaround for resolving Kotlin Gradle plugins' transitive dependencies</a>.</p><p id="p6l019_667">We would appreciate your feedback on this feature in <a href="https://youtrack.jetbrains.com/issue/KT-54691" id="p6l019_670" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section><section class="chapter"><h3 id="new-jvm-incremental-compilation-by-default-in-gradle" data-toc="new-jvm-incremental-compilation-by-default-in-gradle">New JVM incremental compilation by default in Gradle</h3><p id="p6l019_671">The new approach to incremental compilation, which <a href="whatsnew17.html#a-new-approach-to-incremental-compilation" id="p6l019_673">has been available since Kotlin 1.7.0</a>, now works by default. You no longer need to specify <code class="code" id="p6l019_674">kotlin.incremental.useClasspathSnapshot=true</code> in your <code class="code" id="p6l019_675">gradle.properties</code> to enable it.</p><p id="p6l019_672">We would appreciate your feedback on this. You can <a href="https://kotl.in/issue" id="p6l019_676" data-external="true" rel="noopener noreferrer" target="_blank">file an issue</a> in YouTrack.</p></section><section class="chapter"><h3 id="precise-backup-of-compilation-tasks-outputs" data-toc="precise-backup-of-compilation-tasks-outputs">Precise backup of compilation tasks' outputs</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_677"><p id="p6l019_683">Precise backup of compilation tasks' outputs is <a href="components-stability.html#stability-levels-explained" id="p6l019_684">Experimental</a>. To use it, add <code class="code" id="p6l019_685">kotlin.compiler.preciseCompilationResultsBackup=true</code> to <code class="code" id="p6l019_686">gradle.properties</code>. We would appreciate your feedback on it in <a href="https://kotl.in/issue/experimental-ic-optimizations" id="p6l019_687" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_678">Starting with Kotlin 1.8.20, you can enable precise backup, whereby only those classes that Kotlin recompiles in the <a href="gradle-compilation-and-caches.html#incremental-compilation" id="p6l019_688">incremental compilation</a> will be backed up. Both full and precise backups help to run builds incrementally again after compilation errors. Precise backup also saves build time compared to full backup. Full backup may take <span class="control" id="p6l019_689">noticeable</span> build time in large projects or if many tasks are making backups, especially if a project is located on a slow HDD.</p><p id="p6l019_679">This optimization is Experimental. You can enable it by adding the <code class="code" id="p6l019_690">kotlin.compiler.preciseCompilationResultsBackup</code> Gradle property to the <code class="code" id="p6l019_691">gradle.properties</code> file:</p><div class="code-block" data-lang="none">
kotlin.compiler.preciseCompilationResultsBackup=true
</div><section class="chapter"><div class="collapse"><div class="collapse__title"><h4 id="example-of-precise-backup-usage-in-jetbrains" data-toc="example-of-precise-backup-usage-in-jetbrains">Example of precise backup usage in JetBrains</h4></div><div class="collapse__content"><p id="p6l019_692">In the following charts, you can see examples of using precise backup compared to full backup:</p><figure id="p6l019_693"><img alt="Comparison of full and precise backups" src="images/comparison-of-full-and-precise-backups.png" title="Comparison of full and precise backups" width="700" height="236"></figure><p id="p6l019_694">The first and second charts show how precise backup in the Kotlin project affects building the Kotlin Gradle plugin:</p><ol class="list _decimal" id="p6l019_695" type="1"><li class="list__item" id="p6l019_699"><p id="p6l019_701">After making a small <a href="https://en.wikipedia.org/wiki/Application_binary_interface" id="p6l019_702" data-external="true" rel="noopener noreferrer" target="_blank">ABI</a> change &ndash; adding a new public method &ndash; to a module that lots of modules depend on.</p></li><li class="list__item" id="p6l019_700"><p id="p6l019_703">After making a small non-ABI change &ndash; adding a private function &ndash; to a module that no other modules depend on.</p></li></ol><p id="p6l019_696">The third chart shows how precise backup in the <a href="https://www.jetbrains.com/space/" id="p6l019_704" data-external="true" rel="noopener noreferrer" target="_blank">Space</a> project affects building a web frontend after a small non-ABI change &ndash; adding a private function &ndash; to a Kotlin/JS module that lots of modules depend on.</p><p id="p6l019_697">These measurements were performed on a computer with the Apple M1 Max CPU; different computers will yield slightly different results. The factors affecting performance include but are not limited to:</p><ul class="list _bullet" id="p6l019_698"><li class="list__item" id="p6l019_705"><p id="p6l019_710">How warm the <a href="gradle-compilation-and-caches.html#the-kotlin-daemon-and-how-to-use-it-with-gradle" id="p6l019_711">Kotlin daemon</a> and the <a href="https://docs.gradle.org/current/userguide/gradle_daemon.html" id="p6l019_712" data-external="true" rel="noopener noreferrer" target="_blank">Gradle daemon</a> are.</p></li><li class="list__item" id="p6l019_706"><p id="p6l019_713">How fast or slow the disk is.</p></li><li class="list__item" id="p6l019_707"><p id="p6l019_714">The CPU model and how busy it is.</p></li><li class="list__item" id="p6l019_708"><p id="p6l019_715">Which modules are affected by the changes and how big these modules are.</p></li><li class="list__item" id="p6l019_709"><p id="p6l019_716">Whether the changes are ABI or non-ABI.</p></li></ul></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h4 id="evaluating-optimizations-with-build-reports" data-toc="evaluating-optimizations-with-build-reports">Evaluating optimizations with build reports</h4></div><div class="collapse__content"><p id="p6l019_717">To estimate the impact of the optimization on your computer for your project and your scenarios, you can use <a href="gradle-compilation-and-caches.html#build-reports" id="p6l019_723">Kotlin build reports</a>. Enable reports in the text file format by adding the following property to your <code class="code" id="p6l019_724">gradle.properties</code> file:</p><div class="code-block" data-lang="none">
kotlin.build.report.output=file
</div><p id="p6l019_719">Here is an example of a relevant part of the report before enabling precise backup:</p><div class="code-block" data-lang="none">
Task ':kotlin-gradle-plugin:compileCommonKotlin' finished in 0.59 s
&lt;...&gt;
Time metrics:
 Total Gradle task time: 0.59 s
 Task action before worker execution: 0.24 s
  Backup output: 0.22 s // Pay attention to this number 
&lt;...&gt;
</div><p id="p6l019_721">And here is an example of a relevant part of the report after enabling precise backup:</p><div class="code-block" data-lang="none">
Task ':kotlin-gradle-plugin:compileCommonKotlin' finished in 0.46 s
&lt;...&gt;
Time metrics:
 Total Gradle task time: 0.46 s
 Task action before worker execution: 0.07 s
  Backup output: 0.05 s // The time has reduced
 Run compilation in Gradle worker: 0.32 s
  Clear jar cache: 0.00 s
  Precise backup output: 0.00 s // Related to precise backup
  Cleaning up the backup stash: 0.00 s // Related to precise backup
&lt;...&gt;
</div></div></div></section></section><section class="chapter"><h3 id="lazy-kotlin-jvm-tasks-creation-for-all-gradle-versions" data-toc="lazy-kotlin-jvm-tasks-creation-for-all-gradle-versions">Lazy Kotlin/JVM tasks creation for all Gradle versions</h3><p id="p6l019_725">For projects with the <code class="code" id="p6l019_726">org.jetbrains.kotlin.gradle.jvm</code> plugin on Gradle 7.3+, the Kotlin Gradle plugin no longer creates and configures the task <code class="code" id="p6l019_727">compileKotlin</code> eagerly. On lower Gradle versions, it simply registers all the tasks and doesn't configure them on a dry run. The same behavior is now in place when using Gradle 7.3+.</p></section><section class="chapter"><h3 id="non-default-location-of-compile-tasks-destinationdirectory" data-toc="non-default-location-of-compile-tasks-destinationdirectory">Non-default location of compile tasks' destinationDirectory</h3><p id="p6l019_728">Update your build script with some additional code if you do one of the following:</p><ul class="list _bullet" id="p6l019_729"><li class="list__item" id="p6l019_732"><p id="p6l019_734">Override the Kotlin/JVM <code class="code" id="p6l019_735">KotlinJvmCompile</code>/<code class="code" id="p6l019_736">KotlinCompile</code> task's <code class="code" id="p6l019_737">destinationDirectory</code> location.</p></li><li class="list__item" id="p6l019_733"><p id="p6l019_738">Use a deprecated Kotlin/JS/Non-IR <a href="gradle-plugin-variants.html" id="p6l019_739">variant</a> and override the <code class="code" id="p6l019_740">Kotlin2JsCompile</code> task's <code class="code" id="p6l019_741">destinationDirectory</code>.</p></li></ul><p id="p6l019_730">You need to explicitly add <code class="code" id="p6l019_742">sourceSets.main.kotlin.classesDirectories</code> to <code class="code" id="p6l019_743">sourceSets.main.outputs</code> in your JAR file:</p><div class="code-block" data-lang="groovy">
tasks.jar(type: Jar) {
    from sourceSets.main.outputs
    from sourceSets.main.kotlin.classesDirectories
}
</div></section><section class="chapter"><h3 id="ability-to-opt-out-from-reporting-compiler-arguments-to-an-http-statistics-service" data-toc="ability-to-opt-out-from-reporting-compiler-arguments-to-an-http-statistics-service">Ability to opt-out from reporting compiler arguments to an HTTP statistics service</h3><p id="p6l019_744">You can now control whether the Kotlin Gradle plugin should include compiler arguments in HTTP <a href="gradle-compilation-and-caches.html#build-reports" id="p6l019_746">build reports</a>. Sometimes, you might not need the plugin to report these arguments. If a project contains many modules, its compiler arguments in the report can be very heavy and not that helpful. There is now a way to disable it and thus save memory. In your <code class="code" id="p6l019_747">gradle.properties</code> or <code class="code" id="p6l019_748">local.properties</code>, use the <code class="code" id="p6l019_749">kotlin.build.report.include_compiler_arguments=(true|false)</code> property.</p><p id="p6l019_745">We would appreciate your feedback on this feature on <a href="https://youtrack.jetbrains.com/issue/KT-55323/" id="p6l019_750" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section></section><section class="chapter"><h2 id="standard-library" data-toc="standard-library">Standard library</h2><p id="p6l019_751">Kotlin 1.8.20 adds a variety of new features, including some that are particularly useful for Kotlin/Native development:</p><ul class="list _bullet" id="p6l019_752"><li class="list__item" id="p6l019_757"><p id="p6l019_761"><a href="#support-for-the-autocloseable-interface" id="p6l019_762">Support for the AutoCloseable interface</a></p></li><li class="list__item" id="p6l019_758"><p id="p6l019_763"><a href="#support-for-base64-encoding" id="p6l019_764">Support for Base64 encoding and decoding</a></p></li><li class="list__item" id="p6l019_759"><p id="p6l019_765"><a href="#support-for-volatile-in-kotlin-native" id="p6l019_766">Support for @Volatile in Kotlin/Native</a></p></li><li class="list__item" id="p6l019_760"><p id="p6l019_767"><a href="#bug-fix-for-stack-overflow-when-using-regex-in-kotlin-native" id="p6l019_768">Bug fix for stack overflow when using regex in Kotlin/Native</a></p></li></ul><section class="chapter"><h3 id="support-for-the-autocloseable-interface" data-toc="support-for-the-autocloseable-interface">Support for the AutoCloseable interface</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_769"><p id="p6l019_774">The new <code class="code" id="p6l019_775">AutoCloseable</code> interface is <a href="components-stability.html#stability-levels-explained" id="p6l019_776">Experimental</a>, and to use it you need to opt in with <code class="code" id="p6l019_777">@OptIn(ExperimentalStdlibApi::class)</code> or the compiler argument <code class="code" id="p6l019_778">-opt-in=kotlin.ExperimentalStdlibApi</code>.</p></aside><p id="p6l019_770">The <code class="code" id="p6l019_779">AutoCloseable</code> interface has been added to the common standard library so that you can use one common interface for all libraries to close resources. In Kotlin/JVM, the <code class="code" id="p6l019_780">AutoCloseable</code> interface is an alias for <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/AutoCloseable.html" id="p6l019_781" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="p6l019_782">java.lang.AutoClosable</code></a>.</p><p id="p6l019_771">In addition, the extension function <code class="code" id="p6l019_783">use()</code> is now included, which executes a given block function on the selected resource and then closes it down correctly, whether an exception is thrown or not.</p><p id="p6l019_772">There is no public class in the common standard library that implements the <code class="code" id="p6l019_784">AutoCloseable</code> interface. In the example below, we define the <code class="code" id="p6l019_785">XMLWriter</code> interface and assume that there is a resource that implements it. For example, this resource could be a class that opens a file, writes XML content, and then closes it.</p><div class="code-block" data-lang="kotlin">
interface XMLWriter : AutoCloseable {
    fun document(encoding: String, version: String, content: XMLWriter.() -&gt; Unit)
    fun element(name: String, content: XMLWriter.() -&gt; Unit)
    fun attribute(name: String, value: String)
    fun text(value: String)
}

fun writeBooksTo(writer: XMLWriter) {
    writer.use { xml -&gt;
        xml.document(encoding = &quot;UTF-8&quot;, version = &quot;1.0&quot;) {
            element(&quot;bookstore&quot;) {
                element(&quot;book&quot;) {
                    attribute(&quot;category&quot;, &quot;fiction&quot;)
                    element(&quot;title&quot;) { text(&quot;Harry Potter and the Prisoner of Azkaban&quot;) }
                    element(&quot;author&quot;) { text(&quot;J. K. Rowling&quot;) }
                    element(&quot;year&quot;) { text(&quot;1999&quot;) }
                    element(&quot;price&quot;) { text(&quot;29.99&quot;) }
                }
                element(&quot;book&quot;) {
                    attribute(&quot;category&quot;, &quot;programming&quot;)
                    element(&quot;title&quot;) { text(&quot;Kotlin in Action&quot;) }
                    element(&quot;author&quot;) { text(&quot;Dmitry Jemerov&quot;) }
                    element(&quot;author&quot;) { text(&quot;Svetlana Isakova&quot;) }
                    element(&quot;year&quot;) { text(&quot;2017&quot;) }
                    element(&quot;price&quot;) { text(&quot;25.19&quot;) }
                }
            }
        }
    }
}
</div></section><section class="chapter"><h3 id="support-for-base64-encoding" data-toc="support-for-base64-encoding">Support for Base64 encoding</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_786"><p id="p6l019_794">The new encoding and decoding functionality is <a href="components-stability.html#stability-levels-explained" id="p6l019_795">Experimental</a>, and to use it, you need to opt in with <code class="code" id="p6l019_796">@OptIn(ExperimentalEncodingApi::class)</code> or the compiler argument <code class="code" id="p6l019_797">-opt-in=kotlin.io.encoding.ExperimentalEncodingApi</code>.</p></aside><p id="p6l019_787">We've added support for Base64 encoding and decoding. We provide 3 class instances, each using different encoding schemes and displaying different behaviors. Use the <code class="code" id="p6l019_798">Base64.Default</code> instance for the standard <a href="https://www.rfc-editor.org/rfc/rfc4648#section-4" id="p6l019_799" data-external="true" rel="noopener noreferrer" target="_blank">Base64 encoding scheme</a>.</p><p id="p6l019_788">Use the <code class="code" id="p6l019_800">Base64.UrlSafe</code> instance for the <a href="https://www.rfc-editor.org/rfc/rfc4648#section-5" id="p6l019_801" data-external="true" rel="noopener noreferrer" target="_blank">&quot;URL and Filename safe&quot;</a> encoding scheme.</p><p id="p6l019_789">Use the <code class="code" id="p6l019_802">Base64.Mime</code> instance for the <a href="https://www.rfc-editor.org/rfc/rfc2045#section-6.8" id="p6l019_803" data-external="true" rel="noopener noreferrer" target="_blank">MIME</a> encoding scheme. When you use the <code class="code" id="p6l019_804">Base64.Mime</code> instance, all encoding functions insert a line separator every 76 characters. In the case of decoding, any illegal characters are skipped and don't throw an exception.</p><aside class="prompt" data-type="tip" data-title="" id="p6l019_790"><p id="p6l019_805">The <code class="code" id="p6l019_806">Base64.Default</code> instance is the companion object of the <code class="code" id="p6l019_807">Base64</code> class. As a result, you can call its functions via <code class="code" id="p6l019_808">Base64.encode()</code> and <code class="code" id="p6l019_809">Base64.decode()</code> instead of <code class="code" id="p6l019_810">Base64.Default.encode()</code> and <code class="code" id="p6l019_811">Base64.Default.decode()</code>.</p></aside><div class="code-block" data-lang="kotlin">
val foBytes = &quot;fo&quot;.map { it.code.toByte() }.toByteArray()
Base64.Default.encode(foBytes) // &quot;Zm8=&quot;
// Alternatively:
// Base64.encode(foBytes)

val foobarBytes = &quot;foobar&quot;.map { it.code.toByte() }.toByteArray()
Base64.UrlSafe.encode(foobarBytes) // &quot;Zm9vYmFy&quot;

Base64.Default.decode(&quot;Zm8=&quot;) // foBytes
// Alternatively:
// Base64.decode(&quot;Zm8=&quot;)

Base64.UrlSafe.decode(&quot;Zm9vYmFy&quot;) // foobarBytes
</div><p id="p6l019_792">You can use additional functions to encode or decode bytes into an existing buffer, as well as to append the encoding result to a provided <code class="code" id="p6l019_812">Appendable</code> type object.</p><p id="p6l019_793">In Kotlin/JVM, we've also added the extension functions <code class="code" id="p6l019_813">encodingWith()</code> and <code class="code" id="p6l019_814">decodingWith()</code> to enable you to perform Base64 encoding and decoding with input and output streams.</p></section><section class="chapter"><h3 id="support-for-volatile-in-kotlin-native" data-toc="support-for-volatile-in-kotlin-native">Support for @Volatile in Kotlin/Native</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_815"><p id="p6l019_820"><code class="code" id="p6l019_821">@Volatile</code> in Kotlin/Native is <a href="components-stability.html#stability-levels-explained" id="p6l019_822">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below). Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="p6l019_823" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="p6l019_816">If you annotate a <code class="code" id="p6l019_824">var</code> property with <code class="code" id="p6l019_825">@Volatile</code>, then the backing field is marked so that any reads or writes to this field are atomic, and writes are always made visible to other threads.</p><p id="p6l019_817">Prior to 1.8.20, the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.jvm/-volatile/" id="p6l019_826" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="p6l019_827">kotlin.jvm.Volatile</code> annotation</a> was available in the common standard library. However, this annotation is only effective in the JVM. If you use it in Kotlin/Native, it is ignored, which can lead to errors.</p><p id="p6l019_818">In 1.8.20, we've introduced a common annotation, <code class="code" id="p6l019_828">kotlin.concurrent.Volatile</code>, that you can use in both the JVM and Kotlin/Native.</p><section class="chapter"><h4 id="how-to-enable" data-toc="how-to-enable">How to enable</h4><p id="p6l019_829">To try this feature out, opt in with <code class="code" id="p6l019_831">@OptIn(ExperimentalStdlibApi)</code> and enable the <code class="code" id="p6l019_832">-language-version 1.9</code> compiler option. In a Gradle project, you can do so by adding the following to your <code class="code" id="p6l019_833">build.gradle(.kts)</code> file:</p><div class="tabs" id="p6l019_830" data-group="build-script" data-anchors="[p6l019_834,p6l019_835]"><div class="tabs__content" data-gtm="tab" id="p6l019_834" data-sync-tabs="kotlin" data-title="Kotlin"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
tasks
    .withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask&lt;*&gt;&gt;()
    .configureEach {
        compilerOptions
            .languageVersion
            .set(
                org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
            )
    }
</div></div><div class="tabs__content" data-gtm="tab" id="p6l019_835" data-sync-tabs="groovy" data-title="Groovy"><div class="code-block" data-lang="groovy" data-title="Groovy">
tasks
    .withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask.class)
    .configureEach {
        compilerOptions.languageVersion =
            org.jetbrains.kotlin.gradle.dsl.KotlinVersion.KOTLIN_1_9
    }
</div></div></div></section></section><section class="chapter"><h3 id="bug-fix-for-stack-overflow-when-using-regex-in-kotlin-native" data-toc="bug-fix-for-stack-overflow-when-using-regex-in-kotlin-native">Bug fix for stack overflow when using regex in Kotlin/Native</h3><p id="p6l019_838">In previous versions of Kotlin, a crash could occur if your regex input contained a large number of characters, even when the regex pattern was very simple. In 1.8.20, this issue has been resolved. For more information, see <a href="https://youtrack.jetbrains.com/issue/KT-46211" id="p6l019_839" data-external="true" rel="noopener noreferrer" target="_blank">KT-46211</a>.</p></section></section><section class="chapter"><h2 id="serialization-updates" data-toc="serialization-updates">Serialization updates</h2><p id="p6l019_840">Kotlin 1.8.20 comes with <a href="#prototype-serialization-compiler-plugin-for-kotlin-k2-compiler" id="p6l019_843">Alpha support for the Kotlin K2 compiler</a> and <a href="#prohibit-implicit-serializer-customization-via-companion-object" id="p6l019_844">prohibits serializer customization via companion object</a>.</p><section class="chapter"><h3 id="prototype-serialization-compiler-plugin-for-kotlin-k2-compiler" data-toc="prototype-serialization-compiler-plugin-for-kotlin-k2-compiler">Prototype serialization compiler plugin for Kotlin K2 compiler</h3><aside class="prompt" data-type="warning" data-title="" id="p6l019_845"><p id="p6l019_847">Support for the serialization compiler plugin for K2 is in <a href="components-stability.html#stability-levels-explained" id="p6l019_848">Alpha</a>. To use it, <a href="#how-to-enable-the-kotlin-k2-compiler" id="p6l019_849">enable the Kotlin K2 compiler</a>.</p></aside><p id="p6l019_846">Starting with 1.8.20, the serialization compiler plugin works with the Kotlin K2 compiler. Give it a try and <a href="#leave-your-feedback-on-the-new-k2-compiler" id="p6l019_850">share your feedback with us</a>!</p></section><section class="chapter"><h3 id="prohibit-implicit-serializer-customization-via-companion-object" data-toc="prohibit-implicit-serializer-customization-via-companion-object">Prohibit implicit serializer customization via companion object</h3><p id="p6l019_851">Currently, it is possible to declare a class as serializable with the <code class="code" id="p6l019_860">@Serializable</code> annotation and, at the same time, declare a custom serializer with the <code class="code" id="p6l019_861">@Serializer</code> annotation on its companion object.</p><p id="p6l019_852">For example:</p><div class="code-block" data-lang="kotlin">
import kotlinx.serialization.*

@Serializable
class Foo(val a: Int) {
    @Serializer(Foo::class)
    companion object {
        // Custom implementation of KSerializer&lt;Foo&gt;
    }
}
</div><p id="p6l019_854">In this case, it's not clear from the <code class="code" id="p6l019_862">@Serializable</code> annotation which serializer is used. In actual fact, class <code class="code" id="p6l019_863">Foo</code> has a custom serializer.</p><p id="p6l019_855">To prevent this kind of confusion, in Kotlin 1.8.20 we've introduced a compiler warning for when this scenario is detected. The warning includes a possible migration path to resolve this issue.</p><p id="p6l019_856">If you use such constructs in your code, we recommend updating them to the below:</p><div class="code-block" data-lang="kotlin">
import kotlinx.serialization.*

@Serializable(Foo.Companion::class)
class Foo(val a: Int) {
    // Doesn't matter if you use @Serializer(Foo::class) or not
    companion object: KSerializer&lt;Foo&gt; {
        // Custom implementation of KSerializer&lt;Foo&gt;
    }
}
</div><p id="p6l019_858">With this approach, it is clear that the <code class="code" id="p6l019_864">Foo</code> class uses the custom serializer declared in the companion object. For more information, see our <a href="https://youtrack.jetbrains.com/issue/KT-54441" id="p6l019_865" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack ticket</a>.</p><aside class="prompt" data-type="tip" data-title="" id="p6l019_859"><p id="p6l019_866">In Kotlin 2.0, we plan to promote the compile warning to a compiler error. We recommend that you migrate your code if you see this warning.</p></aside></section></section><section class="chapter"><h2 id="documentation-updates" data-toc="documentation-updates">Documentation updates</h2><p id="p6l019_867">The Kotlin documentation has received some notable changes:</p><ul class="list _bullet" id="p6l019_868"><li class="list__item" id="p6l019_869"><p id="p6l019_872"><a href="jvm-get-started-spring-boot.html" id="p6l019_873">Get started with Spring Boot and Kotlin</a> &ndash; create a simple application with a database and learn more about the features of Spring Boot and Kotlin.</p></li><li class="list__item" id="p6l019_870"><p id="p6l019_874"><a href="scope-functions.html" id="p6l019_875">Scope functions</a> &ndash; learn how to simplify your code with useful scope functions from the standard library.</p></li><li class="list__item" id="p6l019_871"><p id="p6l019_876"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-overview.html" id="p6l019_877" data-external="true" rel="noopener noreferrer" target="_blank">CocoaPods integration</a> &ndash; set up an environment to work with CocoaPods.</p></li></ul></section><section class="chapter"><h2 id="install-kotlin-1-8-20" data-toc="install-kotlin-1-8-20">Install Kotlin 1.8.20</h2><section class="chapter"><h3 id="check-the-ide-version" data-toc="check-the-ide-version">Check the IDE version</h3><p id="p6l019_880"><a href="https://www.jetbrains.com/idea/download/" id="p6l019_883" data-external="true" rel="noopener noreferrer" target="_blank">IntelliJ IDEA</a> 2022.2 and 2022.3 automatically suggest updating the Kotlin plugin to version 1.8.20. IntelliJ IDEA 2023.1 has the built-in Kotlin plugin 1.8.20.</p><p id="p6l019_881">Android Studio Flamingo (222) and Giraffe (223) will support Kotlin 1.8.20 in the next releases.</p><p id="p6l019_882">The new command-line compiler is available for download on the <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.8.20" id="p6l019_884" data-external="true" rel="noopener noreferrer" target="_blank">GitHub release page</a>.</p></section><section class="chapter"><h3 id="configure-gradle-settings" data-toc="configure-gradle-settings">Configure Gradle settings</h3><p id="p6l019_885">To download Kotlin artifacts and dependencies properly, update your <code class="code" id="p6l019_888">settings.gradle(.kts)</code> file to use the Maven Central repository:</p><div class="code-block" data-lang="kotlin">
pluginManagement {
    repositories {
        mavenCentral()
        gradlePluginPortal()
    }
}
</div><p id="p6l019_887">If the repository is not specified, Gradle uses the sunset JCenter repository that could lead to issues with Kotlin artifacts.</p></section></section><div class="last-modified">28 July 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="whatsnew19.html" class="navigation-links__prev">What's new in Kotlin 1.9.0</a><a href="whatsnew18.html" class="navigation-links__next">What's new in Kotlin 1.8.0</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>