<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-04T03:15:55.56885538"><link rel="canonical" href="https://kotlinlang.org/docs/js-react.html" data-react-helmet="true"><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
<title>Build a web application with React and Kotlin/JS &mdash; tutorial | Kotlin Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"before-you-start","level":0,"title":"Before you start","anchor":"#before-you-start"},{"id":"run-the-development-server","level":1,"title":"Run the development server","anchor":"#run-the-development-server"},{"id":"enable-hot-reload-continuous-mode","level":1,"title":"Enable hot reload / continuous mode","anchor":"#enable-hot-reload-continuous-mode"},{"id":"create-a-web-app-draft","level":0,"title":"Create a web app draft","anchor":"#create-a-web-app-draft"},{"id":"add-the-first-static-page-with-react","level":1,"title":"Add the first static page with React","anchor":"#add-the-first-static-page-with-react"},{"id":"convert-html-to-kotlin-s-typesafe-html-dsl","level":1,"title":"Convert HTML to Kotlin\u0027s typesafe HTML DSL","anchor":"#convert-html-to-kotlin-s-typesafe-html-dsl"},{"id":"add-videos-using-kotlin-constructs-in-markup","level":1,"title":"Add videos using Kotlin constructs in markup","anchor":"#add-videos-using-kotlin-constructs-in-markup"},{"id":"add-styles-with-typesafe-css","level":1,"title":"Add styles with typesafe CSS","anchor":"#add-styles-with-typesafe-css"},{"id":"design-app-components","level":0,"title":"Design app components","anchor":"#design-app-components"},{"id":"add-the-main-component","level":1,"title":"Add the main component","anchor":"#add-the-main-component"},{"id":"extract-a-list-component","level":1,"title":"Extract a list component","anchor":"#extract-a-list-component"},{"id":"add-props-to-pass-data-between-components","level":1,"title":"Add props to pass data between components","anchor":"#add-props-to-pass-data-between-components"},{"id":"make-the-list-interactive","level":1,"title":"Make the list interactive","anchor":"#make-the-list-interactive"},{"id":"add-state-to-keep-values","level":1,"title":"Add state to keep values","anchor":"#add-state-to-keep-values"},{"id":"compose-components","level":0,"title":"Compose components","anchor":"#compose-components"},{"id":"lift-state","level":1,"title":"Lift state","anchor":"#lift-state"},{"id":"pass-handlers","level":1,"title":"Pass handlers","anchor":"#pass-handlers"},{"id":"add-more-components","level":0,"title":"Add more components","anchor":"#add-more-components"},{"id":"extract-the-video-player-component","level":1,"title":"Extract the video player component","anchor":"#extract-the-video-player-component"},{"id":"add-a-button-and-wire-it","level":1,"title":"Add a button and wire it","anchor":"#add-a-button-and-wire-it"},{"id":"move-video-lists-to-the-application-state","level":1,"title":"Move video lists to the application state","anchor":"#move-video-lists-to-the-application-state"},{"id":"use-packages-from-npm","level":0,"title":"Use packages from npm","anchor":"#use-packages-from-npm"},{"id":"add-the-video-player-component","level":1,"title":"Add the video player component","anchor":"#add-the-video-player-component"},{"id":"add-social-share-buttons","level":1,"title":"Add social share buttons","anchor":"#add-social-share-buttons"},{"id":"use-an-external-rest-api","level":0,"title":"Use an external REST API","anchor":"#use-an-external-rest-api"},{"id":"use-js-functionality-from-kotlin","level":1,"title":"Use JS functionality from Kotlin","anchor":"#use-js-functionality-from-kotlin"},{"id":"add-serialization","level":1,"title":"Add serialization","anchor":"#add-serialization"},{"id":"fetch-videos","level":1,"title":"Fetch videos","anchor":"#fetch-videos"},{"id":"deploy-to-production-and-the-cloud","level":0,"title":"Deploy to production and the cloud","anchor":"#deploy-to-production-and-the-cloud"},{"id":"package-a-production-build","level":1,"title":"Package a production build","anchor":"#package-a-production-build"},{"id":"deploy-to-heroku","level":1,"title":"Deploy to Heroku","anchor":"#deploy-to-heroku"},{"id":"what-s-next","level":0,"title":"What\u0027s next","anchor":"#what-s-next"},{"id":"add-more-features","level":1,"title":"Add more features","anchor":"#add-more-features"},{"id":"improve-the-style-responsiveness-and-grids","level":1,"title":"Improve the style: responsiveness and grids","anchor":"#improve-the-style-responsiveness-and-grids"},{"id":"join-the-community-and-get-help","level":1,"title":"Join the community and get help","anchor":"#join-the-community-and-get-help"},{"id":"learn-more-about-coroutines","level":1,"title":"Learn more about coroutines","anchor":"#learn-more-about-coroutines"},{"id":"learn-more-about-react","level":1,"title":"Learn more about React","anchor":"#learn-more-about-react"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="https://kotlinlang.org/assets/images/favicon.svg?v2"><link rel="icon" type="image/x-icon" sizes="32x32" href="https://kotlinlang.org/assets/images/favicon.ico?v2"><link rel="icon" type="image/png" sizes="96x96" href="https://kotlinlang.org/assets/images/apple-touch-icon.png?v2"><link rel="icon" type="image/png" sizes="300x300" href="https://kotlinlang.org/assets/images/apple-touch-icon-72x72.png?v2"><link rel="icon" type="image/png" sizes="500x500" href="https://kotlinlang.org/assets/images/apple-touch-icon-114x114.png?v2"><meta name="image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- Open Graph --><meta property="og:title" content="Build a web application with React and Kotlin/JS &mdash; tutorial | Kotlin"><meta property="og:description" content=""><meta property="og:image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://kotlinlang.org/docs/js-react.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@kotlin"><meta name="twitter:title" content="Build a web application with React and Kotlin/JS &mdash; tutorial | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@kotlin"><meta name="twitter:image:src" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://kotlinlang.org/docs/js-react.html#webpage",
    "url": "https://kotlinlang.org/docs/js-react.html",
    "name": "Build a web application with React and Kotlin/JS &mdash; tutorial | Kotlin",
    "description": "",
    "image": "https://kotlinlang.org/assets/images/open-graph/docs.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://kotlinlang.org/docs/#website",
    "url": "https://kotlinlang.org/docs/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --><style>a[href="test-page.html"] { visibility: hidden; }</style></head><body data-id="js-react" data-main-title="Build a web application with React and Kotlin/JS — tutorial" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Platforms///JavaScript" data-edit-url="https://github.com/JetBrains/kotlin-web-site/edit/master/docs/topics/js/js-react.md"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="js-react" id="js-react.md">Build a web application with React and Kotlin/JS — tutorial</h1><p id="-h7gbkp_3">This tutorial will teach you how to build a browser application with Kotlin/JS and the <a href="https://reactjs.org/" id="-h7gbkp_17" data-external="true" rel="noopener noreferrer" target="_blank">React</a> framework. You will:</p><ul class="list _bullet" id="-h7gbkp_4"><li class="list__item" id="-h7gbkp_18"><p id="-h7gbkp_21">Complete common tasks associated with building a typical React application.</p></li><li class="list__item" id="-h7gbkp_19"><p id="-h7gbkp_22">Explore how <a href="type-safe-builders.html" id="-h7gbkp_23">Kotlin's DSLs</a> can be used to help express concepts concisely and uniformly without sacrificing readability, allowing you to write a full-fledged application completely in Kotlin.</p></li><li class="list__item" id="-h7gbkp_20"><p id="-h7gbkp_24">Learn how to use ready-made npm components, use external libraries, and publish the final application.</p></li></ul><p id="-h7gbkp_5">The output will be a <span class="emphasis" id="-h7gbkp_25">KotlinConf Explorer</span> web app dedicated to the <a href="https://kotlinconf.com/" id="-h7gbkp_26" data-external="true" rel="noopener noreferrer" target="_blank">KotlinConf</a> event, with links to conference talks. Users will be able to watch all the talks on one page and mark them as seen or unseen.</p><p id="-h7gbkp_6">The tutorial assumes you have prior knowledge of Kotlin and basic knowledge of HTML and CSS. Understanding the basic concepts behind React may help you understand some sample code, but it is not strictly required.</p><aside class="prompt" data-type="note" data-title="" id="-h7gbkp_7"><p id="-h7gbkp_27">You can get the final application <a href="https://github.com/kotlin-hands-on/web-app-react-kotlin-js-gradle/tree/finished" id="-h7gbkp_28" data-external="true" rel="noopener noreferrer" target="_blank">here</a>.</p></aside><section class="chapter"><h2 id="before-you-start" data-toc="before-you-start">Before you start</h2><ol class="list _decimal" id="-h7gbkp_29" type="1"><li class="list__item" id="-h7gbkp_33"><p id="-h7gbkp_35">Download and install the latest version of <a href="https://www.jetbrains.com/idea/download/index.html" id="-h7gbkp_36" data-external="true" rel="noopener noreferrer" target="_blank">IntelliJ IDEA</a>.</p></li><li class="list__item" id="-h7gbkp_34"><p id="-h7gbkp_37">Clone the <a href="https://github.com/kotlin-hands-on/web-app-react-kotlin-js-gradle" id="-h7gbkp_44" data-external="true" rel="noopener noreferrer" target="_blank">project template</a> and open it in IntelliJ IDEA. The template includes a basic Kotlin Multiplatform Gradle project with all required configurations and dependencies</p><ul class="list _bullet" id="-h7gbkp_38"><li class="list__item" id="-h7gbkp_45"><p id="-h7gbkp_46">Dependencies and tasks in the <code class="code" id="-h7gbkp_47">build.gradle.kts</code> file:</p></li></ul><div class="code-block" data-lang="kotlin">
dependencies {
    // React, React DOM + Wrappers
    implementation(enforcedPlatform(&quot;org.jetbrains.kotlin-wrappers:kotlin-wrappers-bom:1.0.0-pre.430&quot;))
    implementation(&quot;org.jetbrains.kotlin-wrappers:kotlin-react&quot;)
    implementation(&quot;org.jetbrains.kotlin-wrappers:kotlin-react-dom&quot;)

    // Kotlin React Emotion (CSS)
    implementation(&quot;org.jetbrains.kotlin-wrappers:kotlin-emotion&quot;)

    // Video Player
    implementation(npm(&quot;react-player&quot;, &quot;2.12.0&quot;))

    // Share Buttons
    implementation(npm(&quot;react-share&quot;, &quot;4.4.1&quot;))

    // Coroutines &amp; serialization
    implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.6.4&quot;)
    implementation(&quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.0&quot;)
}
</div><ul class="list _bullet" id="-h7gbkp_40"><li class="list__item" id="-h7gbkp_48"><p id="-h7gbkp_49">An HTML template page in <code class="code" id="-h7gbkp_50">src/jsMain/resources/index.html</code> for inserting JavaScript code that you'll be using in this tutorial:</p></li></ul><div class="code-block" data-lang="markup">
&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Hello, Kotlin/JS!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;confexplorer.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</div><p id="-h7gbkp_42"></p><p id="-h7gbkp_43">Kotlin/JS projects are automatically bundled with all of your code and its dependencies into a single JavaScript file with the same name as the project, <code class="code" id="-h7gbkp_51">confexplorer.js</code>, when you build them. As a typical <a href="https://faqs.skillcrush.com/article/176-where-should-js-script-tags-be-linked-in-html-documents" id="-h7gbkp_52" data-external="true" rel="noopener noreferrer" target="_blank">JavaScript convention</a>, the content of the body (including the <code class="code" id="-h7gbkp_53">root</code> div) is loaded first to ensure that the browser loads all page elements before the scripts.</p></li></ol><ul class="list _bullet" id="-h7gbkp_30"><li class="list__item" id="-h7gbkp_54"><p id="-h7gbkp_55">A code snippet in <code class="code" id="-h7gbkp_57">src/jsMain/kotlin/Main.kt</code>:</p><div class="code-block" data-lang="kotlin">
import kotlinx.browser.document

fun main() {
    document.bgColor = &quot;red&quot;
}
</div></li></ul><section class="chapter"><h3 id="run-the-development-server" data-toc="run-the-development-server">Run the development server</h3><p id="-h7gbkp_58">By default, the Kotlin Multiplatform Gradle plugin comes with support for an embedded <code class="code" id="-h7gbkp_64">webpack-dev-server</code>, allowing you to run the application from the IDE without manually setting up any servers.</p><p id="-h7gbkp_59">To test that the program successfully runs in the browser, start the development server by invoking the <code class="code" id="-h7gbkp_65">run</code> or <code class="code" id="-h7gbkp_66">browserDevelopmentRun</code> task (available in the <code class="code" id="-h7gbkp_67">other</code> or <code class="code" id="-h7gbkp_68">kotlin browser</code> directory) from the Gradle tool window inside IntelliJ IDEA:</p><figure id="-h7gbkp_60"><img alt="Gradle tasks list" src="images/browser-development-run.png" title="Gradle tasks list" width="700" height="214"></figure><p id="-h7gbkp_61">To run the program from the Terminal, use <code class="code" id="-h7gbkp_69">./gradlew run</code> instead.</p><p id="-h7gbkp_62">When the project is compiled and bundled, a blank red page will appear in a browser window:</p><figure id="-h7gbkp_63"><img alt="Blank red page" src="images/red-page.png" title="Blank red page" width="700" height="308"></figure></section><section class="chapter"><h3 id="enable-hot-reload-continuous-mode" data-toc="enable-hot-reload-continuous-mode">Enable hot reload / continuous mode</h3><p id="-h7gbkp_70">Configure <span class="emphasis" id="-h7gbkp_74"><a href="dev-server-continuous-compilation.html" id="-h7gbkp_75">continuous compilation</a></span> mode so you don't have to manually compile and execute your project every time you make changes. Make sure to stop all running development server instances before proceeding.</p><ol class="list _decimal" id="-h7gbkp_71" type="1"><li class="list__item" id="-h7gbkp_76"><p id="-h7gbkp_79">Edit the run configuration that IntelliJ IDEA automatically generates after running the Gradle <code class="code" id="-h7gbkp_81">run</code> task for the first time:</p><figure id="-h7gbkp_80"><img alt="Edit a run configuration" src="images/edit-configurations-continuous.png" title="Edit a run configuration" width="700" height="212"></figure></li><li class="list__item" id="-h7gbkp_77"><p id="-h7gbkp_82">In the <span class="control" id="-h7gbkp_85">Run/Debug Configurations</span> dialog, add the <code class="code" id="-h7gbkp_86">--continuous</code> option to the arguments for the run configuration:</p><figure id="-h7gbkp_83"><img alt="Enable continuous mode" src="images/continuous-mode.png" title="Enable continuous mode" width="700" height="450"></figure><p id="-h7gbkp_84">After applying the changes, you can use the <span class="control" id="-h7gbkp_87">Run</span> button inside IntelliJ IDEA to start the development server back up. To run the continuous Gradle builds from the Terminal, use <code class="code" id="-h7gbkp_88">./gradlew run --continuous</code> instead.</p></li><li class="list__item" id="-h7gbkp_78"><p id="-h7gbkp_89">To test this feature, change the color of the page to blue in the <code class="code" id="-h7gbkp_92">Main.kt</code> file while the Gradle task is running:</p><div class="code-block" data-lang="kotlin">
document.bgColor = &quot;blue&quot;
</div><p id="-h7gbkp_91">The project then recompiles, and after a reload the browser page will be the new color.</p></li></ol><p id="-h7gbkp_72">You can keep the development server running in continuous mode during the development process. It will automatically rebuild and reload the page when you make changes.</p><aside class="prompt" data-type="note" data-title="" id="-h7gbkp_73"><p id="-h7gbkp_93">You can find this state of the project on the <code class="code" id="-h7gbkp_94">master</code> branch <a href="https://github.com/kotlin-hands-on/web-app-react-kotlin-js-gradle/tree/master" id="-h7gbkp_95" data-external="true" rel="noopener noreferrer" target="_blank">here</a>.</p></aside></section></section><section class="chapter"><h2 id="create-a-web-app-draft" data-toc="create-a-web-app-draft">Create a web app draft</h2><section class="chapter"><h3 id="add-the-first-static-page-with-react" data-toc="add-the-first-static-page-with-react">Add the first static page with React</h3><p id="-h7gbkp_100">To make your app display a simple message, replace the code in the <code class="code" id="-h7gbkp_105">Main.kt</code> file with the following:</p><div class="code-block" data-lang="kotlin">
import kotlinx.browser.document
import react.*
import emotion.react.css
import csstype.Position
import csstype.px
import react.dom.html.ReactHTML.h1
import react.dom.html.ReactHTML.h3
import react.dom.html.ReactHTML.div
import react.dom.html.ReactHTML.p
import react.dom.html.ReactHTML.img
import react.dom.client.createRoot
import kotlinx.serialization.Serializable

fun main() {
    val container = document.getElementById(&quot;root&quot;) ?: error(&quot;Couldn't find root container!&quot;)
    createRoot(container).render(Fragment.create {
        h1 {
            +&quot;Hello, React+Kotlin/JS!&quot;
        }
    })
}
</div><ul class="list _bullet" id="-h7gbkp_102"><li class="list__item" id="-h7gbkp_106"><p id="-h7gbkp_109">The <code class="code" id="-h7gbkp_110">render()</code> function instructs <a href="https://github.com/JetBrains/kotlin-wrappers/tree/master/kotlin-react-dom" id="-h7gbkp_111" data-external="true" rel="noopener noreferrer" target="_blank">kotlin-react-dom</a> to render the first HTML element inside a <a href="https://reactjs.org/docs/fragments.html" id="-h7gbkp_112" data-external="true" rel="noopener noreferrer" target="_blank">fragment</a> to the <code class="code" id="-h7gbkp_113">root</code> element. This element is a container defined in <code class="code" id="-h7gbkp_114">src/jsMain/resources/index.html</code>, which was included in the template.</p></li><li class="list__item" id="-h7gbkp_107"><p id="-h7gbkp_115">The content is an <code class="code" id="-h7gbkp_116">&lt;h1&gt;</code> header and uses a typesafe DSL to render HTML.</p></li><li class="list__item" id="-h7gbkp_108"><p id="-h7gbkp_117"><code class="code" id="-h7gbkp_118">h1</code> is a function that takes a lambda parameter. When you add the <code class="code" id="-h7gbkp_119">+</code> sign in front of a string literal, the <code class="code" id="-h7gbkp_120">unaryPlus()</code> function is actually invoked using <a href="operator-overloading.html" id="-h7gbkp_121">operator overloading</a>. It appends the string to the enclosed HTML element.</p></li></ul><p id="-h7gbkp_103">When the project recompiles, the browser displays this HTML page:</p><figure id="-h7gbkp_104"><img alt="An HTML page example" src="images/hello-react-js.png" title="An HTML page example" width="700" height="111"></figure></section><section class="chapter"><h3 id="convert-html-to-kotlin-s-typesafe-html-dsl" data-toc="convert-html-to-kotlin-s-typesafe-html-dsl">Convert HTML to Kotlin's typesafe HTML DSL</h3><p id="-h7gbkp_122">The Kotlin <a href="https://github.com/JetBrains/kotlin-wrappers/blob/master/kotlin-react/README.md" id="-h7gbkp_128" data-external="true" rel="noopener noreferrer" target="_blank">wrappers</a> for React come with a <a href="type-safe-builders.html" id="-h7gbkp_129">domain-specific language (DSL)</a> that makes it possible to write HTML in pure Kotlin code. In this way, it's similar to <a href="https://reactjs.org/docs/introducing-jsx.html" id="-h7gbkp_130" data-external="true" rel="noopener noreferrer" target="_blank">JSX</a> from JavaScript. However, with this markup being Kotlin, you get all the benefits of a statically typed language, such as autocomplete or type checking.</p><p id="-h7gbkp_123">Compare the classic HTML code for your future web app and its typesafe variant in Kotlin:</p><div class="tabs" id="-h7gbkp_124" data-anchors="[-h7gbkp_131,-h7gbkp_132]"><div class="tabs__content" data-gtm="tab" id="-h7gbkp_131" data-title="HTML"><div class="code-block" data-lang="markup" data-title="HTML">
&lt;h1&gt;KotlinConf Explorer&lt;/h1&gt;
&lt;div&gt;
    &lt;h3&gt;Videos to watch&lt;/h3&gt;
    &lt;p&gt;John Doe: Building and breaking things&lt;/p&gt;
    &lt;p&gt;Jane Smith: The development process&lt;/p&gt;
    &lt;p&gt;Matt Miller: The Web 7.0&lt;/p&gt;
    &lt;h3&gt;Videos watched&lt;/h3&gt;
    &lt;p&gt;Tom Jerry: Mouseless development&lt;/p&gt;
&lt;/div&gt;
&lt;div&gt;
    &lt;h3&gt;John Doe: Building and breaking things&lt;/h3&gt;
    &lt;img src=&quot;https://via.placeholder.com/640x360.png?text=Video+Player+Placeholder&quot;&gt;
&lt;/div&gt;
</div></div><div class="tabs__content" data-gtm="tab" id="-h7gbkp_132" data-title="Kotlin"><div class="code-block" data-lang="kotlin" data-title="Kotlin">
h1 {
    +&quot;KotlinConf Explorer&quot;
}
div {
    h3 {
        +&quot;Videos to watch&quot;
    }
    p {
        + &quot;John Doe: Building and breaking things&quot;
    }
    p {
        +&quot;Jane Smith: The development process&quot;
    }
    p {
        +&quot;Matt Miller: The Web 7.0&quot;
    }
    h3 {
        +&quot;Videos watched&quot;
    }
    p {
        +&quot;Tom Jerry: Mouseless development&quot;
    }
}
div {
    h3 {
        +&quot;John Doe: Building and breaking things&quot;
    }
    img {
       src = &quot;https://via.placeholder.com/640x360.png?text=Video+Player+Placeholder&quot;
    }
}
</div></div></div><p id="-h7gbkp_125">Copy the Kotlin code and update the <code class="code" id="-h7gbkp_135">Fragment.create()</code> function call inside the <code class="code" id="-h7gbkp_136">main()</code> function, replacing the previous <code class="code" id="-h7gbkp_137">h1</code> tag.</p><p id="-h7gbkp_126">Wait for the browser to reload. The page should now look like this:</p><figure id="-h7gbkp_127"><img alt="The web app draft" src="images/website-draft.png" title="The web app draft" width="700" height="759"></figure></section><section class="chapter"><h3 id="add-videos-using-kotlin-constructs-in-markup" data-toc="add-videos-using-kotlin-constructs-in-markup">Add videos using Kotlin constructs in markup</h3><p id="-h7gbkp_138">There are some advantages to writing HTML in Kotlin using this DSL. You can manipulate your app using regular Kotlin constructs, like loops, conditions, collections, and string interpolation.</p><p id="-h7gbkp_139">You can now replace the hardcoded list of videos with a list of Kotlin objects:</p><ol class="list _decimal" id="-h7gbkp_140" type="1"><li class="list__item" id="-h7gbkp_142"><p id="-h7gbkp_146">In <code class="code" id="-h7gbkp_148">Main.kt</code>, create a <code class="code" id="-h7gbkp_149">Video</code> <a href="data-classes.html" id="-h7gbkp_150">data class</a> to keep all video attributes in one place:</p><div class="code-block" data-lang="kotlin">
data class Video(
    val id: Int,
    val title: String,
    val speaker: String,
    val videoUrl: String
)
</div></li><li class="list__item" id="-h7gbkp_143"><p id="-h7gbkp_151">Fill up the two lists, for unwatched videos and watched videos, respectively. Add these declarations at file-level in <code class="code" id="-h7gbkp_153">Main.kt</code>:</p><div class="code-block" data-lang="kotlin">
val unwatchedVideos = listOf(
    Video(1, &quot;Opening Keynote&quot;, &quot;Andrey Breslav&quot;, &quot;https://youtu.be/PsaFVLr8t4E&quot;),
    Video(2, &quot;Dissecting the stdlib&quot;, &quot;Huyen Tue Dao&quot;, &quot;https://youtu.be/Fzt_9I733Yg&quot;),
    Video(3, &quot;Kotlin and Spring Boot&quot;, &quot;Nicolas Frankel&quot;, &quot;https://youtu.be/pSiZVAeReeg&quot;)
)

val watchedVideos = listOf(
    Video(4, &quot;Creating Internal DSLs in Kotlin&quot;, &quot;Venkat Subramaniam&quot;, &quot;https://youtu.be/JzTeAM8N1-o&quot;)
)
</div></li><li class="list__item" id="-h7gbkp_144"><p id="-h7gbkp_154">To use these videos on the page, write a Kotlin <code class="code" id="-h7gbkp_156">for</code> loop to iterate over the collection of unwatched <code class="code" id="-h7gbkp_157">Video</code> objects. Replace the three <code class="code" id="-h7gbkp_158">p</code> tags under &quot;Videos to watch&quot; with the following snippet:</p><div class="code-block" data-lang="kotlin">
for (video in unwatchedVideos) {
    p {
        +&quot;${video.speaker}: ${video.title}&quot;
    }
}
</div></li><li class="list__item" id="-h7gbkp_145"><p id="-h7gbkp_159">Apply the same process to modify the code for the single tag following &quot;Videos watched&quot; as well:</p><div class="code-block" data-lang="kotlin">
for (video in watchedVideos) {
    p {
        +&quot;${video.speaker}: ${video.title}&quot;
    }
}
</div></li></ol><p id="-h7gbkp_141">Wait for the browser to reload. The layout should stay the same as before. You can add some more videos to the list to make sure that the loop is working.</p></section><section class="chapter"><h3 id="add-styles-with-typesafe-css" data-toc="add-styles-with-typesafe-css">Add styles with typesafe CSS</h3><p id="-h7gbkp_161">The <a href="https://github.com/JetBrains/kotlin-wrappers/blob/master/kotlin-emotion/" id="-h7gbkp_168" data-external="true" rel="noopener noreferrer" target="_blank">kotlin-emotion</a> wrapper for the <a href="https://emotion.sh/docs/introduction" id="-h7gbkp_169" data-external="true" rel="noopener noreferrer" target="_blank">Emotion</a> library makes it possible to specify CSS attributes &ndash; even dynamic ones &ndash; right alongside HTML with JavaScript. Conceptually, that makes it similar to <a href="https://reactjs.org/docs/faq-styling.html#what-is-css-in-js" id="-h7gbkp_170" data-external="true" rel="noopener noreferrer" target="_blank">CSS-in-JS</a> &ndash; but for Kotlin. The benefit of using a DSL is that you can use Kotlin code constructs to express formatting rules.</p><p id="-h7gbkp_162">The template project for this tutorial already includes the dependency needed to use <code class="code" id="-h7gbkp_171">kotlin-emotion</code>:</p><div class="code-block" data-lang="kotlin">
dependencies {
    // ...
    // Kotlin React Emotion (CSS) (chapter 3)
    implementation(&quot;org.jetbrains.kotlin-wrappers:kotlin-emotion&quot;)
    // ...
}
</div><p id="-h7gbkp_164">With <code class="code" id="-h7gbkp_172">kotlin-emotion</code>, you can specify a <code class="code" id="-h7gbkp_173">css</code> block inside HTML elements <code class="code" id="-h7gbkp_174">div</code> and <code class="code" id="-h7gbkp_175">h3</code>, where you can define the styles.</p><p id="-h7gbkp_165">To move the video player to the top right-hand corner of the page, use CSS and adjust the code for the video player (the last <code class="code" id="-h7gbkp_176">div</code> in the snippet):</p><div class="code-block" data-lang="kotlin">
div {
    css {
        position = Position.absolute
        top = 10.px
        right = 10.px
    }
    h3 {
        +&quot;John Doe: Building and breaking things&quot;
    }
    img {
        src = &quot;https://via.placeholder.com/640x360.png?text=Video+Player+Placeholder&quot;
    }
}
</div><p id="-h7gbkp_167">Feel free to experiment with some other styles. For example, you could change the <code class="code" id="-h7gbkp_177">fontFamily</code> or add some <code class="code" id="-h7gbkp_178">color</code> to your UI.</p></section></section><section class="chapter"><h2 id="design-app-components" data-toc="design-app-components">Design app components</h2><p id="-h7gbkp_179">The basic building blocks in React are called <span class="emphasis" id="-h7gbkp_190"><a href="https://reactjs.org/docs/components-and-props.html" id="-h7gbkp_191" data-external="true" rel="noopener noreferrer" target="_blank">components</a></span>. Components themselves can also be composed of other, smaller components. By combining components, you build your application. If you structure components to be generic and reusable, you'll be able to use them in multiple parts of the app without duplicating code or logic.</p><p id="-h7gbkp_180">The content of the <code class="code" id="-h7gbkp_192">render()</code> function generally describes a basic component. The current layout of your application looks like this:</p><figure id="-h7gbkp_181"><img alt="Current layout" src="images/current-layout.png" title="Current layout" width="700" height="296"></figure><p id="-h7gbkp_182">If you decompose your application into individual components, you'll end up with a more structured layout in which each component handles its responsibilities:</p><figure id="-h7gbkp_183"><img alt="Structured layout with components" src="images/structured-layout.png" title="Structured layout with components" width="700" height="296"></figure><p id="-h7gbkp_184">Components encapsulate a particular functionality. Using components shortens source code and makes it easier to read and understand.</p><section class="chapter"><h3 id="add-the-main-component" data-toc="add-the-main-component">Add the main component</h3><p id="-h7gbkp_193">To start creating the application's structure, first explicitly specify <code class="code" id="-h7gbkp_196">App</code>, the main component for rendering to the <code class="code" id="-h7gbkp_197">root</code>element:</p><ol class="list _decimal" id="-h7gbkp_194" type="1"><li class="list__item" id="-h7gbkp_198"><p id="-h7gbkp_201">Create a new <code class="code" id="-h7gbkp_202">App.kt</code> file in the <code class="code" id="-h7gbkp_203">src/jsMain/kotlin</code> folder.</p></li><li class="list__item" id="-h7gbkp_199"><p id="-h7gbkp_204">Inside this file, add the following snippet and move the typesafe HTML from <code class="code" id="-h7gbkp_207">Main.kt</code> into it:</p><div class="code-block" data-lang="kotlin">
import kotlinx.coroutines.async
import react.*
import react.dom.*
import kotlinx.browser.window
import kotlinx.coroutines.*
import kotlinx.serialization.decodeFromString
import kotlinx.serialization.json.Json
import emotion.react.css
import csstype.Position
import csstype.px
import react.dom.html.ReactHTML.h1
import react.dom.html.ReactHTML.h3
import react.dom.html.ReactHTML.div
import react.dom.html.ReactHTML.p
import react.dom.html.ReactHTML.img

val App = FC&lt;Props&gt; {
    // typesafe HTML goes here, starting with the first h1 tag!
}
</div><p id="-h7gbkp_206">The <code class="code" id="-h7gbkp_208">FC</code> function creates a <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components" id="-h7gbkp_209" data-external="true" rel="noopener noreferrer" target="_blank">function component</a>.</p></li><li class="list__item" id="-h7gbkp_200"><p id="-h7gbkp_210">In the <code class="code" id="-h7gbkp_213">Main.kt</code> file, update the <code class="code" id="-h7gbkp_214">main()</code> function as follows:</p><div class="code-block" data-lang="kotlin">
fun main() {
    val container = document.getElementById(&quot;root&quot;) ?: error(&quot;Couldn't find root container!&quot;)
    createRoot(container).render(App.create())
}
</div><p id="-h7gbkp_212">Now the program creates an instance of the <code class="code" id="-h7gbkp_215">App</code> component and renders it to the specified container.</p></li></ol><p id="-h7gbkp_195">For more information about React concepts, see the <a href="https://reactjs.org/docs/hello-world.html#how-to-read-this-guide" id="-h7gbkp_216" data-external="true" rel="noopener noreferrer" target="_blank">documentation and guides</a>.</p></section><section class="chapter"><h3 id="extract-a-list-component" data-toc="extract-a-list-component">Extract a list component</h3><p id="-h7gbkp_217">Since the <code class="code" id="-h7gbkp_220">watchedVideos</code> and <code class="code" id="-h7gbkp_221">unwatchedVideos</code> lists each contain a list of videos, it makes sense to create a single reusable component, and only adjust the content displayed in the lists.</p><p id="-h7gbkp_218">The <code class="code" id="-h7gbkp_222">VideoList</code> component follows the same pattern as the <code class="code" id="-h7gbkp_223">App</code> component. It uses the <code class="code" id="-h7gbkp_224">FC</code> builder function, and contains the code from the <code class="code" id="-h7gbkp_225">unwatchedVideos</code> list.</p><ol class="list _decimal" id="-h7gbkp_219" type="1"><li class="list__item" id="-h7gbkp_226"><p id="-h7gbkp_228">Create a new <code class="code" id="-h7gbkp_230">VideoList.kt</code> file in the <code class="code" id="-h7gbkp_231">src/jsMain/kotlin</code> folder and add the following code:</p><div class="code-block" data-lang="kotlin">
import kotlinx.browser.window
import react.*
import react.dom.*
import react.dom.html.ReactHTML.p

val VideoList = FC&lt;Props&gt; {
    for (video in unwatchedVideos) {
        p {
            +&quot;${video.speaker}: ${video.title}&quot;
        }
    }
}
</div></li><li class="list__item" id="-h7gbkp_227"><p id="-h7gbkp_232">In <code class="code" id="-h7gbkp_235">App.kt</code>, use the <code class="code" id="-h7gbkp_236">VideoList</code> component by invoking it without parameters:</p><div class="code-block" data-lang="kotlin">
// . . .

div {
    h3 {
        +&quot;Videos to watch&quot;
    }
    VideoList()

    h3 {
        +&quot;Videos watched&quot;
    }
    VideoList()
}

// . . .
</div><p id="-h7gbkp_234">For now, the <code class="code" id="-h7gbkp_237">App</code> component has no control over the content that is shown by the <code class="code" id="-h7gbkp_238">VideoList</code> component. It's hard-coded, so you see the same list twice.</p></li></ol></section><section class="chapter"><h3 id="add-props-to-pass-data-between-components" data-toc="add-props-to-pass-data-between-components">Add props to pass data between components</h3><p id="-h7gbkp_239">Since you're going to reuse the <code class="code" id="-h7gbkp_243">VideoList</code> component, you'll need to be able to fill it with different content. You can add the ability to pass the list of items as an attribute to the component. In React, these attributes are called <span class="emphasis" id="-h7gbkp_244">props</span>. When the props of a component are changed in React, the framework automatically re-renders the component.</p><p id="-h7gbkp_240">For <code class="code" id="-h7gbkp_245">VideoList</code>, you'll need a prop containing the list of videos to be shown. Define an interface that holds all the props which can be passed to a <code class="code" id="-h7gbkp_246">VideoList</code> component:</p><ol class="list _decimal" id="-h7gbkp_241" type="1"><li class="list__item" id="-h7gbkp_247"><p id="-h7gbkp_250">Add the following definition to the <code class="code" id="-h7gbkp_253">VideoList.kt</code> file:</p><div class="code-block" data-lang="kotlin">
external interface VideoListProps : Props {
    var videos: List&lt;Video&gt;
}
</div><p id="-h7gbkp_252">The <a href="js-interop.html#external-modifier" id="-h7gbkp_254">external</a> modifier tells the compiler that the interface's implementation is provided externally, so it doesn't try to generate JavaScript code from the declaration.</p></li><li class="list__item" id="-h7gbkp_248"><p id="-h7gbkp_255">Adjust the class definition of <code class="code" id="-h7gbkp_258">VideoList</code> to make use of the props that are passed into the <code class="code" id="-h7gbkp_259">FC</code> block as a parameter:</p><div class="code-block" data-lang="kotlin">
val VideoList = FC&lt;VideoListProps&gt; { props -&gt;
    for (video in props.videos) {
        p {
            key = video.id.toString()
            +&quot;${video.speaker}: ${video.title}&quot;
        }
    }
}
</div><p id="-h7gbkp_257">The <code class="code" id="-h7gbkp_260">key</code> attribute helps the React renderer figure out what to do when the value of <code class="code" id="-h7gbkp_261">props.videos</code> changes. It uses the key to determine which parts of a list need to be refreshed and which ones stay the same. You can find more information about lists and keys in the <a href="https://reactjs.org/docs/lists-and-keys.html" id="-h7gbkp_262" data-external="true" rel="noopener noreferrer" target="_blank">React guide</a>.</p></li><li class="list__item" id="-h7gbkp_249"><p id="-h7gbkp_263">In the <code class="code" id="-h7gbkp_265">App</code> component, make sure that the child components are instantiated with the proper attributes. In <code class="code" id="-h7gbkp_266">App.kt</code>, replace the two loops underneath the <code class="code" id="-h7gbkp_267">h3</code> elements with an invocation of <code class="code" id="-h7gbkp_268">VideoList</code> together with the attributes for <code class="code" id="-h7gbkp_269">unwatchedVideos</code> and <code class="code" id="-h7gbkp_270">watchedVideos</code>. In the Kotlin DSL, you assign them inside a block belonging to the <code class="code" id="-h7gbkp_271">VideoList</code> component:</p><div class="code-block" data-lang="kotlin">
h3 {
    +&quot;Videos to watch&quot;
}
VideoList {
    videos = unwatchedVideos
}
h3 {
    +&quot;Videos watched&quot;
}
VideoList {
    videos = watchedVideos
}
</div></li></ol><p id="-h7gbkp_242">After a reload, the browser will show that the lists now render correctly.</p></section><section class="chapter"><h3 id="make-the-list-interactive" data-toc="make-the-list-interactive">Make the list interactive</h3><p id="-h7gbkp_272">First, add an alert message that pops up when users click on a list entry. In <code class="code" id="-h7gbkp_277">VideoList.kt</code>, add an <code class="code" id="-h7gbkp_278">onClick</code> handler function that triggers an alert with the current video:</p><div class="code-block" data-lang="kotlin">
// . . .

p {
    key = video.id.toString()
    onClick = {
        window.alert(&quot;Clicked $video!&quot;)
    }
    +&quot;${video.speaker}: ${video.title}&quot;
}

// . . .
</div><p id="-h7gbkp_274">If you click on one of the list items in the browser window, you'll get information about the video in an alert window like this:</p><figure id="-h7gbkp_275"><img alt="Browser alert window" src="images/alert-window.png" title="Browser alert window" width="700" height="268"></figure><aside class="prompt" data-type="tip" data-title="" id="-h7gbkp_276"><p id="-h7gbkp_279">Defining an <code class="code" id="-h7gbkp_280">onClick</code> function directly as lambda is concise and very useful for prototyping. However, due to the way equality <a href="https://youtrack.jetbrains.com/issue/KT-15101" id="-h7gbkp_281" data-external="true" rel="noopener noreferrer" target="_blank">currently works</a> in Kotlin/JS, performance-wise it's not the most optimized way to pass click handlers. If you want to optimize rendering performance, consider storing your functions in a variable and passing them.</p></aside></section><section class="chapter"><h3 id="add-state-to-keep-values" data-toc="add-state-to-keep-values">Add state to keep values</h3><p id="-h7gbkp_282">Instead of just alerting the user, you can add some functionality for highlighting the selected video with a ▶ triangle. To do that, introduce some <span class="emphasis" id="-h7gbkp_287">state</span> specific to this component.</p><p id="-h7gbkp_283">State is one of the core concepts in React. In modern React (which uses the so-called <span class="emphasis" id="-h7gbkp_288">Hooks API</span>), state is expressed using the <a href="https://reactjs.org/docs/hooks-state.html" id="-h7gbkp_289" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-h7gbkp_290">useState</code> hook</a>.</p><ol class="list _decimal" id="-h7gbkp_284" type="1"><li class="list__item" id="-h7gbkp_291"><p id="-h7gbkp_293">Add the following code to the top of the <code class="code" id="-h7gbkp_298">VideoList</code> declaration:</p><div class="code-block" data-lang="kotlin">
val VideoList = FC&lt;VideoListProps&gt; { props -&gt;
    var selectedVideo: Video? by useState(null)

// . . .
</div><p id="-h7gbkp_295"></p><ul class="list _bullet" id="-h7gbkp_296"><li class="list__item" id="-h7gbkp_299"><p id="-h7gbkp_302">The <code class="code" id="-h7gbkp_303">VideoList</code> functional component keeps state (a value that is independent of the current function invocation). State is nullable, and has the <code class="code" id="-h7gbkp_304">Video?</code> type. Its default value is <code class="code" id="-h7gbkp_305">null</code>.</p></li><li class="list__item" id="-h7gbkp_300"><p id="-h7gbkp_306">The <code class="code" id="-h7gbkp_307">useState()</code> function from React instructs the framework to keep track of state across multiple invocations of the function. For example, even though you specify a default value, React makes sure that the default value is only assigned in the beginning. When state changes, the component will re-render based on the new state.</p></li><li class="list__item" id="-h7gbkp_301"><p id="-h7gbkp_308">The <code class="code" id="-h7gbkp_309">by</code> keyword indicates that <code class="code" id="-h7gbkp_310">useState()</code> acts as a <a href="delegated-properties.html" id="-h7gbkp_311">delegated property</a>. Like with any other variable, you read and write values. The implementation behind <code class="code" id="-h7gbkp_312">useState()</code> takes care of the machinery required to make state work.</p></li></ul><p id="-h7gbkp_297">To learn more about the State Hook, check out the <a href="https://reactjs.org/docs/hooks-state.html" id="-h7gbkp_313" data-external="true" rel="noopener noreferrer" target="_blank">React documentation</a>.</p></li><li class="list__item" id="-h7gbkp_292"><p id="-h7gbkp_314">Change the <code class="code" id="-h7gbkp_317">onClick</code> handler and the text in the <code class="code" id="-h7gbkp_318">VideoList</code> component to look as follows:</p><div class="code-block" data-lang="kotlin">
val VideoList = FC&lt;VideoListProps&gt; { props -&gt;
    var selectedVideo: Video? by useState(null)
    for (video in props.videos) {
        p {
            key = video.id.toString()
            onClick = {
                selectedVideo = video
            }
            if (video == selectedVideo) {
                +&quot;▶ &quot;
            }
            +&quot;${video.speaker}: ${video.title}&quot;
        }
    }
}
</div><ul class="list _bullet" id="-h7gbkp_316"><li class="list__item" id="-h7gbkp_319"><p id="-h7gbkp_321">When the user clicks a video, its value is assigned to the <code class="code" id="-h7gbkp_322">selectedVideo</code> variable.</p></li><li class="list__item" id="-h7gbkp_320"><p id="-h7gbkp_323">When the selected list entry is rendered, the triangle is prepended.</p></li></ul></li></ol><p id="-h7gbkp_285">You can find more details about state management in the <a href="https://reactjs.org/docs/faq-state.html" id="-h7gbkp_324" data-external="true" rel="noopener noreferrer" target="_blank">React FAQ</a>.</p><p id="-h7gbkp_286">Check the browser and click an item in the list to make sure that everything is working correctly.</p></section></section><section class="chapter"><h2 id="compose-components" data-toc="compose-components">Compose components</h2><p id="-h7gbkp_325">Currently, the two video lists work on their own, meaning that each list keeps track of a selected video. Users can select two videos, one in the unwatched list and one in watched, even though there's only one player:</p><figure id="-h7gbkp_326"><img alt="Two videos are selected in both lists simultaneously" src="images/two-videos-select.png" title="Two videos are selected in both lists simultaneously" width="700" height="295"></figure><p id="-h7gbkp_327">A list can't keep track of which video is selected both inside itself, and inside a sibling list. The reason is that the selected video is part not of the <span class="emphasis" id="-h7gbkp_330">list</span> state, but of the <span class="emphasis" id="-h7gbkp_331">application</span> state. This means you need to <span class="emphasis" id="-h7gbkp_332">lift</span> state out of the individual components.</p><section class="chapter"><h3 id="lift-state" data-toc="lift-state">Lift state</h3><p id="-h7gbkp_333">React makes sure that props can only be passed from a parent component to its children. This prevents components from being hard-wired together.</p><p id="-h7gbkp_334">If a component wants to change state of a sibling component, it needs to do so via its parent. At that point, state also no longer belongs to any of the child components but to the overarching parent component.</p><p id="-h7gbkp_335">The process of migrating state from components to their parents is called <span class="emphasis" id="-h7gbkp_337">lifting state</span>. For your app, add <code class="code" id="-h7gbkp_338">currentVideo</code> as state to the <code class="code" id="-h7gbkp_339">App</code> component:</p><ol class="list _decimal" id="-h7gbkp_336" type="1"><li class="list__item" id="-h7gbkp_340"><p id="-h7gbkp_344">In <code class="code" id="-h7gbkp_347">App.kt</code>, add the following to the top of the definition of the <code class="code" id="-h7gbkp_348">App</code> component:</p><div class="code-block" data-lang="kotlin">
val App = FC&lt;Props&gt; {
    var currentVideo: Video? by useState(null)

    // . . .
}
</div><p id="-h7gbkp_346">The <code class="code" id="-h7gbkp_349">VideoList</code> component no longer needs to keep track of state. It will receive the current video as a prop instead.</p></li><li class="list__item" id="-h7gbkp_341"><p id="-h7gbkp_350">Remove the <code class="code" id="-h7gbkp_351">useState()</code> call in <code class="code" id="-h7gbkp_352">VideoList.kt</code>.</p></li><li class="list__item" id="-h7gbkp_342"><p id="-h7gbkp_353">Prepare the <code class="code" id="-h7gbkp_355">VideoList</code> component to receive the selected video as a prop. To do so, expand the <code class="code" id="-h7gbkp_356">VideoListProps</code> interface to contain the <code class="code" id="-h7gbkp_357">selectedVideo</code>:</p><div class="code-block" data-lang="kotlin">
external interface VideoListProps : Props {
    var videos: List&lt;Video&gt;
    var selectedVideo: Video?
}
</div></li><li class="list__item" id="-h7gbkp_343"><p id="-h7gbkp_358">Change the condition of the triangle so that it uses <code class="code" id="-h7gbkp_360">props</code> instead of <code class="code" id="-h7gbkp_361">state</code>:</p><div class="code-block" data-lang="kotlin">
if (video == props.selectedVideo) {
    +&quot;▶ &quot;
}
</div></li></ol></section><section class="chapter"><h3 id="pass-handlers" data-toc="pass-handlers">Pass handlers</h3><p id="-h7gbkp_362">At the moment, there's no way to assign a value to a prop, so the <code class="code" id="-h7gbkp_366">onClick</code> function won't work the way it is currently set up. To change state of a parent component, you need to lift state again.</p><p id="-h7gbkp_363">In React, state always flows from parent to child. So, to change the <span class="emphasis" id="-h7gbkp_367">application</span> state from one of the child components, you need to move the logic for handling user interaction to the parent component and then pass the logic in as a prop. Remember that in Kotlin, variables can have the <a href="lambdas.html#function-types" id="-h7gbkp_368">type of a function</a>.</p><ol class="list _decimal" id="-h7gbkp_364" type="1"><li class="list__item" id="-h7gbkp_369"><p id="-h7gbkp_373">Expand the <code class="code" id="-h7gbkp_375">VideoListProps</code> interface again so that it contains a variable <code class="code" id="-h7gbkp_376">onSelectVideo</code>, which is a function that takes a <code class="code" id="-h7gbkp_377">Video</code> and returns <code class="code" id="-h7gbkp_378">Unit</code>:</p><div class="code-block" data-lang="kotlin">
external interface VideoListProps : Props {
    // ...
    var onSelectVideo: (Video) -&gt; Unit
}
</div></li><li class="list__item" id="-h7gbkp_370"><p id="-h7gbkp_379">In the <code class="code" id="-h7gbkp_382">VideoList</code> component, use the new prop in the <code class="code" id="-h7gbkp_383">onClick</code> handler:</p><div class="code-block" data-lang="kotlin">
onClick = {
    props.onSelectVideo(video)
}
</div><p id="-h7gbkp_381">You can now delete the <code class="code" id="-h7gbkp_384">selectedVideo</code> variable from the <code class="code" id="-h7gbkp_385">VideoList</code> component.</p></li><li class="list__item" id="-h7gbkp_371"><p id="-h7gbkp_386">Go back to the <code class="code" id="-h7gbkp_388">App</code> component and pass <code class="code" id="-h7gbkp_389">selectedVideo</code> and a handler for <code class="code" id="-h7gbkp_390">onSelectVideo</code> for each of the two video lists:</p><div class="code-block" data-lang="kotlin">
VideoList {
    videos = unwatchedVideos // and watchedVideos respectively
    selectedVideo = currentVideo
    onSelectVideo = { video -&gt;
        currentVideo = video
    }
}
</div></li><li class="list__item" id="-h7gbkp_372"><p id="-h7gbkp_391">Repeat the previous step for the watched videos list.</p></li></ol><p id="-h7gbkp_365">Switch back to your browser and make sure that when selecting a video the selection jumps between the two lists without duplication.</p></section></section><section class="chapter"><h2 id="add-more-components" data-toc="add-more-components">Add more components</h2><section class="chapter"><h3 id="extract-the-video-player-component" data-toc="extract-the-video-player-component">Extract the video player component</h3><p id="-h7gbkp_395">You can now create another self-contained component, a video player, which is currently a placeholder image. Your video player needs to know the talk title, the author of the talk, and the link to the video. This information is already contained in each <code class="code" id="-h7gbkp_398">Video</code> object, so you can pass it as a prop and access its attributes.</p><ol class="list _decimal" id="-h7gbkp_396" type="1"><li class="list__item" id="-h7gbkp_399"><p id="-h7gbkp_401">Create a new <code class="code" id="-h7gbkp_403">VideoPlayer.kt</code> file and add the following implementation for the <code class="code" id="-h7gbkp_404">VideoPlayer</code> component:</p><div class="code-block" data-lang="kotlin">
import csstype.*
import react.*
import emotion.react.css
import react.dom.html.ReactHTML.button
import react.dom.html.ReactHTML.div
import react.dom.html.ReactHTML.h3
import react.dom.html.ReactHTML.img

external interface VideoPlayerProps : Props {
    var video: Video
}

val VideoPlayer = FC&lt;VideoPlayerProps&gt; { props -&gt;
    div {
        css {
            position = Position.absolute
            top = 10.px
            right = 10.px
        }
        h3 {
            +&quot;${props.video.speaker}: ${props.video.title}&quot;
        }
        img {
            src = &quot;https://via.placeholder.com/640x360.png?text=Video+Player+Placeholder&quot;              
        }
    }
}
</div></li><li class="list__item" id="-h7gbkp_400"><p id="-h7gbkp_405">Because the <code class="code" id="-h7gbkp_409">VideoPlayerProps</code> interface specifies that the <code class="code" id="-h7gbkp_410">VideoPlayer</code> component takes a non-nullable <code class="code" id="-h7gbkp_411">Video</code>, make sure to handle this in the <code class="code" id="-h7gbkp_412">App</code> component accordingly.</p><p id="-h7gbkp_406">In <code class="code" id="-h7gbkp_413">App.kt</code>, replace the previous <code class="code" id="-h7gbkp_414">div</code> snippet for the video player with the following:</p><div class="code-block" data-lang="kotlin">
currentVideo?.let { curr -&gt;
    VideoPlayer {
        video = curr
    }
}
</div><p id="-h7gbkp_408">The <a href="scope-functions.html#let" id="-h7gbkp_415"><code class="code" id="-h7gbkp_418">let</code> scope function</a> ensures that the <code class="code" id="-h7gbkp_416">VideoPlayer</code> component is only added when <code class="code" id="-h7gbkp_417">state.currentVideo</code> is not null.</p></li></ol><p id="-h7gbkp_397">Now clicking an entry in the list will bring up the video player and populate it with the information from the clicked entry.</p></section><section class="chapter"><h3 id="add-a-button-and-wire-it" data-toc="add-a-button-and-wire-it">Add a button and wire it</h3><p id="-h7gbkp_419">To make it possible for users to mark a video as watched or unwatched and to move it between the two lists, add a button to the <code class="code" id="-h7gbkp_422">VideoPlayer</code> component.</p><p id="-h7gbkp_420">Since this button will move videos between two different lists, the logic handling state change needs to be <span class="emphasis" id="-h7gbkp_423">lifted</span> out of the <code class="code" id="-h7gbkp_424">VideoPlayer</code> and passed in from the parent as a prop. The button should look different based on whether the video has been watched or not. This is also information you need to pass as a prop.</p><ol class="list _decimal" id="-h7gbkp_421" type="1"><li class="list__item" id="-h7gbkp_425"><p id="-h7gbkp_427">Expand the <code class="code" id="-h7gbkp_429">VideoPlayerProps</code> interface in <code class="code" id="-h7gbkp_430">VideoPlayer.kt</code> to include properties for those two cases:</p><div class="code-block" data-lang="kotlin">
external interface VideoPlayerProps : Props {
    var video: Video
    var onWatchedButtonPressed: (Video) -&gt; Unit
    var unwatchedVideo: Boolean
}
</div></li><li class="list__item" id="-h7gbkp_426"><p id="-h7gbkp_431">You can now add the button to the actual component. Copy the following snippet into the body of the <code class="code" id="-h7gbkp_434">VideoPlayer</code> component, between the <code class="code" id="-h7gbkp_435">h3</code> and <code class="code" id="-h7gbkp_436">img</code> tags:</p><div class="code-block" data-lang="kotlin">
button {
    css {
        display = Display.block
        backgroundColor = if (props.unwatchedVideo) NamedColor.lightgreen else NamedColor.red
    }
    onClick = {
        props.onWatchedButtonPressed(props.video)
    }
    if (props.unwatchedVideo) {
        +&quot;Mark as watched&quot;
    } else {
        +&quot;Mark as unwatched&quot;
    }
}
</div><p id="-h7gbkp_433">With the help of Kotlin CSS DSL that make it possible to change styles dynamically, you can change the color of the button using a basic Kotlin <code class="code" id="-h7gbkp_437">if</code> expression.</p></li></ol></section><section class="chapter"><h3 id="move-video-lists-to-the-application-state" data-toc="move-video-lists-to-the-application-state">Move video lists to the application state</h3><p id="-h7gbkp_438">Now it's time to adjust the <code class="code" id="-h7gbkp_441">VideoPlayer</code> usage site in the <code class="code" id="-h7gbkp_442">App</code> component. When the button is clicked, a video should be moved from the unwatched list to the watched list or vice versa. Since these lists can now actually change, move them into the application state:</p><ol class="list _decimal" id="-h7gbkp_439" type="1"><li class="list__item" id="-h7gbkp_443"><p id="-h7gbkp_446">In <code class="code" id="-h7gbkp_448">App.kt</code>, add the following properties with <code class="code" id="-h7gbkp_449">useState()</code> calls to the top of the <code class="code" id="-h7gbkp_450">App</code> component:</p><div class="code-block" data-lang="kotlin">
val App = FC&lt;Props&gt; {
    var currentVideo: Video? by useState(null)
    var unwatchedVideos: List&lt;Video&gt; by useState(listOf(
        Video(1, &quot;Opening Keynote&quot;, &quot;Andrey Breslav&quot;, &quot;https://youtu.be/PsaFVLr8t4E&quot;),
        Video(2, &quot;Dissecting the stdlib&quot;, &quot;Huyen Tue Dao&quot;, &quot;https://youtu.be/Fzt_9I733Yg&quot;),
        Video(3, &quot;Kotlin and Spring Boot&quot;, &quot;Nicolas Frankel&quot;, &quot;https://youtu.be/pSiZVAeReeg&quot;)
    ))
    var watchedVideos: List&lt;Video&gt; by useState(listOf(
        Video(4, &quot;Creating Internal DSLs in Kotlin&quot;, &quot;Venkat Subramaniam&quot;, &quot;https://youtu.be/JzTeAM8N1-o&quot;)
    ))

    // . . .
}
</div></li><li class="list__item" id="-h7gbkp_444"><p id="-h7gbkp_451">Since all the demo data is included in the default values for <code class="code" id="-h7gbkp_452">watchedVideos</code> and <code class="code" id="-h7gbkp_453">unwatchedVideos</code> directly, you no longer need the file-level declarations. In <code class="code" id="-h7gbkp_454">Main.kt</code>, delete the declarations for <code class="code" id="-h7gbkp_455">watchedVideos</code> and <code class="code" id="-h7gbkp_456">unwatchedVideos</code>.</p></li><li class="list__item" id="-h7gbkp_445"><p id="-h7gbkp_457">Change the call-site for <code class="code" id="-h7gbkp_459">VideoPlayer</code> in the <code class="code" id="-h7gbkp_460">App</code> component that belongs to the video player to look like this:</p><div class="code-block" data-lang="kotlin">
VideoPlayer {
    video = curr
    unwatchedVideo = curr in unwatchedVideos
    onWatchedButtonPressed = {
        if (video in unwatchedVideos) {
            unwatchedVideos = unwatchedVideos - video
            watchedVideos = watchedVideos + video
        } else {
            watchedVideos = watchedVideos - video
            unwatchedVideos = unwatchedVideos + video
        }
    }
}
</div></li></ol><p id="-h7gbkp_440">Go back to the browser, select a video, and press the button a few times. The video will jump between the two lists.</p></section></section><section class="chapter"><h2 id="use-packages-from-npm" data-toc="use-packages-from-npm">Use packages from npm</h2><p id="-h7gbkp_461">To make the app usable, you still need a video player that actually plays videos and some buttons to help people share the content.</p><p id="-h7gbkp_462">React has a rich ecosystem with a lot of pre-made components you can use instead of building this functionality yourself.</p><section class="chapter"><h3 id="add-the-video-player-component" data-toc="add-the-video-player-component">Add the video player component</h3><p id="-h7gbkp_465">To replace the placeholder video component with an actual YouTube player, use the <code class="code" id="-h7gbkp_471">react-player</code> package from npm. It can play videos and allows you to control the appearance of the player.</p><p id="-h7gbkp_466">For the component documentation and the API description, see its <a href="https://www.npmjs.com/package/react-player" id="-h7gbkp_472" data-external="true" rel="noopener noreferrer" target="_blank">README</a> in GitHub.</p><ol class="list _decimal" id="-h7gbkp_467" type="1"><li class="list__item" id="-h7gbkp_473"><p id="-h7gbkp_475">Check the <code class="code" id="-h7gbkp_478">build.gradle.kts</code> file. The <code class="code" id="-h7gbkp_479">react-player</code> package should be already included:</p><div class="code-block" data-lang="kotlin">
dependencies {
    // ...
    // Video Player
    implementation(npm(&quot;react-player&quot;, &quot;2.12.0&quot;))
    // ...
}
</div><p id="-h7gbkp_477">As you can see, npm dependencies can be added to a Kotlin/JS project by using the <code class="code" id="-h7gbkp_480">npm()</code> function in the <code class="code" id="-h7gbkp_481">dependencies</code> block of the build file. The Gradle plugin then takes care of downloading and installing these dependencies for you. To do so, it uses its own bundled installation of the <a href="https://yarnpkg.com/" id="-h7gbkp_482" data-external="true" rel="noopener noreferrer" target="_blank">Yarn</a> package manager.</p></li><li class="list__item" id="-h7gbkp_474"><p id="-h7gbkp_483">To use the JavaScript package from inside the React application, it's necessary to tell the Kotlin compiler what to expect by providing it with <a href="js-interop.html" id="-h7gbkp_488">external declarations</a>.</p><p id="-h7gbkp_484">Create a new <code class="code" id="-h7gbkp_489">ReactYouTube.kt</code> file and add the following content:</p><div class="code-block" data-lang="kotlin">
@file:JsModule(&quot;react-player&quot;)
@file:JsNonModule

import react.*

@JsName(&quot;default&quot;)
external val ReactPlayer: ComponentClass&lt;dynamic&gt;
</div><p id="-h7gbkp_486">When the compiler sees an external declaration like <code class="code" id="-h7gbkp_490">ReactPlayer</code>, it assumes that the implementation for the corresponding class is provided by the dependency and doesn't generate code for it.</p><p id="-h7gbkp_487">The last two lines are equivalent to a JavaScript import like <code class="code" id="-h7gbkp_491">require(&quot;react-player&quot;).default;</code>. They tell the compiler that it's certain that a component will conform to <code class="code" id="-h7gbkp_492">ComponentClass&lt;dynamic&gt;</code> at runtime.</p></li></ol><p id="-h7gbkp_468">However, in this configuration, the generic type for the props accepted by <code class="code" id="-h7gbkp_493">ReactPlayer</code> is set to <code class="code" id="-h7gbkp_494">dynamic</code>. That means the compiler will accept any code, at the risk of breaking things at runtime.</p><p id="-h7gbkp_469">A better alternative is to create an <code class="code" id="-h7gbkp_495">external interface</code> that specifies what kind of properties belong to the props for this external component. You can learn about the props' interface in the <a href="https://www.npmjs.com/package/react-player" id="-h7gbkp_496" data-external="true" rel="noopener noreferrer" target="_blank">README</a> for the component. In this case, use the <code class="code" id="-h7gbkp_497">url</code> and <code class="code" id="-h7gbkp_498">controls</code> props:</p><ol class="list _decimal" id="-h7gbkp_470" type="1"><li class="list__item" id="-h7gbkp_499"><p id="-h7gbkp_501">Adjust the content of <code class="code" id="-h7gbkp_503">ReactYouTube.kt</code> by replacing <code class="code" id="-h7gbkp_504">dynamic</code> with an external interface:</p><div class="code-block" data-lang="kotlin">
@file:JsModule(&quot;react-player&quot;)
@file:JsNonModule

import react.*

@JsName(&quot;default&quot;)
external val ReactPlayer: ComponentClass&lt;ReactPlayerProps&gt;

external interface ReactPlayerProps : Props {
    var url: String
    var controls: Boolean
}
</div></li><li class="list__item" id="-h7gbkp_500"><p id="-h7gbkp_505">You can now use the new <code class="code" id="-h7gbkp_507">ReactPlayer</code> to replace the gray placeholder rectangle in the <code class="code" id="-h7gbkp_508">VideoPlayer</code> component. In <code class="code" id="-h7gbkp_509">VideoPlayer.kt</code>, replace the <code class="code" id="-h7gbkp_510">img</code> tag with the following snippet:</p><div class="code-block" data-lang="kotlin">
ReactPlayer {
    url = props.video.videoUrl
    controls = true
}
</div></li></ol></section><section class="chapter"><h3 id="add-social-share-buttons" data-toc="add-social-share-buttons">Add social share buttons</h3><p id="-h7gbkp_511">An easy way to share the application's content is to have social share buttons for messengers and email. You can use an off-the-shelf React component for this as well, for example, <a href="https://github.com/nygardk/react-share/blob/master/README.md" id="-h7gbkp_516" data-external="true" rel="noopener noreferrer" target="_blank">react-share</a>:</p><ol class="list _decimal" id="-h7gbkp_512" type="1"><li class="list__item" id="-h7gbkp_517"><p id="-h7gbkp_520">Check the <code class="code" id="-h7gbkp_522">build.gradle.kts</code> file. This npm library should already be included:</p><div class="code-block" data-lang="kotlin">
dependencies {
    // ...
    // Share Buttons
    implementation(npm(&quot;react-share&quot;, &quot;4.4.1&quot;))
    // ...
}
</div></li><li class="list__item" id="-h7gbkp_518"><p id="-h7gbkp_523">To use <code class="code" id="-h7gbkp_526">react-share</code> from Kotlin, you'll need to write more basic external declarations. The <a href="https://github.com/nygardk/react-share/blob/master/demo/Demo.tsx#L61" id="-h7gbkp_527" data-external="true" rel="noopener noreferrer" target="_blank">examples on GitHub</a> show that a share button consists of two React components: <code class="code" id="-h7gbkp_528">EmailShareButton</code> and <code class="code" id="-h7gbkp_529">EmailIcon</code>, for example. Different types of share buttons and icons all have the same kind of interface. You'll create the external declarations for each component the same way you already did for the video player.</p><p id="-h7gbkp_524">Add the following code to a new <code class="code" id="-h7gbkp_530">ReactShare.kt</code> file:</p><div class="code-block" data-lang="kotlin">
@file:JsModule(&quot;react-share&quot;)
@file:JsNonModule

import react.ComponentClass
import react.Props

@JsName(&quot;EmailIcon&quot;)
external val EmailIcon: ComponentClass&lt;IconProps&gt;

@JsName(&quot;EmailShareButton&quot;)
external val EmailShareButton: ComponentClass&lt;ShareButtonProps&gt;

@JsName(&quot;TelegramIcon&quot;)
external val TelegramIcon: ComponentClass&lt;IconProps&gt;

@JsName(&quot;TelegramShareButton&quot;)
external val TelegramShareButton: ComponentClass&lt;ShareButtonProps&gt;

external interface ShareButtonProps : Props {
    var url: String
}

external interface IconProps : Props {
    var size: Int
    var round: Boolean
}
</div></li><li class="list__item" id="-h7gbkp_519"><p id="-h7gbkp_531">Add new components into the user interface of the application. In <code class="code" id="-h7gbkp_533">VideoPlayer.kt</code>, add two share buttons in a <code class="code" id="-h7gbkp_534">div</code> right above the usage of <code class="code" id="-h7gbkp_535">ReactPlayer</code>:</p><div class="code-block" data-lang="kotlin">
// . . .

div {
    css {
         position = Position.absolute
         top = 10.px
         right = 10.px
     }
    EmailShareButton {
        url = props.video.videoUrl
        EmailIcon {
            size = 32
            round = true
        }
    }
    TelegramShareButton {
        url = props.video.videoUrl
        TelegramIcon {
            size = 32
            round = true
        }
    }
}

// . . .
</div></li></ol><p id="-h7gbkp_513">You can now check your browser and see whether the buttons actually work. When clicking on the button, a <span class="emphasis" id="-h7gbkp_536">share window</span> should appear with the URL of the video. If the buttons don't show up or work, you may need to disable your ad and social media blocker.</p><figure id="-h7gbkp_514"><img alt="Share window" src="images/social-buttons.png" title="Share window" width="700" height="465"></figure><p id="-h7gbkp_515">Feel free to repeat this step with share buttons for other social networks available in <a href="https://github.com/nygardk/react-share/blob/master/README.md#features" id="-h7gbkp_537" data-external="true" rel="noopener noreferrer" target="_blank">react-share</a>.</p></section></section><section class="chapter"><h2 id="use-an-external-rest-api" data-toc="use-an-external-rest-api">Use an external REST API</h2><p id="-h7gbkp_538">You can now replace the hard-coded demo data with some real data from a REST API in the app.</p><p id="-h7gbkp_539">For this tutorial, there's a <a href="https://my-json-server.typicode.com/kotlin-hands-on/kotlinconf-json/videos/1" id="-h7gbkp_543" data-external="true" rel="noopener noreferrer" target="_blank">small API</a>. It offers only a single endpoint, <code class="code" id="-h7gbkp_544">videos</code>, and takes a numeric parameter to access an element from the list. If you visit the API with your browser, you will see that the objects returned from the API have the same structure as <code class="code" id="-h7gbkp_545">Video</code> objects.</p><section class="chapter"><h3 id="use-js-functionality-from-kotlin" data-toc="use-js-functionality-from-kotlin">Use JS functionality from Kotlin</h3><p id="-h7gbkp_546">Browsers already come with a large variety of <a href="https://developer.mozilla.org/en-US/docs/Web/API" id="-h7gbkp_552" data-external="true" rel="noopener noreferrer" target="_blank">Web APIs</a>. You can also use them from Kotlin/JS, since it includes wrappers for these APIs out of the box. One example is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" id="-h7gbkp_553" data-external="true" rel="noopener noreferrer" target="_blank">fetch API</a>, which is used for making HTTP requests.</p><p id="-h7gbkp_547">The first potential issue is that browser APIs like <code class="code" id="-h7gbkp_554">fetch()</code> use <a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function" id="-h7gbkp_555" data-external="true" rel="noopener noreferrer" target="_blank">callbacks</a> to perform non-blocking operations. When multiple callbacks are supposed to run one after the other, they need to be nested. Naturally, the code gets heavily indented, with more and more pieces of functionality stacked inside each other, which makes it harder to read.</p><p id="-h7gbkp_548">To overcome this, you can use Kotlin's coroutines, a better approach for such functionality.</p><p id="-h7gbkp_549">The second issue arises from the dynamically typed nature of JavaScript. There are no guarantees about the type of data returned from the external API. To solve this, you can use the <code class="code" id="-h7gbkp_556">kotlinx.serialization</code> library.</p><p id="-h7gbkp_550">Check the <code class="code" id="-h7gbkp_557">build.gradle.kts</code> file. The relevant snippet should already exist:</p><div class="code-block" data-lang="kotlin">
dependencies {
    // . . .

    // Coroutines &amp; serialization
    implementation(&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.6.4&quot;)
}
</div></section><section class="chapter"><h3 id="add-serialization" data-toc="add-serialization">Add serialization</h3><p id="-h7gbkp_558">When you call an external API, you get back JSON-formatted text that still needs to be turned into a Kotlin object that can be worked with.</p><p id="-h7gbkp_559"><a href="https://github.com/Kotlin/kotlinx.serialization" id="-h7gbkp_561" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-h7gbkp_562">kotlinx.serialization</code></a> is a library that makes it possible to write these types of conversions from JSON strings to Kotlin objects.</p><ol class="list _decimal" id="-h7gbkp_560" type="1"><li class="list__item" id="-h7gbkp_563"><p id="-h7gbkp_565">Check the <code class="code" id="-h7gbkp_567">build.gradle.kts</code> file. The corresponding snippet should already exist:</p><div class="code-block" data-lang="kotlin">
plugins {
    // . . .
    kotlin(&quot;plugin.serialization&quot;) version &quot;2.2.0&quot;
}

dependencies {
    // . . .

    // Serialization
    implementation(&quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.0&quot;)
}
</div></li><li class="list__item" id="-h7gbkp_564"><p id="-h7gbkp_568">As preparation for fetching the first video, it's necessary to tell the serialization library about the <code class="code" id="-h7gbkp_570">Video</code> class. In <code class="code" id="-h7gbkp_571">Main.kt</code>, add the <code class="code" id="-h7gbkp_572">@Serializable</code> annotation to its definition:</p><div class="code-block" data-lang="kotlin">
@Serializable
data class Video(
    val id: Int,
    val title: String,
    val speaker: String,
    val videoUrl: String
)
</div></li></ol></section><section class="chapter"><h3 id="fetch-videos" data-toc="fetch-videos">Fetch videos</h3><p id="-h7gbkp_573">To fetch a video from the API, add the following function in <code class="code" id="-h7gbkp_583">App.kt</code> (or a new file):</p><div class="code-block" data-lang="kotlin">
suspend fun fetchVideo(id: Int): Video {
    val response = window
        .fetch(&quot;https://my-json-server.typicode.com/kotlin-hands-on/kotlinconf-json/videos/$id&quot;)
        .await()
        .text()
        .await()
    return Json.decodeFromString(response)
}
</div><ul class="list _bullet" id="-h7gbkp_575"><li class="list__item" id="-h7gbkp_584"><p id="-h7gbkp_587"><span class="emphasis" id="-h7gbkp_588">Suspending function</span> <code class="code" id="-h7gbkp_589">fetch()</code> fetches a video with a given <code class="code" id="-h7gbkp_590">id</code> from the API. This response may take a while, so you <code class="code" id="-h7gbkp_591">await()</code> the result. Next, <code class="code" id="-h7gbkp_592">text()</code>, which uses a callback, reads the body from the response. Then you <code class="code" id="-h7gbkp_593">await()</code> its completion.</p></li><li class="list__item" id="-h7gbkp_585"><p id="-h7gbkp_594">Before returning the value of the function, you pass it to <code class="code" id="-h7gbkp_595">Json.decodeFromString</code>, a function from <code class="code" id="-h7gbkp_596">kotlinx.coroutines</code>. It converts the JSON text you received from the request into a Kotlin object with the appropriate fields.</p></li><li class="list__item" id="-h7gbkp_586"><p id="-h7gbkp_597">The <code class="code" id="-h7gbkp_598">window.fetch</code> function call returns a <code class="code" id="-h7gbkp_599">Promise</code> object. You normally would have to define a callback handler that gets invoked once the <code class="code" id="-h7gbkp_600">Promise</code> is resolved and a result is available. However, with coroutines, you can <code class="code" id="-h7gbkp_601">await()</code> those promises. Whenever a function like <code class="code" id="-h7gbkp_602">await()</code> is called, the method stops (suspends) its execution. Its execution continues once the <code class="code" id="-h7gbkp_603">Promise</code> can be resolved.</p></li></ul><p id="-h7gbkp_576">To give users a selection of videos, define the <code class="code" id="-h7gbkp_604">fetchVideos()</code> function, which will fetch 25 videos from the same API as above. To run all the requests concurrently, use the <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/async.html" id="-h7gbkp_605" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-h7gbkp_606">async</code></a> functionality provided by Kotlin's coroutines:</p><ol class="list _decimal" id="-h7gbkp_577" type="1"><li class="list__item" id="-h7gbkp_607"><p id="-h7gbkp_609">Add the following implementation to your <code class="code" id="-h7gbkp_612">App.kt</code>:</p><div class="code-block" data-lang="kotlin">
suspend fun fetchVideos(): List&lt;Video&gt; = coroutineScope {
    (1..25).map { id -&gt;
        async {
            fetchVideo(id)
        }
    }.awaitAll()
}
</div><p id="-h7gbkp_611">Following the principle of <a href="https://kotlinlang.org/docs/coroutines-basics.html#structured-concurrency" id="-h7gbkp_613" data-external="true" rel="noopener noreferrer" target="_blank">structured concurrency</a>, the implementation is wrapped in a <code class="code" id="-h7gbkp_614">coroutineScope</code>. You can then start 25 asynchronous tasks (one per request) and wait for all of them to complete.</p></li><li class="list__item" id="-h7gbkp_608"><p id="-h7gbkp_615">You can now add data to your application. Add the definition for a <code class="code" id="-h7gbkp_619">mainScope</code>, and change your <code class="code" id="-h7gbkp_620">App</code> component so it starts with the following snippet. Don't forget to replace demo values with <code class="code" id="-h7gbkp_621">emptyLists</code> instances as well:</p><div class="code-block" data-lang="kotlin">
val mainScope = MainScope()

val App = FC&lt;Props&gt; {
    var currentVideo: Video? by useState(null)
    var unwatchedVideos: List&lt;Video&gt; by useState(emptyList())
    var watchedVideos: List&lt;Video&gt; by useState(emptyList())

    useEffectOnce {
        mainScope.launch {
            unwatchedVideos = fetchVideos()
        }
    }

// . . .
</div><p id="-h7gbkp_617"></p><ul class="list _bullet" id="-h7gbkp_618"><li class="list__item" id="-h7gbkp_622"><p id="-h7gbkp_624">The <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-main-scope.html" id="-h7gbkp_625" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-h7gbkp_626">MainScope()</code></a> is a part of Kotlin's structured concurrency model and creates the scope for asynchronous tasks to run in.</p></li><li class="list__item" id="-h7gbkp_623"><p id="-h7gbkp_627"><code class="code" id="-h7gbkp_628">useEffectOnce</code> is another React <span class="emphasis" id="-h7gbkp_629">hook</span> (specifically, a simplified version of the <a href="https://reactjs.org/docs/hooks-effect.html" id="-h7gbkp_630" data-external="true" rel="noopener noreferrer" target="_blank">useEffect</a> hook). It indicates that the component performs a <span class="emphasis" id="-h7gbkp_631">side effect</span>. It doesn't just render itself but also communicates over the network.</p></li></ul></li></ol><p id="-h7gbkp_578">Check your browser. The application should show actual data:</p><figure id="-h7gbkp_579"><img alt="Fetched data from API" src="images/website-api-data.png" title="Fetched data from API" width="700" height="444"></figure><p id="-h7gbkp_580">When you load the page:</p><ul class="list _bullet" id="-h7gbkp_581"><li class="list__item" id="-h7gbkp_632"><p id="-h7gbkp_636">The code of the <code class="code" id="-h7gbkp_637">App</code> component will be invoked. This starts the code in the <code class="code" id="-h7gbkp_638">useEffectOnce</code> block.</p></li><li class="list__item" id="-h7gbkp_633"><p id="-h7gbkp_639">The <code class="code" id="-h7gbkp_640">App</code> component is rendered with empty lists for the watched and unwatched videos.</p></li><li class="list__item" id="-h7gbkp_634"><p id="-h7gbkp_641">When the API requests finish, the <code class="code" id="-h7gbkp_642">useEffectOnce</code> block assigns it to the <code class="code" id="-h7gbkp_643">App</code> component's state. This triggers a re-render.</p></li><li class="list__item" id="-h7gbkp_635"><p id="-h7gbkp_644">The code of the <code class="code" id="-h7gbkp_645">App</code> component will be invoked again, but the <code class="code" id="-h7gbkp_646">useEffectOnce</code> block <span class="emphasis" id="-h7gbkp_647">will not</span> run for a second time.</p></li></ul><p id="-h7gbkp_582">If you want to get an in-depth understanding of how coroutines work, check out this <span id="-h7gbkp_648">tutorial on coroutines</span>.</p></section></section><section class="chapter"><h2 id="deploy-to-production-and-the-cloud" data-toc="deploy-to-production-and-the-cloud">Deploy to production and the cloud</h2><p id="-h7gbkp_649">It's time to get the application published to the cloud and make it accessible to other people.</p><section class="chapter"><h3 id="package-a-production-build" data-toc="package-a-production-build">Package a production build</h3><p id="-h7gbkp_652">To package all assets in production mode, run the <code class="code" id="-h7gbkp_654">build</code> task in Gradle via the tool window in IntelliJ IDEA or by running <code class="code" id="-h7gbkp_655">./gradlew build</code>. This generates an optimized project build, applying various improvements such as DCE (dead code elimination).</p><p id="-h7gbkp_653">Once the build has finished, you can find all the files needed for deployment in <code class="code" id="-h7gbkp_656">/build/dist</code>. They include the JavaScript files, HTML files, and other resources required to run the application. You can put them on a static HTTP server, serve them using GitHub Pages, or host them on a cloud provider of your choice.</p></section><section class="chapter"><h3 id="deploy-to-heroku" data-toc="deploy-to-heroku">Deploy to Heroku</h3><p id="-h7gbkp_657">Heroku makes it quite simple to spin up an application that is reachable under its own domain. Their free tier should be sufficient for development purposes.</p><ol class="list _decimal" id="-h7gbkp_658" type="1"><li class="list__item" id="-h7gbkp_663"><p id="-h7gbkp_671"><a href="https://signup.heroku.com/" id="-h7gbkp_672" data-external="true" rel="noopener noreferrer" target="_blank">Create an account</a>.</p></li><li class="list__item" id="-h7gbkp_664"><p id="-h7gbkp_673"><a href="https://devcenter.heroku.com/articles/heroku-cli" id="-h7gbkp_674" data-external="true" rel="noopener noreferrer" target="_blank">Install and authenticate the CLI client</a>.</p></li><li class="list__item" id="-h7gbkp_665"><p id="-h7gbkp_675">Create a Git repository and attach a Heroku app by running the following commands in the Terminal while in the project root:</p><div class="code-block" data-lang="bash">
git init
heroku create
git add .
git commit -m &quot;initial commit&quot;
</div></li><li class="list__item" id="-h7gbkp_666"><p id="-h7gbkp_677">Unlike a regular JVM application that would run on Heroku (one written with Ktor or Spring Boot, for example), your app generates static HTML pages and JavaScript files that need to be served accordingly. You can adjust the required buildpacks to serve the program properly:</p><div class="code-block" data-lang="bash">
heroku buildpacks:set heroku/gradle
heroku buildpacks:add https://github.com/heroku/heroku-buildpack-static.git
</div></li><li class="list__item" id="-h7gbkp_667"><p id="-h7gbkp_679">To allow the <code class="code" id="-h7gbkp_681">heroku/gradle</code> buildpack to run properly, a <code class="code" id="-h7gbkp_682">stage</code> task needs to be in the <code class="code" id="-h7gbkp_683">build.gradle.kts</code> file. This task is equivalent to the <code class="code" id="-h7gbkp_684">build</code> task, and the corresponding alias is already included at the bottom of the file:</p><div class="code-block" data-lang="kotlin">
// Heroku Deployment
tasks.register(&quot;stage&quot;) {
    dependsOn(&quot;build&quot;)
}
</div></li><li class="list__item" id="-h7gbkp_668"><p id="-h7gbkp_685">Add a new <code class="code" id="-h7gbkp_686">static.json</code> file to the project root to configure the <code class="code" id="-h7gbkp_687">buildpack-static</code>.</p></li><li class="list__item" id="-h7gbkp_669"><p id="-h7gbkp_688">Add the <code class="code" id="-h7gbkp_691">root</code> property inside the file:</p><div class="code-block" data-lang="markup">
{
    &quot;root&quot;: &quot;build/distributions&quot;
}
</div><p id="-h7gbkp_690"></p></li><li class="list__item" id="-h7gbkp_670"><p id="-h7gbkp_692">You can now trigger a deployment, for example, by running the following command:</p><div class="code-block" data-lang="bash">
git add -A
git commit -m &quot;add stage task and static content root configuration&quot;
git push heroku master
</div></li></ol><aside class="prompt" data-type="tip" data-title="" id="-h7gbkp_659"><p id="-h7gbkp_694">If you're pushing from a non-main branch, adjust the command to push to the <code class="code" id="-h7gbkp_695">main</code> remote, for example, <code class="code" id="-h7gbkp_696">git push heroku feature-branch:main</code>.</p></aside><p id="-h7gbkp_660">If the deployment is successful, you will see the URL people can use to reach the application on the internet.</p><figure id="-h7gbkp_661"><img alt="Web app deployment to production" src="images/deployment-to-production.png" title="Web app deployment to production" width="700" height="402"></figure><aside class="prompt" data-type="note" data-title="" id="-h7gbkp_662"><p id="-h7gbkp_697">You can find this state of the project on the <code class="code" id="-h7gbkp_698">finished</code> branch <a href="https://github.com/kotlin-hands-on/web-app-react-kotlin-js-gradle/tree/finished" id="-h7gbkp_699" data-external="true" rel="noopener noreferrer" target="_blank">here</a>.</p></aside></section></section><section class="chapter"><h2 id="what-s-next" data-toc="what-s-next">What's next</h2><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="add-more-features" data-toc="add-more-features">Add more features</h3></div><div class="collapse__content"><p id="-h7gbkp_705">You can use the resulting app as a jumping-off point to explore more advanced topics in the realm of React, Kotlin/JS, and more.</p><ul class="list _bullet" id="-h7gbkp_706"><li class="list__item" id="-h7gbkp_707"><p id="-h7gbkp_710"><span class="control" id="-h7gbkp_711">Search</span>. You can add a search field to filter the list of talks &ndash; by title or by author, for example. Learn about how <a href="https://reactjs.org/docs/forms.html" id="-h7gbkp_712" data-external="true" rel="noopener noreferrer" target="_blank">HTML form elements work in React</a>.</p></li><li class="list__item" id="-h7gbkp_708"><p id="-h7gbkp_713"><span class="control" id="-h7gbkp_714">Persistence</span>. Currently, the application loses track of the viewer's watch list every time the page gets reloaded. Consider building your own backend, using one of the web frameworks available for Kotlin (such as <a href="https://ktor.io/" id="-h7gbkp_715" data-external="true" rel="noopener noreferrer" target="_blank">Ktor</a>). Alternatively, look into ways to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" id="-h7gbkp_716" data-external="true" rel="noopener noreferrer" target="_blank">store information on the client</a>.</p></li><li class="list__item" id="-h7gbkp_709"><p id="-h7gbkp_717"><span class="control" id="-h7gbkp_718">Complex APIs</span>. Lots of datasets and APIs are available. You can pull all sorts of data into your application. For example, you can build a visualizer for <a href="https://thecatapi.com/" id="-h7gbkp_719" data-external="true" rel="noopener noreferrer" target="_blank">cat photos</a> or a <a href="https://unsplash.com/developers" id="-h7gbkp_720" data-external="true" rel="noopener noreferrer" target="_blank">royalty-free stock photo API</a>.</p></li></ul></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="improve-the-style-responsiveness-and-grids" data-toc="improve-the-style-responsiveness-and-grids">Improve the style: responsiveness and grids</h3></div><div class="collapse__content"><p id="-h7gbkp_721">The application design is still very simple and won't look great on mobile devices or in narrow windows. Explore more of the CSS DSL to make the app more accessible.</p></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="join-the-community-and-get-help" data-toc="join-the-community-and-get-help">Join the community and get help</h3></div><div class="collapse__content"><p id="-h7gbkp_722">The best way to report problems and get help is the <a href="https://github.com/JetBrains/kotlin-wrappers/issues" id="-h7gbkp_723" data-external="true" rel="noopener noreferrer" target="_blank">kotlin-wrappers issue tracker</a>. If you can't find a ticket for your issue, feel free to file a new one. You can also join the official <a href="https://surveys.jetbrains.com/s3/kotlin-slack-sign-up" id="-h7gbkp_724" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Slack</a>. There are channels for <code class="code" id="-h7gbkp_725">#javascript</code> and <code class="code" id="-h7gbkp_726">#react</code>.</p></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="learn-more-about-coroutines" data-toc="learn-more-about-coroutines">Learn more about coroutines</h3></div><div class="collapse__content"><p id="-h7gbkp_727">If you're interested in finding out more about how you can write concurrent code, check out the tutorial on <span id="-h7gbkp_728">coroutines</span>.</p></div></div></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="learn-more-about-react" data-toc="learn-more-about-react">Learn more about React</h3></div><div class="collapse__content"><p id="-h7gbkp_729">Now that you know the basic React concepts and how they translate to Kotlin, you can convert some other concepts outlined in <a href="https://react.dev/learn" id="-h7gbkp_730" data-external="true" rel="noopener noreferrer" target="_blank">React's documentation</a> into Kotlin.</p></div></div></section></section><div class="last-modified">04 July 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="typesafe-html-dsl.html" class="navigation-links__prev">Typesafe HTML DSL</a><a href="custom-script-deps-tutorial.html" class="navigation-links__next">Get started with Kotlin custom scripting &ndash; tutorial</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>